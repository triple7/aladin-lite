var cds=cds||{},A=A||{};"object"!=typeof JSON&&(JSON={}),function(){"use strict";function f(t){return t<10?"0"+t:t}"function"!=typeof Date.prototype.toJSON&&(Date.prototype.toJSON=function(t){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(t){return this.valueOf()});var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;function quote(t){return escapable.lastIndex=0,escapable.test(t)?'"'+t.replace(escapable,function(t){var e=meta[t];return"string"==typeof e?e:"\\u"+("0000"+t.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+t+'"'}function str(t,e){var i,r,o,s,n,a=gap,l=e[t];switch(l&&"object"==typeof l&&"function"==typeof l.toJSON&&(l=l.toJSON(t)),typeof(l="function"==typeof rep?rep.call(e,t,l):l)){case"string":return quote(l);case"number":return isFinite(l)?String(l):"null";case"boolean":case"null":return String(l);case"object":if(!l)return"null";if(gap+=indent,n=[],"[object Array]"===Object.prototype.toString.apply(l)){for(s=l.length,i=0;i<s;i+=1)n[i]=str(i,l)||"null";return o=0===n.length?"[]":gap?"[\n"+gap+n.join(",\n"+gap)+"\n"+a+"]":"["+n.join(",")+"]",gap=a,o}if(rep&&"object"==typeof rep)for(s=rep.length,i=0;i<s;i+=1)"string"==typeof rep[i]&&(o=str(r=rep[i],l))&&n.push(quote(r)+(gap?": ":":")+o);else for(r in l)Object.prototype.hasOwnProperty.call(l,r)&&(o=str(r,l))&&n.push(quote(r)+(gap?": ":":")+o);return o=0===n.length?"{}":gap?"{\n"+gap+n.join(",\n"+gap)+"\n"+a+"}":"{"+n.join(",")+"}",gap=a,o}}"function"!=typeof JSON.stringify&&(JSON.stringify=function(t,e,i){var r;if(indent=gap="","number"==typeof i)for(r=0;r<i;r+=1)indent+=" ";else"string"==typeof i&&(indent=i);if((rep=e)&&"function"!=typeof e&&("object"!=typeof e||"number"!=typeof e.length))throw new Error("JSON.stringify");return str("",{"":t})}),"function"!=typeof JSON.parse&&(JSON.parse=function(text,reviver){var j;function walk(t,e){var i,r,o=t[e];if(o&&"object"==typeof o)for(i in o)Object.prototype.hasOwnProperty.call(o,i)&&(void 0!==(r=walk(o,i))?o[i]=r:delete o[i]);return reviver.call(t,e,o)}if(text=String(text),cx.lastIndex=0,cx.test(text)&&(text=text.replace(cx,function(t){return"\\u"+("0000"+t.charCodeAt(0).toString(16)).slice(-4)})),/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return j=eval("("+text+")"),"function"==typeof reviver?walk({"":j},""):j;throw new SyntaxError("JSON.parse")})}(),Logger={log:function(t,e){try{var i="";e&&(i=JSON.stringify(e)),$.ajax({url:"//alasky.unistra.fr/cgi/AladinLiteLogger/log.py",data:{action:t,params:i,pageUrl:window.location.href,referer:document.referrer||""},method:"GET",dataType:"json"})}catch(t){window.console&&console.log("Exception: "+t)}}},function(t){"function"==typeof define&&define.amd?define(["jquery"],t):"object"==typeof exports?module.exports=t:t(jQuery)}(function(c){var u,d,t=["wheel","mousewheel","DOMMouseScroll","MozMousePixelScroll"],e="onwheel"in document||9<=document.documentMode?["wheel"]:["mousewheel","DomMouseScroll","MozMousePixelScroll"],p=Array.prototype.slice;if(c.event.fixHooks)for(var i=t.length;i;)c.event.fixHooks[t[--i]]=c.event.mouseHooks;var f=c.event.special.mousewheel={version:"3.1.12",setup:function(){if(this.addEventListener)for(var t=e.length;t;)this.addEventListener(e[--t],r,!1);else this.onmousewheel=r;c.data(this,"mousewheel-line-height",f.getLineHeight(this)),c.data(this,"mousewheel-page-height",f.getPageHeight(this))},teardown:function(){if(this.removeEventListener)for(var t=e.length;t;)this.removeEventListener(e[--t],r,!1);else this.onmousewheel=null;c.removeData(this,"mousewheel-line-height"),c.removeData(this,"mousewheel-page-height")},getLineHeight:function(t){var e=c(t),t=e["offsetParent"in c.fn?"offsetParent":"parent"]();return t.length||(t=c("body")),parseInt(t.css("fontSize"),10)||parseInt(e.css("fontSize"),10)||16},getPageHeight:function(t){return c(t).height()},settings:{adjustOldDeltas:!0,normalizeOffset:!0}};function r(t){var e,i=t||window.event,r=p.call(arguments,1),o=0,s=0,n=0,a=0,l=0,h=0;if((t=c.event.fix(i)).type="mousewheel","detail"in i&&(n=-1*i.detail),"wheelDelta"in i&&(n=i.wheelDelta),"wheelDeltaY"in i&&(n=i.wheelDeltaY),"wheelDeltaX"in i&&(s=-1*i.wheelDeltaX),"axis"in i&&i.axis===i.HORIZONTAL_AXIS&&(s=-1*n,n=0),o=0===n?s:n,"deltaY"in i&&(o=n=-1*i.deltaY),"deltaX"in i&&(s=i.deltaX,0===n&&(o=-1*s)),0!==n||0!==s)return 1===i.deltaMode?(o*=e=c.data(this,"mousewheel-line-height"),n*=e,s*=e):2===i.deltaMode&&(o*=e=c.data(this,"mousewheel-page-height"),n*=e,s*=e),a=Math.max(Math.abs(n),Math.abs(s)),(!d||a<d)&&v(i,d=a)&&(d/=40),v(i,a)&&(o/=40,s/=40,n/=40),o=Math[1<=o?"floor":"ceil"](o/d),s=Math[1<=s?"floor":"ceil"](s/d),n=Math[1<=n?"floor":"ceil"](n/d),f.settings.normalizeOffset&&this.getBoundingClientRect&&(a=this.getBoundingClientRect(),l=t.clientX-a.left,h=t.clientY-a.top),t.deltaX=s,t.deltaY=n,t.deltaFactor=d,t.offsetX=l,t.offsetY=h,t.deltaMode=0,r.unshift(t,o,s,n),u&&clearTimeout(u),u=setTimeout(g,200),(c.event.dispatch||c.event.handle).apply(this,r)}function g(){d=null}function v(t,e){return f.settings.adjustOldDeltas&&"mousewheel"===t.type&&e%120==0}c.fn.extend({mousewheel:function(t){return t?this.bind("mousewheel",t):this.trigger("mousewheel")},unmousewheel:function(t){return this.unbind("mousewheel",t)}})}),window.requestAnimFrame=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(t,e){window.setTimeout(t,1e3/60)};var Stats=function(){function t(t,e,i){for(var r,o,s=0;s<30;s++)for(r=0;r<73;r++)t[o=4*(r+74*s)]=t[o+4],t[o+1]=t[o+5],t[o+2]=t[o+6];for(s=0;s<30;s++)o=4*(73+74*s),s<e?(t[o]=R[i].bg.r,t[o+1]=R[i].bg.g,t[o+2]=R[i].bg.b):(t[o]=R[i].fg.r,t[o+1]=R[i].fg.g,t[o+2]=R[i].fg.b)}var e,i,r,o,s,n,a,l,h,c,u,d,p,f,g,v,m=0,y=2,S=0,w=(new Date).getTime(),C=w,x=w,I=1e3,_=0,b=1e3,M=0,A=1e3,T=0,R={fps:{bg:{r:16,g:16,b:48},fg:{r:0,g:255,b:255}},ms:{bg:{r:16,g:48,b:16},fg:{r:0,g:255,b:0}},mb:{bg:{r:48,g:16,b:26},fg:{r:255,g:0,b:128}}},P=document.createElement("div");P.style.cursor="pointer",P.style.width="80px",P.style.opacity="0.9",P.style.zIndex="10001",P.addEventListener("click",function(){switch(++m==y&&(m=0),i.style.display="none",l.style.display="none",p.style.display="none",m){case 0:i.style.display="block";break;case 1:l.style.display="block";break;case 2:p.style.display="block"}},!1),(i=document.createElement("div")).style.backgroundColor="rgb("+Math.floor(R.fps.bg.r/2)+","+Math.floor(R.fps.bg.g/2)+","+Math.floor(R.fps.bg.b/2)+")",i.style.padding="2px 0px 3px 0px",P.appendChild(i),(r=document.createElement("div")).style.fontFamily="Helvetica, Arial, sans-serif",r.style.textAlign="left",r.style.fontSize="9px",r.style.color="rgb("+R.fps.fg.r+","+R.fps.fg.g+","+R.fps.fg.b+")",r.style.margin="0px 0px 1px 3px",r.innerHTML='<span style="font-weight:bold">FPS</span>',i.appendChild(r),(o=document.createElement("canvas")).width=74,o.height=30,o.style.display="block",o.style.marginLeft="3px",i.appendChild(o),(s=o.getContext("2d")).fillStyle="rgb("+R.fps.bg.r+","+R.fps.bg.g+","+R.fps.bg.b+")",s.fillRect(0,0,o.width,o.height),n=s.getImageData(0,0,o.width,o.height),(l=document.createElement("div")).style.backgroundColor="rgb("+Math.floor(R.ms.bg.r/2)+","+Math.floor(R.ms.bg.g/2)+","+Math.floor(R.ms.bg.b/2)+")",l.style.padding="2px 0px 3px 0px",l.style.display="none",P.appendChild(l),(h=document.createElement("div")).style.fontFamily="Helvetica, Arial, sans-serif",h.style.textAlign="left",h.style.fontSize="9px",h.style.color="rgb("+R.ms.fg.r+","+R.ms.fg.g+","+R.ms.fg.b+")",h.style.margin="0px 0px 1px 3px",h.innerHTML='<span style="font-weight:bold">MS</span>',l.appendChild(h),(o=document.createElement("canvas")).width=74,o.height=30,o.style.display="block",o.style.marginLeft="3px",l.appendChild(o),(c=o.getContext("2d")).fillStyle="rgb("+R.ms.bg.r+","+R.ms.bg.g+","+R.ms.bg.b+")",c.fillRect(0,0,o.width,o.height),u=c.getImageData(0,0,o.width,o.height);try{performance&&performance.memory&&performance.memory.totalJSHeapSize&&(y=3)}catch(t){}return(p=document.createElement("div")).style.backgroundColor="rgb("+Math.floor(R.mb.bg.r/2)+","+Math.floor(R.mb.bg.g/2)+","+Math.floor(R.mb.bg.b/2)+")",p.style.padding="2px 0px 3px 0px",p.style.display="none",P.appendChild(p),(f=document.createElement("div")).style.fontFamily="Helvetica, Arial, sans-serif",f.style.textAlign="left",f.style.fontSize="9px",f.style.color="rgb("+R.mb.fg.r+","+R.mb.fg.g+","+R.mb.fg.b+")",f.style.margin="0px 0px 1px 3px",f.innerHTML='<span style="font-weight:bold">MB</span>',p.appendChild(f),(o=document.createElement("canvas")).width=74,o.height=30,o.style.display="block",o.style.marginLeft="3px",p.appendChild(o),(g=o.getContext("2d")).fillStyle="#301010",g.fillRect(0,0,o.width,o.height),v=g.getImageData(0,0,o.width,o.height),{domElement:P,update:function(){S++,w=(new Date).getTime(),a=w-C,b=Math.min(b,a),M=Math.max(M,a),t(u.data,Math.min(30,30-a/200*30),"ms"),h.innerHTML='<span style="font-weight:bold">'+a+" MS</span> ("+b+"-"+M+")",c.putImageData(u,0,0),x+1e3<(C=w)&&(e=Math.round(1e3*S/(w-x)),I=Math.min(I,e),_=Math.max(_,e),t(n.data,Math.min(30,30-e/100*30),"fps"),r.innerHTML='<span style="font-weight:bold">'+e+" FPS</span> ("+I+"-"+_+")",s.putImageData(n,0,0),3==y&&(d=954e-9*performance.memory.usedJSHeapSize,A=Math.min(A,d),T=Math.max(T,d),t(v.data,Math.min(30,30-d/2),"mb"),f.innerHTML='<span style="font-weight:bold">'+Math.round(d)+" MB</span> ("+Math.round(A)+"-"+Math.round(T)+")",g.putImageData(v,0,0)),x=w,S=0)}}},Constants={PI:Math.PI,C_PR:Math.PI/180,VLEV:2,EPS:1e-7,c:.105,LN10:Math.log(10),PIOVER2:Math.PI/2,TWOPI:2*Math.PI,TWOTHIRD:2/3,ARCSECOND_RADIAN:484813681109536e-20};SpatialVector=function(){function e(t,e,i){t&&(this.x=t,this.y=e,this.z=i,this.ra_=0,this.dec_=0,this.okRaDec_=!1)}e.prototype.setXYZ=function(t,e,i){this.x=t,this.y=e,this.z=i,this.okRaDec_=!1},e.prototype.length=function(){return Math.sqrt(this.lengthSquared())},e.prototype.lengthSquared=function(){return this.x*this.x+this.y*this.y+this.z*this.z},e.prototype.normalized=function(){var t=this.length();this.x/=t,this.y/=t,this.z/=t},e.prototype.set=function(t,e){this.ra_=t,this.dec_=e,this.okRaDec_=!0;t=Math.cos(this.dec_*Constants.C_PR);this.x=Math.cos(this.ra_*Constants.C_PR)*t,this.y=Math.sin(this.ra_*Constants.C_PR)*t,this.z=Math.sin(this.dec_*Constants.C_PR)},e.angle=function(t){var e=this.y*t.z-this.z*t.y,i=this.z*t.x-this.x*t.z,r=this.x*t.y-this.y*t.x,r=Math.sqrt(e*e+i*i+r*r);return Math.abs(Math.atan2(r,dot(t)))},e.get=function(){return[x,y,z]},e.toString=function(){return"SpatialVector["+this.x+", "+this.y+", "+this.z+"]"},e.cross=function(t){return new e(this.y*t.z-t.y*this.z,this.z*t.x-t.z*this.x,this.x*t.y-t.x()*this.y)},e.equal=function(t){return this.x==t.x&&this.y==t.y&&this.z==t.z()},e.mult=function(t){return new e(t*this.x,t*this.y,t*this.z)},e.dot=function(t){return this.x*t.x+this.y*t.y+this.z*t.z},e.add=function(t){return new e(this.x+t.x,this.y+t.y,this.z+t.z)},e.sub=function(t){return new e(this.x-t.x,this.y-t.y,this.z-t.z)},e.prototype.dec=function(){return this.okRaDec_||(this.normalized(),this.updateRaDec()),this.dec_},e.prototype.ra=function(){return this.okRaDec_||(this.normalized(),this.updateRaDec()),this.ra_},e.updateXYZ=function(){var t=Math.cos(this.dec_*Constants.C_PR);this.x=Math.cos(this.ra_*Constants.C_PR)*t,this.y=Math.sin(this.ra_*Constants.C_PR)*t,this.z=Math.sin(this.dec_*Constants.C_PR)},e.prototype.updateRaDec=function(){this.dec_=Math.asin(this.z)/Constants.C_PR;var t=Math.cos(this.dec_*Constants.C_PR);this.ra_=t>Constants.EPS||-Constants.EPS>t?this.y>Constants.EPS||this.y<-Constants.EPS?this.y<0?360-Math.acos(this.x/t)/Constants.C_PR:Math.acos(this.x/t)/Constants.C_PR:this.x<0?180:0:0,this.okRaDec_=!0};return e.prototype.toRaRadians=function(){var t=0;return(t=0!=this.x||0!=this.y?Math.atan2(this.y,this.x):t)<0&&(t+=2*Math.PI),t},e.toDeRadians=function(){var t=z/this.length(),t=Math.acos(t);return Math.PI/2-t},e}();var v=new SpatialVector(1,0,0);v.set(.35,1.22),Utils=function(){},Utils.radecToPolar=function(t,e){return{theta:Math.PI/2-e/180*Math.PI,phi:t/180*Math.PI}},Utils.polarToRadec=function(t,e){return{ra:180*e/Math.PI,dec:180*(Math.PI/2-t)/Math.PI}},Utils.castToInt=function(t){return 0<t?Math.floor(t):Math.ceil(t)};const NSIDELIST=[1,2,4,8,16,32,64,128,256,512,1024,2048,4096,8192,16384,32768,65536,131072,262144,524288,1048576,2097152,4194304,8388608,16777216],NS_MAX=16777216,ORDER_MAX=24,PI2=2*Math.PI,PI=Math.PI,PI_2=Math.PI/2,PI_4=Math.PI/4,PI_8=Math.PI/8;function AstroMath(){}function Projection(t,e){this.PROJECTION=Projection.PROJ_TAN,this.ROT=this.tr_oR(t,e),this.longitudeIsReversed=!1}function Coo(t,e,i){this.lon=t,this.lat=e,this.prec=i,this.frame=null,this.computeDirCos()}function Tokenizer(t,e){this.string=Strings.trim(t,e),this.sep=e,this.pos=0}function Strings(){}function Numbers(){}function relMouseCoords(t){if(t.offsetX)return{x:t.offsetX,y:t.offsetY};Utils.cssScale||(s=((o=window.getComputedStyle(document.body,null)).getPropertyValue("-webkit-transform")||o.getPropertyValue("-moz-transform")||o.getPropertyValue("-ms-transform")||o.getPropertyValue("-o-transform")||o.getPropertyValue("transform")).match(/matrix\((-?\d*\.?\d+),\s*0,\s*0,\s*(-?\d*\.?\d+),\s*0,\s*0\)/),Utils.cssScale=s?parseFloat(s[1]):1);var e=t,i=(e.target,e.target||e.srcElement),r=i.currentStyle||window.getComputedStyle(i,null),o=parseInt(r.borderLeftWidth,10),s=parseInt(r.borderTopWidth,10),t=i.getBoundingClientRect(),r=e.clientX,i=e.clientY;null==e.clientX&&(r=e.originalEvent.changedTouches[0].clientX,i=e.originalEvent.changedTouches[0].clientY);o=r-o-t.left,t=i-s-t.top;return{x:parseInt(o/Utils.cssScale),y:parseInt(t/Utils.cssScale)}}HealpixIndex=function(){"use strict";function y(t){this.Nside=t}return y.init=function(){},y.order2nside=function(t){return 1<<t},y.nside2order=function(t){return y.ilog2(t)},y.nside2Npix=function(t){return 12*t*t},y.vec2pix_nest=function(t,e){var{z:i,a:e}=y.vec2za(e[0],e[1],e[2]);return y.za2pix_nest(t,i,e)},y.vec2pix_ring=function(t,e){var{z:i,a:e}=y.vec2za(e[0],e[1],e[2]);return y.nest2ring(t,y.za2pix_nest(t,i,e))},y.prototype.ang2pix_nest=function(t,e){t=Math.cos(t);return y.za2pix_nest(this.Nside,t,e)},y.ang2pix_ring=function(t,e,i){e=Math.cos(e);return y.nest2ring(t,y.za2pix_nest(t,e,i))},y.nest2ring=function(t,e){var{f:i,x:r,y:e}=y.nest2fxy(t,e);return y.fxy2ring(t,i,r,e)},y.ring2nest=function(t,e){if(1==t)return e;var{f:i,x:r,y:e}=y.ring2fxy(t,e);return y.fxy2nest(t,i,r,e)},y.ring2fxy=function(t,e){var i=2*t*(t-1);if(e<i){var r=Math.floor((Math.sqrt(1+2*e)+1)/2),o=e-2*r*(r-1),s=Math.floor(o/r),o=o%r,r=t-r+o;return{f:s,x:r,y:t-1-o}}if(e<i+8*t*t){const n=e-i;s=4*t;const a=t-Math.floor(n/s),l=n%s*2+(a%2==0?1:0);r=l-4*t,o=a+5*t-1,i=(o+r)/2,s=(o-r)/2,o=Math.floor(i/t),r=Math.floor(s/t);const h=4*(5-(o+r))+(o-r+4>>1)%4,c=i%t;return{f:h,x:c,y:s%t}}{e=12*t*t-e-1;const a=Math.floor((Math.sqrt(1+2*e)+1)/2),l=e-2*a*(a-1),h=11-Math.floor(l/a),n=l%a,c=a-n-1;return{f:h,x:c,y:n}}},y.pix2vec_nest=function(t,e){var{f:i,x:r,y:e}=y.nest2fxy(t,e),{t:r,u:e}=y.fxy2tu(t,i,r,e),{z:r,a:e}=y.tu2za(r,e);return y.za2vec(r,e)},y.pix2ang_nest=function(t,e){var{f:i,x:r,y:e}=y.nest2fxy(t,e),{t:r,u:e}=y.fxy2tu(t,i,r,e),{z:r,a:e}=y.tu2za(r,e);return{theta:Math.acos(r),phi:e}},y.pix2vec_ring=function(t,e){return y.pix2vec_nest(t,y.ring2nest(t,e))},y.pix2ang_ring=function(t,e){return y.pix2ang_nest(t,y.ring2nest(t,e))},y.query_disc_inclusive_nest=function(e,i,r,o){if(r>PI_2)throw new Error("query_disc: radius must <PI/2");const s=y.max_pixrad(e);var t=PI_4/e,{z:n,a}=y.vec2za(i[0],i[1],i[2]),l=Math.sqrt(1n-n*n),h=Math.cos(r),c=Math.sin(r),u=n*h-l*c,d=y.za2tu(n*h+l*c,0).u,p=y.za2tu(u,0).u,u=l*h-n*c<0,c=l*h+n*c<0;let f=Math.floor((PI_2-d)/t),g=Math.floor((PI_2-p)/t+1);if(u){++f;for(let t=1;t<=f;++t)y.walk_ring(e,t,o);++f}if(0==f&&(y.walk_ring(e,1,o),f=2),c){--g;for(let t=g;t<=4*e-1;++t)y.walk_ring(e,t,o);--g}g==4n*e&&(y.walk_ring(e,4n*e-1,o),g=4n*e-2n);var v=Math.acos(n);for(let t=f;t<=g;++t)y.walk_ring_around(e,t,a,v,r+s,function(t){y.angle(y.pix2vec_nest(e,t),i)<=r+s&&o(t)})},y.prototype.queryDisc=function(e,i,r){var o=[],s=this.Nside;if(i>PI_2)throw new Error("query_disc: radius must <PI/2");const n=y.max_pixrad(s);var t=PI_4/s,{z:a,a:l}=y.vec2za(e.x,e.y,e.z),h=Math.sqrt(1-a*a),c=Math.cos(i),u=Math.sin(i),d=a*c-h*u,p=y.za2tu(a*c+h*u,0).u,f=y.za2tu(d,0).u,d=h*c-a*u<0,u=h*c+a*u<0;let g=Math.floor((PI_2-p)/t),v=Math.floor((PI_2-f)/t+1);if(d){++g;for(let t=1;t<=g;++t)y.walk_ring(s,t,r);++g}if(0==g&&(y.walk_ring(s,1,r),g=2),u){--v;for(let t=v;t<=4*s-1;++t)y.walk_ring(s,t,r);--v}v==4*s&&(y.walk_ring(s,4*s-1,r),v=4*s-2);var m=Math.acos(a);for(let t=g;t<=v;++t)y.walk_ring_around(s,t,l,m,i+n,function(t){y.angle(y.pix2vec_nest(s,t),e)<=i+n&&o.push(t)});return o},y.query_disc_inclusive_ring=function(e,t,i,r){return y.query_disc_inclusive_nest(e,t,i,function(t){r(nest2ring(e,t))})},y.max_pixrad=function(t){var e=PI_4/t;return y.angle(y.tu2vec(e,t*e),y.tu2vec(e,(t+1)*e))},y.angle=function(t,e){return 2*Math.asin(Math.sqrt(y.distance2(t,e))/2)},y.tu2vec=function(t,e){var{z:t,a:e}=y.tu2za(t,e);return y.za2vec(t,e)},y.distance2=function(t,e){var i=t.x-e.x,r=t.y-e.y,e=t.z-e.z;return i*i+r*r+e*e},y.walk_ring_around=function(e,t,i,r,o,s){if(r<o||r+o>PI)return walk_ring(e,t,s);var n=PI_4*(2-t/e),a=y.tu2za(PI_4,n).z,l=Math.sin(r),h=Math.cos(r),r=Math.sin(o),o=Math.cos(o),o=Math.atan2(Math.sqrt(-y.square(a-h*o)/(y.square(l)*r*r)+1)*r,(-a*h+o)/l);if(o>=PI)return y.walk_ring(e,t,s);var l=y.center_t(e,t,y.za2tu(a,y.wrap(i-o,PI2)).t),o=y.center_t(e,t,y.za2tu(a,y.wrap(i+o,PI2)).t),l=y.tu2fxy(e,l,n),c=y.right_next_pixel(e,y.tu2fxy(e,o,n));for(let t=l;!y.fxy_compare(t,c);t=y.right_next_pixel(e,t))s(y.fxy2nest(e,t.f,t.x,t.y))},y.center_t=function(t,e,i){t=PI_4/t;return i=1+((i/=t)+e%2>>1<<1)-e%2,i*=t},y.walk_ring=function(t,e,i){var r=PI_4*(2-e/t),e=PI_4*(1+(1-e%2)/t),o=y.tu2fxy(t,e,r);let s=o;for(;i(y.fxy2nest(t,s.f,s.x,s.y)),s=y.right_next_pixel(t,s),!y.fxy_compare(s,o););},y.fxy_compare=function(t,e){return t.x==e.x&&t.y==e.y&&t.f==e.f},y.right_next_pixel=function(t,{f:e,x:i,y:r}){if(++i==t)switch(Math.floor(e/4)){case 0:e=(e+1)%4,i=r,r=t;break;case 1:e-=4,i=0;break;case 2:e=4+(e+1)%4,i=0}if(-1==--r)switch(Math.floor(e/4)){case 0:e=4+(e+1)%4,r=t-1;break;case 1:e+=4,r=t-1;break;case 2:e=8+(e+1)%4,r=i-1,i=0}return{f:e,x:i,y:r}},y.corners_nest=function(t,e){var i,r,{f:o,x:s,y:t}=y.nest2fxy(e,t),{t:n,u:a}=y.fxy2tu(e,o,s,t),e=PI_4/e,l=[];for([i,r]of[[0,e],[-e,0],[0,-e],[e,0]]){var{z:h,a:c}=y.tu2za(n+i,a+r);l.push(y.za2vec(h,c))}return l},y.prototype.corners_nest=function(t){var e,i,{f:r,x:o,y:t}=y.nest2fxy(this.Nside,t),{t:s,u:n}=y.fxy2tu(this.Nside,r,o,t),t=PI_4/this.Nside,a=[];for([e,i]of[[0,t],[-t,0],[0,-t],[t,0]]){var{z:l,a:h}=y.tu2za(s+e,n+i);a.push(y.za2vec(l,h))}return a},y.corners_ring=function(t,e){return y.corners_nest(t,y.ring2nest(t,e))},y.nside2pixarea=function(t){returnPI},y.nside2resol=function(t){return Math.sqrt(PI/3)/t},y.pixcoord2vec_nest=function(t,e,i,r){var{f:o,x:s,y:e}=y.nest2fxy(t,e),{t:s,u:e}=y.fxy2tu(t,o,s,e),t=PI_4/t,{z:i,a:r}=y.tu2za(s+t*(i-r),e+t*(i+r-1));return y.za2vec(i,r)},y.pixcoord2vec_ring=function(t,e,i,r){return y.pixcoord2vec_nest(t,y.ring2nest(t,e),i,r)},y.za2pix_nest=function(t,e,i){var{t:r,u:e}=y.za2tu(e,i),{f:i,x:r,y:e}=y.tu2fxy(t,r,e);return y.fxy2nest(t,i,r,e)},y.tu2fxy=function(t,e,i){var{f:r,p:e,q:i}=y.tu2fpq(e,i);return{f:r,x:y.clip(Math.floor(t*e),0,t-1),y:y.clip(Math.floor(t*i),0,t-1)}},y.wrap=function(t,e){return t<0?e- -t%e:t%e},y.sigma=function(t){return t<0?-y.sigma(-t):2-Math.sqrt(3*(1-t))},y.za2tu=function(t,e){if(Math.abs(t)<=2/3)return{t:e,u:3*PI_8*t};var i=e%PI_2,t=y.sigma(t);return{t:e-(Math.abs(t)-1)*(i-PI_4),u:PI_4*t}},y.tu2za=function(t,e){var i=Math.abs(e);if(i>=PI_2)return{z:y.sign(e),a:0};if(i<=Math.PI/4)return{z:8/(3*PI)*e,a:t};var r=t%(Math.PI/2),r=t-(i-PI_4)/(i-PI_2)*(r-PI_4);return{z:y.sign(e)*(1-1/3*y.square(2-4*i/PI)),a:r}},y.vec2za=function(t,e,i){var r=t*t+e*e;if(0==r)return{z:i<0?-1:1,a:0};t=(Math.atan2(e,t)+PI2)%PI2;return{z:i/=Math.sqrt(i*i+r),a:t}},y.za2vec=function(t,e){var i=Math.sqrt(1-t*t),r=i*Math.cos(e),e=i*Math.sin(e);return new SpatialVector(r,e,t)},y.ang2vec=function(t,e){t=Math.cos(t);return za2vec(t,e)},y.vec2ang=function(t){var{z:e,a:t}=vec2za(t[0],t[1],t[2]);return{theta:Math.acos(e),phi:t}},y.tu2fpq=function(t,e){t/=PI_4,e/=PI_4,t=y.wrap(t,8);var i=y.clip(((e+=5)+(t+=-4))/2,0,5),r=Math.floor(i),o=y.clip((e-t)/2,3-r,6-r),e=Math.floor(o),t=5-(r+e);return t<0?{f:0,p:1,q:1}:{f:4*t+(r-e+4>>1)%4,p:i%1,q:o%1}},y.fxy2nest=function(t,e,i,r){return BigInt(e)*BigInt(t)*BigInt(t)+y.bit_combine(i,r)},y.bit_combine=function(t,e){t=BigInt(t),e=BigInt(e);return y.assert(t<1n<<26n),y.assert(e<1n<<25n),1n&t|(t&BigInt(2)|e&BigInt(1))<<1n|(t&BigInt(4)|e&BigInt(2))<<2n|(t&BigInt(8)|e&BigInt(4))<<3n|(t&BigInt(16)|e&BigInt(8))<<4n|(t&BigInt(32)|e&BigInt(16))<<5n|(t&BigInt(64)|e&BigInt(32))<<6n|(t&BigInt(128)|e&BigInt(64))<<7n|(t&BigInt(256)|e&BigInt(128))<<8n|(t&BigInt(512)|e&BigInt(256))<<9n|(t&BigInt(1024)|e&BigInt(512))<<10n|(t&BigInt(2048)|e&BigInt(1024))<<11n|(t&BigInt(4096)|e&BigInt(2048))<<12n|(t&BigInt(8192)|e&BigInt(4096))<<13n|(t&BigInt(16384)|e&BigInt(8192))<<14n|(t&BigInt(32768)|e&BigInt(16384))<<15n|(t&BigInt(65536)|e&BigInt(32768))<<16n|(t&BigInt(131072)|e&BigInt(65536))<<17n|(t&BigInt(262144)|e&BigInt(131072))<<18n|(t&BigInt(524288)|e&BigInt(262144))<<19n|(t&BigInt(1048576)|e&BigInt(524288))<<20n|(t&BigInt(2097152)|e&BigInt(1048576))<<21n|(t&BigInt(4194304)|e&BigInt(2097152))<<22n|(t&BigInt(8388608)|e&BigInt(4194304))<<23n|(t&BigInt(16777216)|e&BigInt(8388608))<<24n|(t&BigInt(33554432)|e&BigInt(16777216))<<25n|e&BigInt(33554432)<<26n},y.bit_decombine=function(t){return y.assert(t<=9007199254740991),{x:((t=BigInt(t))&BigInt(1))>>0n|(t&BigInt(4))>>1n|(t&BigInt(16))>>2n|(t&BigInt(64))>>3n|(t&BigInt(256))>>4n|(t&BigInt(1024))>>5n|(t&BigInt(4096))>>6n|(t&BigInt(16384))>>7n|(t&BigInt(65536))>>8n|(t&BigInt(262144))>>9n|(t&BigInt(1048576))>>10n|(t&BigInt(4194304))>>11n|(t&BigInt(16777216))>>12n|(t&BigInt(67108864))>>13n|(t&BigInt(268435456))>>14n|(t&BigInt(1073741824))>>15n|(t&BigInt(4294967296))>>16n|(t&BigInt(17179869184))>>17n|(t&BigInt(68719476736))>>18n|(t&BigInt(274877906944))>>19n|(t&BigInt(1099511627776))>>20n|(t&BigInt(4398046511104))>>21n|(t&BigInt(17592186044416))>>22n|(t&BigInt(70368744177664))>>23n|(t&BigInt(281474976710656))>>24n|(t&BigInt(0x4000000000000))>>25n,y:(t&BigInt(2))>>1n|(t&BigInt(8))>>2n|(t&BigInt(32))>>3n|(t&BigInt(128))>>4n|(t&BigInt(512))>>5n|(t&BigInt(2048))>>6n|(t&BigInt(8192))>>7n|(t&BigInt(32768))>>8n|(t&BigInt(131072))>>9n|(t&BigInt(524288))>>10n|(t&BigInt(2097152))>>11n|(t&BigInt(8388608))>>12n|(t&BigInt(33554432))>>13n|(t&BigInt(134217728))>>14n|(t&BigInt(536870912))>>15n|(t&BigInt(2147483648))>>16n|(t&BigInt(8589934592))>>17n|(t&BigInt(34359738368))>>18n|(t&BigInt(137438953472))>>19n|(t&BigInt(549755813888))>>20n|(t&BigInt(2199023255552))>>21n|(t&BigInt(8796093022208))>>22n|(t&BigInt(35184372088832))>>23n|(t&BigInt(0x800000000000))>>24n|(t&BigInt(562949953421312))>>25n}},y.nest2fxy=function(t,e){var e=Number(e),i=t*t,t=Math.floor(e/i),{x:e,y:i}=y.bit_decombine(e%i);return{f:t,x:e,y:i}},y.fxy2ring=function(t,e,i,r){var t=BigInt(t),o=(e=BigInt(e))/4n,s=(o+2n)*t-(i+r)-1n;if(s<t)return 2n*s*(s-1n)+s*(e%4n)+t-r-1n;if(s<3n*t)return 2n*t*(t-1n)+4n*(s-t)*t+(((2n*(e%4n)-o%2n+1n)*t+(i-r)+8n*t)%(8n*t)>>1n);s=4n*t-s;return 12n*t*t-2n*s*(s-1n)-(4n*s-(4n*s-s*(3n-e%4n)-r)+1n)},y.fxy2tu=function(t,e,i,r){var i=Number(i),r=Number(r),o=Math.floor(e/4),s=(o+2)*t-(i+r)-1;return{t:((e%4*2-o%2+1)*t+(i-r)+8*t)/t*PI_4,u:PI_2-s/t*PI_4}},y.orderpix2uniq=function(t,e){return 4n*((1n<<2n*BigInt(t))-1n)+BigInt(e)},y.uniq2orderpix=function(t){y.assert(t<=9007199254740991);let e=0n,i=((t=BigInt(t))>>2n)+1n;for(;4n<=i;)i>>=2n,++e;t-=(1n<<2n*e)-1n<<2n;return{order:e,ipix:t}},y.ilog2=function(t){return t.toString(2).length-1},y.sign=function(t){return 0<t?1:t<0?-1:0},y.square=function(t){return t*t},y.clip=function(t,e,i){return t<e?e:i<t?i:t},y.assert=function(t){console.assert(t)},y.calculateNSide=function(t){for(var e=0,i=180/Constants.PI,i=5184e4*Constants.PI*i*i,t=Utils.castToInt(i/(t*t)),r=Math.sqrt(t/12),o=NS_MAX,s=0,n=0;NSIDELIST.length>n;n++)if(o>=Math.abs(r-NSIDELIST[n])&&(o=Math.abs(r-NSIDELIST[n]),e=NSIDELIST[n],s=n),e<r&&NS_MAX>r&&(e=NSIDELIST[s+1]),r>NS_MAX)return console.log("nside cannot be bigger than "+NS_MAX),NS_MAX;return e},y}(),AstroMath.D2R=Math.PI/180,AstroMath.R2D=180/Math.PI,AstroMath.sign=function(t){return 0<t?1:t<0?-1:0},AstroMath.cosd=function(t){if(t%90==0)switch(Math.abs(Math.floor(t/90+.5))%4){case 0:return 1;case 1:return 0;case 2:return-1;case 3:return 0}return Math.cos(t*AstroMath.D2R)},AstroMath.sind=function(t){if(t%90==0)switch(Math.abs(Math.floor(t/90-.5))%4){case 0:return 1;case 1:return 0;case 2:return-1;case 3:return 0}return Math.sin(t*AstroMath.D2R)},AstroMath.tand=function(t){var e=t%360;return 0==e||180==Math.abs(e)?0:45==e||225==e?1:-135==e||-315==e?-1:Math.tan(t*AstroMath.D2R)},AstroMath.asind=function(t){return Math.asin(t)*AstroMath.R2D},AstroMath.acosd=function(t){return Math.acos(t)*AstroMath.R2D},AstroMath.atand=function(t){return Math.atan(t)*AstroMath.R2D},AstroMath.atan2=function(t,e){if(0==t)return 0<e?0:e<0?Math.PI:NaN;var i=AstroMath.sign(t);if(0==e)return Math.PI/2*i;t=Math.atan(Math.abs(t/e));return 0<e?t*i:e<0?(Math.PI-t)*i:void 0},AstroMath.atan2d=function(t,e){return AstroMath.atan2(t,e)*AstroMath.R2D},AstroMath.cosh=function(t){return(Math.exp(t)+Math.exp(-t))/2},AstroMath.sinh=function(t){return(Math.exp(t)-Math.exp(-t))/2},AstroMath.tanh=function(t){return(Math.exp(t)-Math.exp(-t))/(Math.exp(t)+Math.exp(-t))},AstroMath.acosh=function(t){return Math.log(t+Math.sqrt(t*t-1))},AstroMath.asinh=function(t){return Math.log(t+Math.sqrt(t*t+1))},AstroMath.atanh=function(t){return.5*Math.log((1+t)/(1-t))},AstroMath.sinc=function(t){t=Math.abs(t),t=t<=.001?1-(t*=t)*(1-t/20)/6:Math.sin(t)/t;return t},AstroMath.asinc=function(t){t=Math.abs(t),t=t<=.001?1+(t*=t)*(6+.45*t)/6:Math.asin(t)/t;return t},AstroMath.hypot=function(t,e){return Math.sqrt(t*t+e*e)},AstroMath.eulerMatrix=function(t,e,i){var r=new Array(3);r[0]=new Array(3),r[1]=new Array(3),r[2]=new Array(3);var o=AstroMath.cosd(t),s=AstroMath.sind(t),n=AstroMath.cosd(e),t=AstroMath.sind(e),e=AstroMath.cosd(i),i=AstroMath.sind(i);return r[0][0]=e*n*o-i*s,r[0][1]=-i*n*o-e*s,r[0][2]=-t*o,r[1][0]=e*n*s+i*o,r[1][1]=-i*n*s+e*o,r[1][2]=-t*s,r[2][0]=-t*e,r[2][1]=-t*o,r[2][2]=n,r},AstroMath.displayMatrix=function(t){for(var e=t.length,i=0,r=0;r<e;r++)t[r].length>i&&(i=t[r].length);for(var o="<table>\n",r=0;r<e;r++){o+="<tr>";for(var s=0;s<e;s++)o+="<td>",r<t[r].length&&(o+=t[r][s].toString()),o+="</td>";o+="</td>\n"}return o+="</table>\n"},Projection.PROJ_TAN=1,Projection.PROJ_TAN2=2,Projection.PROJ_STG=2,Projection.PROJ_SIN=3,Projection.PROJ_SIN2=4,Projection.PROJ_ZEA=4,Projection.PROJ_ARC=5,Projection.PROJ_SCHMIDT=5,Projection.PROJ_AITOFF=6,Projection.PROJ_AIT=6,Projection.PROJ_GLS=7,Projection.PROJ_MERCATOR=8,Projection.PROJ_MER=8,Projection.PROJ_LAM=9,Projection.PROJ_LAMBERT=9,Projection.PROJ_TSC=10,Projection.PROJ_QSC=11,Projection.PROJ_LIST=["Mercator",Projection.PROJ_MERCATOR,"Gnomonic",Projection.PROJ_TAN,"Stereographic",Projection.PROJ_TAN2,"Orthographic",Projection.PROJ_SIN,"Zenithal",Projection.PROJ_ZEA,"Schmidt",Projection.PROJ_SCHMIDT,"Aitoff",Projection.PROJ_AITOFF,"Lambert",Projection.PROJ_LAMBERT],Projection.PROJ_NAME=["-","Gnomonic","Stereographic","Orthographic","Equal-area","Schmidt plates","Aitoff","Global sin","Mercator","Lambert"],Projection.prototype={setCenter:function(t,e){this.ROT=this.tr_oR(t,e)},reverseLongitude:function(t){this.longitudeIsReversed=t},setProjection:function(t){this.PROJECTION=t},project:function(t,e){e=this.tr_ou(t,e),e=this.tr_uu(e,this.ROT),e=this.tr_up(this.PROJECTION,e);return null==e?null:this.longitudeIsReversed?{X:e[0],Y:-e[1]}:{X:-e[0],Y:-e[1]}},unproject:function(t,e){this.longitudeIsReversed||(t=-t);e=this.tr_pu(this.PROJECTION,t,e=-e),e=this.tr_uu1(e,this.ROT),e=this.tr_uo(e);return{ra:e[0],dec:e[1]}},tr_up:function(t,e){var i,r,o,s,n=e[0],a=e[1],l=e[2],h=AstroMath.hypot(n,a);if(0==h&&0==l)return null;switch(t){default:r=null;break;case Projection.PROJ_AITOFF:i=Math.sqrt(h*(h+n)/2),o=Math.sqrt(2*h*(h-n)),o/=i=Math.sqrt((1+i)/2),r=[o=a<0?-o:o,s=l/i];break;case Projection.PROJ_GLS:s=Math.asin(l),r=[o=0!=h?Math.atan2(a,n)*h:0,s];break;case Projection.PROJ_MERCATOR:r=0!=h?[o=Math.atan2(a,n),s=AstroMath.atanh(l)]:null;break;case Projection.PROJ_TAN:r=0<n?[o=a/n,s=l/n]:null;break;case Projection.PROJ_TAN2:r=0<(i=(1+n)/2)?[o=a/i,s=l/i]:null;break;case Projection.PROJ_ARC:s=n<=-1?(o=Math.PI,0):(h=AstroMath.hypot(a,l),o=a*(i=0<n?AstroMath.asinc(h):Math.acos(n)/h),l*i),r=[o,s];break;case Projection.PROJ_SIN:r=0<=n?[o=a,s=l]:null;break;case Projection.PROJ_SIN2:s=0!=(i=Math.sqrt((1+n)/2))?(o=a/i,l/i):(o=2,0),r=[o,s];break;case Projection.PROJ_LAMBERT:s=l,r=[o=(o=0)!=h?Math.atan2(a,n):o,s]}return r},tr_pu:function(t,e,i){var r,o,s,n,a;switch(t){default:return null;case Projection.PROJ_AITOFF:if(1<(r=e*e/8+i*i/2))return null;s=1-r,a=i*(o=Math.sqrt(1-r/2)),0!=(r=AstroMath.hypot(s,n=e*o/2))&&(s=((o=s)*o-n*n)/r,n=2*o*n/r);break;case Projection.PROJ_GLS:if((r=1-(a=Math.sin(i))*a)<0)return null;o=0!=(r=Math.sqrt(r))?e/r:0,s=r*Math.cos(o),n=r*Math.sin(o);break;case Projection.PROJ_MERCATOR:a=AstroMath.tanh(i),s=(r=1/AstroMath.cosh(i))*Math.cos(e),n=r*Math.sin(e);break;case Projection.PROJ_LAMBERT:if((r=1-(a=i)*a)<0)return null;s=(r=Math.sqrt(r))*Math.cos(e),n=r*Math.sin(e);break;case Projection.PROJ_TAN:n=e*(s=1/Math.sqrt(1+e*e+i*i)),a=i*s;break;case Projection.PROJ_TAN2:s=(1-(r=(e*e+i*i)/4))/(o=1+r),n=e/o,a=i/o;break;case Projection.PROJ_ARC:if((r=AstroMath.hypot(e,i))>Math.PI)return null;o=AstroMath.sinc(r),s=Math.cos(r),n=o*e,a=o*i;break;case Projection.PROJ_SIN:if((o=1-e*e-i*i)<0)return null;s=Math.sqrt(o),n=e,a=i;break;case Projection.PROJ_SIN2:if(1<(r=(e*e+i*i)/4))return null;s=1-2*r,n=(o=Math.sqrt(1-r))*e,a=o*i}return[s,n,a]},tr_oR:function(t,e){var i=new Array(3);return i[0]=new Array(3),i[1]=new Array(3),i[2]=new Array(3),i[2][2]=AstroMath.cosd(e),i[0][2]=AstroMath.sind(e),i[1][1]=AstroMath.cosd(t),i[1][0]=-AstroMath.sind(t),i[1][2]=0,i[0][0]=i[2][2]*i[1][1],i[0][1]=-i[2][2]*i[1][0],i[2][0]=-i[0][2]*i[1][1],i[2][1]=i[0][2]*i[1][0],i},tr_ou:function(t,e){var i=new Array(3),r=AstroMath.cosd(e);return i[0]=r*AstroMath.cosd(t),i[1]=r*AstroMath.sind(t),i[2]=AstroMath.sind(e),i},tr_uu:function(t,e){var i=new Array(3),r=t[0],o=t[1],t=t[2];return i[0]=e[0][0]*r+e[0][1]*o+e[0][2]*t,i[1]=e[1][0]*r+e[1][1]*o+e[1][2]*t,i[2]=e[2][0]*r+e[2][1]*o+e[2][2]*t,i},tr_uu1:function(t,e){var i=new Array(3),r=t[0],o=t[1],t=t[2];return i[0]=e[0][0]*r+e[1][0]*o+e[2][0]*t,i[1]=e[0][1]*r+e[1][1]*o+e[2][1]*t,i[2]=e[0][2]*r+e[1][2]*o+e[2][2]*t,i},tr_uo:function(t){var e,i,r=t[0],o=t[1],s=t[2],t=r*r+o*o;if(0==t){if(0==s)return null;i=(e=0)<s?90:-90}else i=AstroMath.atand(s/Math.sqrt(t)),(e=AstroMath.atan2d(o,r))<0&&(e+=360);return[e,i]}},Coo.factor=[3600,60,1],Coo.prototype={setFrame:function(t){this.frame=t},computeDirCos:function(){var t=AstroMath.cosd(this.lat);this.x=t*AstroMath.cosd(this.lon),this.y=t*AstroMath.sind(this.lon),this.z=AstroMath.sind(this.lat)},computeLonLat:function(){var t=this.x*this.x+this.y*this.y;(this.lon=0)==t?0==this.z?(this.lon=NaN,this.lat=NaN):this.lat=0<this.z?90:-90:(this.lon=AstroMath.atan2d(this.y,this.x),this.lat=AstroMath.atan2d(this.z,Math.sqrt(t)),this.lon<0&&(this.lon+=360))},dist2:function(t){var e=t.x-this.x,i=e*e;return i+=(e=t.y-this.y)*e,i+=(e=t.z-this.z)*e},distance:function(t){return 0==t.x&&0==t.y&&0==t.z||0==this.x&&0==this.y&&0==this.z?NaN:2*AstroMath.asind(.5*Math.sqrt(this.dist2(t)))},convertTo:function(t){this.frame.equals(t)||(this.frame.toICRS(this.coo),t.fromICRS(this.coo),this.frame=t,this.lon=this.lat=NaN)},rotate:function(t){var e,i;t!=Umatrix3&&(e=t[0][0]*this.x+t[0][1]*this.y+t[0][2]*this.z,i=t[1][0]*this.x+t[1][1]*this.y+t[1][2]*this.z,t=t[2][0]*this.x+t[2][1]*this.y+t[2][2]*this.z,this.x=e,this.y=i,this.z=t,this.lon=this.lat=NaN)},rotate_1:function(t){var e,i;t!=Umatrix3&&(e=t[0][0]*this.x+t[1][0]*this.y+t[2][0]*this.z,i=t[0][1]*this.x+t[1][1]*this.y+t[2][1]*this.z,t=t[0][2]*this.x+t[1][2]*this.y+t[2][2]*this.z,this.x=e,this.y=i,this.z=t,this.lon=this.lat=NaN)},equals:function(t){return this.x==t.x&&this.y==t.y&&this.z==t.z},parse:function(t){var e=t.indexOf("+");if((e=(e=e<0?t.indexOf("-"):e)<0?t.indexOf(" "):e)<0)return this.lon=NaN,this.lat=NaN,this.prec=0,!1;var i=t.substring(0,e),e=t.substring(e);return this.lon=this.parseLon(i),this.lat=this.parseLat(e),!0},parseLon:function(t){if((t=(t=t.trim()).replace(/:/g," ")).indexOf(" ")<0){var e=t.indexOf(".");return this.prec=e<0?0:t.length-e-1,parseFloat(t)}for(var i=new Tokenizer(t," "),r=0,o=0,s=0;i.hasMore();){var n=i.nextToken(),a=n.indexOf(".");switch(o+=parseFloat(n)*Coo.factor[r],r){case 0:s=a<0?1:2;break;case 1:s=a<0?3:4;break;case 2:s=a<0?5:4+n.length-a}r++}return this.prec=s,15*o/3600},parseLat:function(t){var e;if("-"==(t=(t=t.trim()).replace(/:/g," ")).charAt(0)?(e=-1,t=t.substring(1)):"-"==t.charAt(0)?t=t.substring(e=1):e=1,t.indexOf(" ")<0){var i=t.indexOf(".");return this.prec=i<0?0:t.length-i-1,parseFloat(t)*e}for(var r=new Tokenizer(t," "),o=0,s=0,n=0;r.hasMore();){var a=r.nextToken(),l=a.indexOf(".");switch(s+=parseFloat(a)*Coo.factor[o],o){case 0:n=l<0?1:2;break;case 1:n=l<0?3:4;break;case 2:n=l<0?5:4+a.length-l}o++}return this.prec=n,s*e/3600},format:function(t){isNaN(this.lon)&&this.computeLonLat();var e,i="",r="";return r=0<=t.indexOf("d")?(i=Numbers.format(this.lon,this.prec),Numbers.format(this.lat,this.prec)):(e=this.lon/15,i=Numbers.toSexagesimal(e,this.prec+1,!1),Numbers.toSexagesimal(this.lat,this.prec,!1)),0<this.lat&&(r="+"+r),0<=t.indexOf("/")?i+" "+r:0<=t.indexOf("2")?[i,r]:i+r}},Tokenizer.prototype={hasMore:function(){return this.pos<this.string.length},nextToken:function(){for(var t=this.pos;t<this.string.length&&this.string.charAt(t)==this.sep;)t++;for(var e=t;e<this.string.length&&this.string.charAt(e)!=this.sep;)e++;return this.pos=e,this.string.substring(t,e)}},Strings.trim=function(t,e){for(var i=0,r=t.length-1;i<t.length&&t.charAt(i)==e;)i++;if(i==t.length)return"";for(;i<r&&t.charAt(r)==e;)r--;return t.substring(i,r+1)},Numbers.pow10=[1,10,100,1e3,1e4,1e5,1e6,1e7,1e8,1e9,1e10,1e11,1e12,1e13,1e14],Numbers.rndval=[.5,.05,.005,5e-4,5e-5,5e-6,5e-7,5e-8,5e-9,5e-10,5e-11,5e-12,5e-13,5e-14,5e-14],Numbers.format=function(t,e){if(e<=0)return Math.round(t).toString();var i=t.toString(),r=i.indexOf("."),o=0<=r?i.length-r-1:0;if(o<=e){r<0&&(i+=".");for(var s=0;s<e-o;s++)i+="0";return i}return(i=(t+Numbers.rndval[e]).toString()).substr(0,r+e+1)},Numbers.toSexagesimal=function(t,e,i){var r=t<0?"-":i?"+":"",o=Math.abs(t);switch(e){case 1:return r+(n=Math.round(o)).toString();case 2:return r+Numbers.format(o,1);case 3:return r+(n=Math.floor(o))+" "+(s=Math.round(60*(o-n)));case 4:var s=60*(o-(n=Math.floor(o)));return r+n+" "+Numbers.format(s,1);case 5:s=60*(o-(n=Math.floor(o)));return r+n+" "+(a=Math.floor(s))+" "+(l=Math.round(60*(s-a)));case 6:case 7:case 8:var n,a,l=60*((s=60*(o-(n=(n=Math.floor(o))<10?"0"+n:n)))-(a=(a=Math.floor(s))<10?"0"+a:a));return r+n+" "+a+" "+Numbers.format(l,e-5);default:return r+Numbers.format(o,1)}},SimbadPointer=(SimbadPointer={MIRRORS:["https://alasky.u-strasbg.fr/cgi/simbad-flat/simbad-quick.py","https://alaskybis.u-strasbg.fr/cgi/simbad-flat/simbad-quick.py"],query:function(t,e,i,s){i={Ident:new Coo(t,e,7).format("s/"),SR:i};Utils.loadFromMirrors(SimbadPointer.MIRRORS,{data:i,onSuccess:function(t){s.view.setCursor("pointer");var e,i,r,o=/(.*?)\/(.*?)\((.*?),(.*?)\)/g.exec(t);o?((e=new Coo).parse(o[1]),i=o[2],r='<div class="aladin-sp-title"><a target="_blank" href="http://simbad.u-strasbg.fr/simbad/sim-id?Ident='+encodeURIComponent(i)+'">'+i+"</a></div>",t='<div class="aladin-sp-content">',t+="<em>Type: </em>"+o[4]+"<br>",o=o[3],Utils.isNumber(o)&&(t+="<em>Mag: </em>"+o+"<br>"),t+='<br><a target="_blank" href="http://cdsportal.u-strasbg.fr/?target='+encodeURIComponent(i)+'">Query in CDS portal</a>',s.showPopup(e.lon,e.lat,r,t+="</div>")):s.hidePopup()},onFailure:function(){s.view.setCursor("pointer"),s.hidePopup()},timeout:5})}},SimbadPointer),Box=function(){function t(t){this.$parentDiv=$("<div>"),this.$parentDiv.addClass("aladin-box"),this.css=(t=t||{}).css||{padding:"4px"},this.position=t.position||"bottom","right"==this.position&&(this.css.left="unset"),this.css[this.position]="4px",this.contentCss=t.contentCss||{},this.title=t.title||void 0,this.content=t.content||void 0,this.showHandler=void 0===t.showHandler||t.showHandler,this.openCallback=t.openCallback||void 0,this.closeCallback=t.closeCallback||void 0,this.changingDim="width","top"!=this.position&&"bottom"!=this.position||(this.changingDim="height"),this.open=!1,this._render(),this.$parentDiv.show(),this.open=!0,this.hide()}t.prototype={show:function(){var t,e,i;this.open||(this.open=!0,this.$parentDiv.show(),this._updateChevron(),"width"==this.changingDim&&this.$parentDiv.find(".aladin-box-title-label").show(),(e={})[(t=this).changingDim]="show",i="width"==this.changingDim?0:400,this.$parentDiv.find(".aladin-box-content").animate(e,i,function(){t.css[t.position]="4px",t.updateStyle(t.css),"function"==typeof t.openCallback&&t.openCallback()}))},hide:function(){var t,e,i;this.open&&(this.open=!1,this._updateChevron(),"width"==this.changingDim&&this.$parentDiv.find(".aladin-box-title-label").hide(),(e={})[(t=this).changingDim]="hide",i="width"==this.changingDim?0:400,this.$parentDiv.find(".aladin-box-content").animate(e,i,function(){t.css[t.position]="0px",t.updateStyle(t.css),"function"==typeof t.closeCallback&&t.closeCallback()}))},realHide:function(){this.open=!1,this.$parentDiv.hide()},updateStyle:function(t){this.css=t,this.$parentDiv.css(t)},setContent:function(t){this.content=t,this._render()},setTitle:function(t){this.title=t,this._render()},enable:function(){this.$parentDiv.enable()},disable:function(){this.$parentDiv.disable()},_render:function(){var t=this;this.$parentDiv.empty(),this.$parentDiv.off();var e=$('<div class="aladin-box-title">');this.showHandler&&(i=$('<span class="aladin-chevron">'),e.append(i)),this.title&&e.append(' <span class="aladin-box-title-label">'+this.title+"</span>"),this.$parentDiv.append(e);var i=$('<div class="aladin-box-content">'+(this.content||"")+"</div>");i.css(this.contentCss),this.$parentDiv.append(i),this._updateChevron(),this.updateStyle(this.css),e.on("click",function(){t.open?t.hide():t.show()})},_updateChevron:function(){this.$parentDiv.find(".aladin-chevron").removeClass().addClass("aladin-chevron "+e(this.position,this.open)).attr("title","Click to "+(this.open?"hide ":"show ")+(this.title||"")+" panel")}};var e=function(t,e){return"top"==t&&e||"bottom"==t&&!e?"aladin-chevron-up":"bottom"==t&&e||"top"==t&&!e?"aladin-chevron-down":"right"==t&&e||"left"==t&&!e?"aladin-chevron-right":"left"==t&&e||"right"==t&&!e?"aladin-chevron-left":""};return t}(),CooConversion=function(){var e={GALACTIC_TO_J2000:[-.0548755604024359,.4941094279435681,-.867666148981161,-.8734370902479237,-.4448296299195045,-.1980763734646737,-.4838350155267381,.7469822444763707,.4559837762325372],J2000_TO_GALACTIC:[-.0548755604024359,-.873437090247923,-.4838350155267381,.4941094279435681,-.4448296299195045,.7469822444763707,-.867666148981161,-.1980763734646737,.4559837762325372],Transform:function(t,e){t[0]=t[0]*Math.PI/180,t[1]=t[1]*Math.PI/180;var i=new Array(Math.cos(t[0])*Math.cos(t[1]),Math.sin(t[0])*Math.cos(t[1]),Math.sin(t[1])),r=new Array(i[0]*e[0]+i[1]*e[1]+i[2]*e[2],i[0]*e[3]+i[1]*e[4]+i[2]*e[5],i[0]*e[6]+i[1]*e[7]+i[2]*e[8]),t=Math.sqrt(r[0]*r[0]+r[1]*r[1]+r[2]*r[2]),i=new Array(0,0);i[1]=Math.asin(r[2]/t);e=r[0]/t/Math.cos(i[1]),t=r[1]/t/Math.cos(i[1]);return i[0]=Math.atan2(t,e),i[0]<0&&(i[0]=i[0]+2*Math.PI),i[0]=180*i[0]/Math.PI,i[1]=180*i[1]/Math.PI,i},GalacticToJ2000:function(t){return e.Transform(t,e.GALACTIC_TO_J2000)},J2000ToGalactic:function(t){return e.Transform(t,e.J2000_TO_GALACTIC)}};return e}(),Sesame=(Sesame={cache:{},SESAME_URL:"http://cds.u-strasbg.fr/cgi-bin/nph-sesame.jsonp",getTargetRADec:function(t,e,i){var r;e&&(/[a-zA-Z]/.test(t)?Sesame.resolve(t,function(t){e({ra:t.Target.Resolver.jradeg,dec:t.Target.Resolver.jdedeg})},function(t){i&&i()}):((r=new Coo).parse(t),e&&e({ra:r.lon,dec:r.lat})))},resolve:function(t,e,i){var r=Sesame.SESAME_URL;Utils.isHttpsContext()&&(r=r.replace("http://","https://")),$.ajax({url:r,data:{object:t},method:"GET",dataType:"jsonp",success:function(t){(t.Target&&t.Target.Resolver&&t.Target.Resolver?e:i)(t)},error:i})}},Sesame),HealpixCache=function(){var o={staticCache:{corners:{nside8:[]}},dynamicCache:{},lastNside:8,hpxIdxCache:null,init:function(){var t,e=new HealpixIndex(8),i=HealpixIndex.nside2Npix(8);console.log("got generated npix "+i);for(var r=0;r<i;r++)t=e.corners_nest(r,1),o.staticCache.corners.nside8.push(t);o.hpxIdxCache=e}};return o.init(),o.corners_nest=function(t,e){return 8==e?o.staticCache.corners.nside8[t]:(e!=o.lastNside&&(o.hpxIdxCache=new HealpixIndex(e),o.lastNside=e),o.hpxIdxCache.corners_nest(t,1))},o}(),Utils=Utils||{},Utils.cssScale=void 0,HTMLCanvasElement.prototype.relMouseCoords=relMouseCoords,Function.prototype.bind||(Function.prototype.bind=function(t){if("function"!=typeof this)throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");function e(){return o.apply(this instanceof s?this:t||{},r.concat(i.call(arguments)))}var i=[].slice,r=i.call(arguments,1),o=this,s=function(){};return e.prototype=this.prototype,e}),$=$||jQuery,$.urlParam=function(t,e){return void 0===e&&(e=location.search),decodeURIComponent((new RegExp("[?|&]"+t+"=([^&;]+?)(&|#|;|$)").exec(e)||[,""])[1].replace(/\+/g,"%20"))||null},Utils.isNumber=function(t){return!isNaN(parseFloat(t))&&isFinite(t)},Utils.isInt=function(t){return Utils.isNumber(t)&&Math.floor(t)==t},Utils.debounce=function(i,r){var o=null;return function(){var t=this,e=arguments;clearTimeout(o),o=setTimeout(function(){i.apply(t,e)},r)}},Utils.throttle=function(r,o,s){var n,a;return o=o||250,function(){var t=s||this,e=+new Date,i=arguments;n&&e<n+o?(clearTimeout(a),a=setTimeout(function(){n=e,r.apply(t,i)},o)):(n=e,r.apply(t,i))}},Utils.LRUCache=function(t){this._keys=[],this._items={},this._expires={},this._size=0,this._maxsize=t||1024},Utils.LRUCache.prototype={set:function(t,e){var i=this._keys,r=this._items,o=this._expires,s=this._size;this._maxsize<=s&&(i.sort(function(t,e){return o[t]>o[e]?-1:o[t]<o[e]?1:0}),delete o[i[--s]],delete r[i[s]]),r[i[s]=t]=e,o[t]=Date.now(),s++,this._keys=i,this._items=r,this._expires=o,this._size=s},get:function(t){var e=this._items[t];return e&&(this._expires[t]=Date.now()),e},keys:function(){return this._keys}},Utils.loadFromMirrors=function(t,e){var i=e&&e.data||null,r=(e&&e.method,e&&e.dataType||null),o=(e&&e.timeout,e&&e.onSuccess||null),s=e&&e.onFailure||null;0===t.length?"function"==typeof s&&s():(i={url:t[0],data:i},r&&(i.dataType=r),$.ajax(i).done(function(t){"function"==typeof o&&o(t)}).fail(function(){Utils.loadFromMirrors(t.slice(1),e)}))},Utils.getAjaxObject=function(t,e,i,r){t=!0===(r=!1!==r?!0:r)?Aladin.JSONP_PROXY+"?url="+encodeURIComponent(t):t;return e=e||"GET",i=i||null,$.ajax({url:t,method:e,dataType:i})},Utils.isHttpsContext=function(){return"https:"===window.location.protocol},Utils.getAbsoluteURL=function(t){var e=document.createElement("a");return e.href=t,e.href},Utils.uuidv4=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var e=16*Math.random()|0;return("x"==t?e:3&e|8).toString(16)})},URLBuilder=(URLBuilder={buildSimbadCSURL:function(t,e){return t&&"object"==typeof t&&"ra"in t&&"dec"in t&&(t=new Coo(t.ra,t.dec,7).format("s")),"https://alasky.unistra.fr/cgi/simbad-flat/simbad-cs.py?target="+encodeURIComponent(t)+"&SR="+e+"&format=votable&SRUNIT=deg&SORTBY=nbref"},buildNEDPositionCSURL:function(t,e,i){return"https://ned.ipac.caltech.edu/cgi-bin/nph-objsearch?search_type=Near+Position+Search&of=xml_main&RA="+t+"&DEC="+e+"&SR="+i},buildNEDObjectCSURL:function(t,e){return"https://ned.ipac.caltech.edu/cgi-bin/nph-objsearch?search_type=Near+Name+Search&radius="+60*e+"&of=xml_main&objname="+t},buildVizieRCSURL:function(t,e,i,r){e&&"object"==typeof e&&"ra"in e&&"dec"in e&&(e=new Coo(e.ra,e.dec,7).format("s"));var o=1e5;return r&&r.hasOwnProperty("limit")&&Utils.isNumber(r.limit)&&(o=parseInt(r.limit)),"https://vizier.unistra.fr/viz-bin/votable?-source="+t+"&-c="+encodeURIComponent(e)+"&-out.max="+o+"&-c.rd="+i},buildSkyBotCSURL:function(t,e,i,r,o){var s="http://vo.imcce.fr/webservices/skybot/skybotconesearch_query.php?-from=AladinLite";if(s+="&RA="+encodeURIComponent(t),s+="&DEC="+encodeURIComponent(e),s+="&SR="+encodeURIComponent(i),s+="&EPOCH="+encodeURIComponent(r),o)for(var n in o)o.hasOwnProperty(n)&&(s+="&"+n+"="+encodeURIComponent(o[n]));return s}},URLBuilder),MeasurementTable=(MeasurementTable=function(t){this.isShowing=!1,this.divEl=$('<div class="aladin-measurement-div"></div>'),$(t).append(this.divEl)},MeasurementTable.prototype.showMeasurement=function(t){this.divEl.empty();var e="<thead><tr>",i="<tr>";for(key in t.data)e+="<th>"+key+"</th>",i+="<td>"+t.data[key]+"</td>";this.divEl.append("<table>"+(e+="</tr></thead>")+(i+="</tr>")+"</table>"),this.show()},MeasurementTable.prototype.show=function(){this.divEl.show()},MeasurementTable.prototype.hide=function(){this.divEl.hide()},MeasurementTable),Color=(Color={curIdx:0,colors:["#ff0000","#0000ff","#99cc00","#ffff00","#000066","#00ffff","#9900cc","#0099cc","#cc9900","#cc0099","#00cc99","#663333","#ffcc9a","#ff9acc","#ccff33","#660000","#ffcc33","#ff00ff","#00ff00","#ffffff"],getNextColor:function(){var t=Color.colors[Color.curIdx%Color.colors.length];return Color.curIdx++,t},getLabelColorForBackground:function(t){if(rgb=t.match(/^rgb\((\d+),\s*(\d+),\s*(\d+)\)$/),null==rgb)return"#111";r=parseInt(rgb[1]),g=parseInt(rgb[2]),b=parseInt(rgb[3]);return 1-(.299*r+.587*g+.114*b)/255<.5?"#111":"#eee"},componentToHex:function(t){t=t.toString(16);return 1==t.length?"0"+t:t},rgbToHex:function(t,e,i){return"#"+Color.componentToHex(t)+Color.componentToHex(e)+Color.componentToHex(i)},hexToRgb:function(t){t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t);return t?{r:parseInt(t[1],16),g:parseInt(t[2],16),b:parseInt(t[3],16)}:null}},Color),AladinUtils={xyToView:function(t,e,i,r,o,s,n){return(n=null==n?!0:n)?{vx:AladinUtils.myRound(o/2*(1+s*t)-(o-i)/2),vy:AladinUtils.myRound(o/2*(1+s*e)-(o-r)/2)}:{vx:o/2*(1+s*t)-(o-i)/2,vy:o/2*(1+s*e)-(o-r)/2}},viewToXy:function(t,e,i,r,o,s){return{x:((2*t+(o-i))/o-1)/s,y:((2*e+(o-r))/o-1)/s}},radecToViewXy:function(t,e,i,r,o,s,n,a){return(e=r.system!=CooFrameEnum.SYSTEMS.J2000?(r=CooConversion.J2000ToGalactic([t,e]),i.project(r[0],r[1])):i.project(t,e))?AladinUtils.xyToView(e.X,e.Y,o,s,n,a,!1):null},myRound:function(t){return t<0?-1*(0|-t):0|t},isHpxPixVisible:function(t,e,i){for(var r=0;r<t.length;r++)if(-20<=t[r].vx&&t[r].vx<e+20&&-20<=t[r].vy&&t[r].vy<i+20)return!0;return!1},ipixToIpix:function(t,e,i){},getZoomFactorForAngle:function(t,e){var i=0,r=0,o={ra:t,dec:0},t=new Projection(t/2,0);t.setProjection(e);r=t.project(i,r),o=t.project(o.ra,o.dec);return 1/Math.abs(r.X-o.Y)},grow2:function(t,e){for(var i=0,r=0;r<4;r++)null==t[r]&&i++;if(1<i)return t;for(var o=[],r=0;r<4;r++)o.push({vx:t[r].vx,vy:t[r].vy});for(r=0;r<2;r++){var s,n,a,l,h=1==r?1:0,c=1==r?3:2;null==o[h]&&(n=0==h||3==h?(s=1,2):(s=0,3),o[h]={vx:(o[s].vx+o[n].vx)/2,vy:(o[s].vy+o[n].vy)/2}),null==o[c]&&(n=0==c||3==c?(s=1,2):(s=0,3),o[c]={vx:(o[s].vx+o[n].vx)/2,vy:(o[s].vy+o[n].vy)/2}),null!=o[h]&&null!=o[c]&&(a=Math.atan2(o[c].vy-o[h].vy,o[c].vx-o[h].vx),l=e*Math.cos(a),o[h].vx-=l,o[c].vx+=l,l=e*Math.sin(a),o[h].vy-=l,o[c].vy+=l)}return o},SVG_ICONS:{CATALOG:'<svg xmlns="http://www.w3.org/2000/svg"><polygon points="1,0,5,0,5,3,1,3"  fill="FILLCOLOR" /><polygon points="7,0,9,0,9,3,7,3"  fill="FILLCOLOR" /><polygon points="10,0,12,0,12,3,10,3"  fill="FILLCOLOR" /><polygon points="13,0,15,0,15,3,13,3"  fill="FILLCOLOR" /><polyline points="1,5,5,9"  stroke="FILLCOLOR" /><polyline points="1,9,5,5" stroke="FILLCOLOR" /><line x1="7" y1="7" x2="15" y2="7" stroke="FILLCOLOR" stroke-width="2" /><polyline points="1,11,5,15"  stroke="FILLCOLOR" /><polyline points="1,15,5,11"  stroke="FILLCOLOR" /><line x1="7" y1="13" x2="15" y2="13" stroke="FILLCOLOR" stroke-width="2" /></svg>',MOC:'<svg xmlns="http://www.w3.org/2000/svg"><polyline points="0.5,7,2.5,7,2.5,5,7,5,7,3,10,3,10,5,13,5,13,7,15,7,15,9,13,9,13,12,10,12,10,14,7,14,7,12,2.5,12,2.5,10,0.5,10,0.5,7" stroke-width="1" stroke="FILLCOLOR" fill="transparent" /><line x1="1" y1="10" x2="6" y2="5" stroke="FILLCOLOR" stroke-width="0.5" /><line x1="2" y1="12" x2="10" y2="4" stroke="FILLCOLOR" stroke-width="0.5" /><line x1="5" y1="12" x2="12" y2="5" stroke="FILLCOLOR" stroke-width="0.5" /><line x1="7" y1="13" x2="13" y2="7" stroke="FILLCOLOR" stroke-width="0.5" /><line x1="10" y1="13" x2="13" y2="10" stroke="FILLCOLOR" stroke-width="0.5" /></svg>',OVERLAY:'<svg xmlns="http://www.w3.org/2000/svg"><polygon points="10,5,10,1,14,1,14,14,2,14,2,9,6,9,6,5" fill="transparent" stroke="FILLCOLOR" stroke-width="2"/></svg>'}},ProjectionEnum={SIN:Projection.PROJ_SIN,AITOFF:Projection.PROJ_AITOFF},CooFrameEnum=function(){var t={J2000:"J2000",GAL:"Galactic"};return{SYSTEMS:t,J2000:{label:"J2000",system:t.J2000},J2000d:{label:"J2000d",system:t.J2000},GAL:{label:"Galactic",system:t.GAL}}}(),CooFrameEnum.fromString=function(t,e){return t?0==(t=t.toLowerCase().replace(/^\s+|\s+$/g,"")).indexOf("j2000d")||0==t.indexOf("icrsd")?CooFrameEnum.J2000d:0==t.indexOf("j2000")||0==t.indexOf("icrs")?CooFrameEnum.J2000:0==t.indexOf("gal")?CooFrameEnum.GAL:e||null:e||null},HiPSDefinition=function(){function s(t){this.properties=t,this.id=this.getID(),this.obsTitle=t.obs_title,this.frame=t.hips_frame,this.order=parseInt(t.hips_order),this.clientSortKey=t.client_sort_key,this.tileFormats=t.hasOwnProperty("hips_tile_format")&&t.hips_tile_format.split(" "),this.urls=[],this.urls.push(t.hips_service_url);for(var e=1;t.hasOwnProperty("hips_service_url_"+e);)this.urls.push(t["hips_service_url_"+e]),e++;this.clientApplications=t.client_application}s.prototype={getServiceURLs:function(t){},getID:function(){if(this.properties.hasOwnProperty("ID"))return this.properties.ID;var t=null;return t=null!=(t=null==(t=this.properties.hasOwnProperty("creator_did")?this.properties.creator_did:t)&&this.properties.hasOwnProperty("publisher_did")?this.properties.publisher_did:t)?(t="ivo://"===t.slice(0,6)?t.slice(6):t).replace(/\?/g,"/"):t}};var n=[{ID:"CDS/P/2MASS/color",obs_title:"2MASS color J (1.23 microns), H (1.66 microns), K (2.16 microns)",client_sort_key:"04-001-00",client_application:["AladinLite","AladinDesktop"],hips_order:"9",hips_frame:"equatorial",hips_tile_format:"jpeg",hips_service_url:"http://alasky.unistra.fr/2MASS/Color",hips_service_url_1:"http://alaskybis.unistra.fr/2MASS/Color",hips_service_url_2:"https://alaskybis.unistra.fr/2MASS/Color"},{ID:"CDS/P/AKARI/FIS/Color",obs_title:"AKARI Far-infrared All-Sky Survey - color composition WideL/WideS/N60",client_sort_key:"04-05-00",client_application:["AladinLite","AladinDesktop"],hips_order:"5",hips_frame:"equatorial",hips_tile_format:"png jpeg",hips_service_url:"http://alasky.unistra.fr/AKARI-FIS/ColorLSN60",hips_service_url_1:"http://alaskybis.unistra.fr/AKARI-FIS/ColorLSN60",hips_service_url_2:"https://alaskybis.unistra.fr/AKARI-FIS/ColorLSN60"},{ID:"CDS/P/DECaLS/DR3/color",obs_title:"DECaLS DR3 color",hips_frame:"equatorial",hips_order:"11",hips_tile_format:"jpeg",hips_service_url:"http://alasky.unistra.fr/DECaLS/DR3/color"},{ID:"CDS/P/DSS2/blue",obs_title:"DSS2 Blue (XJ+S)",client_sort_key:"03-01-03",client_application:["AladinLite","AladinDesktop"],hips_order:"9",hips_frame:"equatorial",hips_tile_format:"jpeg fits",hips_service_url:"http://alasky.unistra.fr/DSS/DSS2-blue-XJ-S",hips_service_url_1:"http://alaskybis.unistra.fr/DSS/DSS2-blue-XJ-S",hips_service_url_2:"https://alaskybis.unistra.fr/DSS/DSS2-blue-XJ-S",hips_service_url_3:"http://healpix.ias.u-psud.fr/DSS2Blue"},{ID:"CDS/P/DSS2/color",obs_title:"DSS colored",client_sort_key:"03-00",client_application:["AladinLite","AladinDesktop"],hips_order:"9",hips_frame:"equatorial",hips_tile_format:"jpeg",hips_service_url:"http://alasky.unistra.fr/DSS/DSSColor",hips_service_url_1:"http://alaskybis.unistra.fr/DSS/DSSColor",hips_service_url_2:"https://alaskybis.unistra.fr/DSS/DSSColor",hips_service_url_3:"http://healpix.ias.u-psud.fr/DSSColorNew",hips_service_url_4:"http://skies.esac.esa.int/DSSColor/"},{ID:"CDS/P/DSS2/red",obs_title:"DSS2 Red (F+R)",client_sort_key:"03-01-02",client_application:["AladinLite","AladinDesktop"],hips_order:"9",hips_frame:"equatorial",hips_tile_format:"jpeg fits",hips_service_url:"http://alasky.unistra.fr/DSS/DSS2Merged",hips_service_url_1:"http://alaskybis.unistra.fr/DSS/DSS2Merged",hips_service_url_2:"https://alaskybis.unistra.fr/DSS/DSS2Merged",hips_service_url_3:"http://healpix.ias.u-psud.fr/DSS2Merged"},{ID:"P/PanSTARRS/DR1/g",hips_service_url:"http://alasky.u-strasbg.fr/Pan-STARRS/DR1/g",obs_title:"PanSTARRS DR1 g",hips_order:11,hips_frame:"equatorial",hips_tile_format:"jpeg fits"},{ID:"CDS/P/Fermi/color",obs_title:"Fermi Color HEALPix survey",client_sort_key:"00-01-01",client_application:["AladinLite","AladinDesktop"],hips_order:"3",hips_frame:"equatorial",hips_tile_format:"jpeg",hips_service_url:"http://alasky.unistra.fr/Fermi/Color",hips_service_url_1:"http://alaskybis.unistra.fr/Fermi/Color",hips_service_url_2:"https://alaskybis.unistra.fr/Fermi/Color"},{ID:"CDS/P/Finkbeiner",obs_title:"Finkbeiner Halpha composite survey",client_sort_key:"06-01",client_application:["AladinLite","AladinDesktop"],hips_order:"3",hips_frame:"galactic",hips_tile_format:"jpeg fits",hips_service_url:"http://alasky.unistra.fr/FinkbeinerHalpha",hips_service_url_1:"http://alaskybis.unistra.fr/FinkbeinerHalpha",hips_service_url_2:"https://alaskybis.unistra.fr/FinkbeinerHalpha"},{ID:"CDS/P/GALEXGR6/AIS/color",obs_title:"GALEX GR6 AIS (until March 2014)- Color composition",client_sort_key:"02-01-01",client_application:["AladinLite","AladinDesktop"],hips_order:"8",hips_frame:"equatorial",hips_tile_format:"png jpeg",hips_service_url:"http://alasky.unistra.fr/GALEX/GR6-03-2014/AIS-Color",hips_service_url_1:"http://alaskybis.unistra.fr/GALEX/GR6-03-2014/AIS-Color",hips_service_url_2:"https://alaskybis.unistra.fr/GALEX/GR6-03-2014/AIS-Color"},{ID:"CDS/P/IRIS/color",obs_title:"IRAS-IRIS HEALPix survey, color",client_sort_key:"04-02-01",client_application:["AladinLite","AladinDesktop"],hips_order:"3",hips_frame:"galactic",hips_tile_format:"jpeg",hips_service_url:"http://alasky.unistra.fr/IRISColor",hips_service_url_1:"http://alaskybis.unistra.fr/IRISColor",hips_service_url_2:"https://alaskybis.unistra.fr/IRISColor",hips_service_url_3:"http://healpix.ias.u-psud.fr/IRISColor",hips_service_url_4:"http://skies.esac.esa.int/IRISColor/"},{ID:"CDS/P/Mellinger/color",obs_title:"Mellinger optical survey, color",client_sort_key:"03-03",client_application:["AladinLite","AladinDesktop"],hips_order:"4",hips_frame:"galactic",hips_tile_format:"jpeg",hips_service_url:"http://alasky.unistra.fr/MellingerRGB",hips_service_url_1:"http://alaskybis.unistra.fr/MellingerRGB",hips_service_url_2:"https://alaskybis.unistra.fr/MellingerRGB"},{ID:"CDS/P/SDSS9/color",obs_title:"SDSS 9 color",client_sort_key:"03-02-01",client_application:["AladinLite","AladinDesktop"],hips_order:"10",hips_frame:"equatorial",hips_tile_format:"jpeg",hips_service_url:"http://alasky.unistra.fr/SDSS/DR9/color",hips_service_url_1:"http://alaskybis.unistra.fr/SDSS/DR9/color",hips_service_url_2:"https://alaskybis.unistra.fr/SDSS/DR9/color",hips_service_url_3:"http://healpix.ias.u-psud.fr/SDSS9Color",hips_service_url_4:"http://skies.esac.esa.int/SDSS9Color/"},{ID:"CDS/P/SPITZER/color",obs_title:"IRAC HEALPix survey, color",client_sort_key:"04-03-00",client_application:["AladinLite","AladinDesktop"],hips_order:"9",hips_frame:"galactic",hips_tile_format:"jpeg",hips_service_url:"http://alasky.unistra.fr/SpitzerI1I2I4color",hips_service_url_1:"http://alaskybis.unistra.fr/SpitzerI1I2I4color",hips_service_url_2:"https://alaskybis.unistra.fr/SpitzerI1I2I4color",hips_service_url_3:"http://healpix.ias.u-psud.fr/SPITZERColor"},{ID:"CDS/P/allWISE/color",obs_title:"AllWISE color  Red (W4) , Green (W2) , Blue (W1) from raw Atlas Images",client_sort_key:"04-003-00",client_application:["AladinLite","AladinDesktop"],hips_order:"8",hips_frame:"equatorial",hips_tile_format:"jpeg",hips_service_url:"http://alasky.unistra.fr/AllWISE/RGB-W4-W2-W1",hips_service_url_1:"http://alaskybis.unistra.fr/AllWISE/RGB-W4-W2-W1",hips_service_url_2:"https://alaskybis.unistra.fr/AllWISE/RGB-W4-W2-W1"},{ID:"IPAC/P/GLIMPSE360",obs_title:"GLIMPSE360: Spitzer's Infrared Milky Way",client_sort_key:"04-03-0",client_application:["AladinLite","AladinDesktop"],hips_order:"9",hips_frame:"equatorial",hips_tile_format:"jpeg",hips_service_url:"http://www.spitzer.caltech.edu/glimpse360/aladin/data"},{ID:"JAXA/P/MAXI_SSC_SUM",hips_tile_format:"png",hips_frame:"equatorial",obs_title:"MAXI SSC all-sky image integrated for 4.5 years",hips_order:"6",hips_service_url:"http://darts.isas.jaxa.jp/pub/judo2/HiPS/maxi_ssc_sum",hips_service_url_1:"http://alasky.unistra.fr//JAXA/JAXA_P_MAXI_SSC_SUM",hips_service_url_2:"http://alaskybis.unistra.fr//JAXA/JAXA_P_MAXI_SSC_SUM",hips_service_url_3:"https://alaskybis.unistra.fr//JAXA/JAXA_P_MAXI_SSC_SUM"},{ID:"JAXA/P/SWIFT_BAT_FLUX",hips_tile_format:"png",hips_frame:"equatorial",obs_title:"Swift-BAT 70-month all-sray hard X-ray survey image",hips_order:"6",hips_service_url:"http://darts.isas.jaxa.jp/pub/judo2/HiPS/swift_bat_flux/",hips_service_url_1:"http://alasky.unistra.fr//JAXA/JAXA_P_SWIFT_BAT_FLUX",hips_service_url_2:"http://alaskybis.unistra.fr//JAXA/JAXA_P_SWIFT_BAT_FLUX",hips_service_url_3:"https://alaskybis.unistra.fr//JAXA/JAXA_P_SWIFT_BAT_FLUX"},{ID:"ov-gso/P/VTSS/Ha",obs_title:"Virginia Tech Spectral-Line Survey (VTSS) - Halpha image",client_sort_key:"06-xx",client_application:["AladinLite","AladinDesktop"],hips_order:"3",hips_frame:["galactic","galactic"],hips_tile_format:"png jpeg fits",hips_service_url:"http://cade.irap.omp.eu/documents/Ancillary/4Aladin/VTSS",hips_service_url_1:"http://alasky.unistra.fr/IRAP/VTSS",hips_service_url_2:"http://alaskybis.unistra.fr/IRAP/VTSS",hips_service_url_3:"https://alaskybis.unistra.fr/IRAP/VTSS"},{ID:"xcatdb/P/XMM/EPIC",obs_title:"XMM-Newton stacked EPIC images",hips_frame:"equatorial",hips_order:"7",hips_service_url:"http://saada.u-strasbg.fr/xmmallsky",hips_tile_format:"png fits",hips_service_url_1:"http://alasky.unistra.fr/SSC/xmmallsky",hips_service_url_2:"http://alaskybis.unistra.fr/SSC/xmmallsky",hips_service_url_3:"https://alaskybis.unistra.fr/SSC/xmmallsky"},{ID:"xcatdb/P/XMM/PN/color",obs_title:"False color X-ray images (Red=0.5-1 Green=1-2 Blue=2-4.5)Kev",hips_order:"7",hips_frame:"equatorial",hips_tile_format:"png jpeg",hips_service_url:"http://saada.unistra.fr/PNColor",hips_service_url_1:"http://alasky.u-strasbg.fr/SSC/xcatdb_P_XMM_PN_color",hips_service_url_2:"http://alaskybis.u-strasbg.fr/SSC/xcatdb_P_XMM_PN_color",hips_service_url_3:"https://alaskybis.u-strasbg.fr/SSC/xcatdb_P_XMM_PN_color"}],a=[];s.LOCAL_STORAGE_KEY="aladin:hips-list";var l="_timestamp_retrieved",h="_last_used_url";s.getLocalStorageDefinitions=function(){try{var t=window.localStorage.getItem(s.LOCAL_STORAGE_KEY);return null===t?[]:window.JSON.parse(t)}catch(t){return[]}},s.storeInLocalStorage=function(t){try{window.localStorage.setItem(s.LOCAL_STORAGE_KEY,window.JSON.stringify(t))}catch(t){return!1}return!0};var o=["http://alasky.u-strasbg.fr/MocServer/query","http://alaskybis.u-strasbg.fr/MocServer/query"],c=["https://alasky.u-strasbg.fr/MocServer/query","https://alaskybis.unistra.fr/MocServer/query"];s.getRemoteDefinitions=function(t,e,i){(t=t||{client_application:"AladinLite"}).fmt="json",t.fields="ID,obs_title,client_sort_key,client_application,hips_service_url*,hips_order,hips_tile_format,hips_frame";var r=Utils.isHttpsContext()?c:o;Utils.loadFromMirrors(r,{data:t,onSuccess:function(t){"function"==typeof e&&e(t)},onFailure:function(){console.error("Could not load HiPS definitions from urls "+r),"function"==typeof i&&i()},timeout:5})};function u(t,e){for(var i=[],r={},o=0;o<e.length;o++)r[(s=e[o]).ID]=s;for(o=0;o<t.length;o++){var s,n=(s=t[o]).ID;r.hasOwnProperty(n)?(n=r[n],s.hasOwnProperty(h)&&!n.hasOwnProperty(h)&&(n[h]=s[h]),i.push(n)):i.push(s)}return i}return s.CACHE_RETENTION_TIME_SECONDS=604800,s.init=function(){a=n;for(var t=s.getLocalStorageDefinitions(),e=(new Date).getTime(),i=[],r=0;r<t.length;r++){var o=t[r];o.hasOwnProperty(l)&&e-o[l]>1e3*s.CACHE_RETENTION_TIME_SECONDS&&i.push(r)}for(r=i.length-1;0<=r;r--)t.splice(i[r],1);a=u(a,t),s.getRemoteDefinitions({dataproduct_type:"image",client_application:"AladinLite"},function(t){for(var e=(new Date).getTime(),i=0;i<t.length;i++)t[i][l]=e;a=u(a,t),s.storeInLocalStorage(a)})},s.getALDefaultHiPSDefinitions=function(){for(var t=[],e=0;e<a.length;e++){var i=a[e];!i.hasOwnProperty("client_application")||i.client_application.indexOf("AladinLite")<0||t.push(new s(i))}return t},s.getDefinitions=function(){for(var t=[],e=0;e<a.length;e++){var i=a[e];t.push(new s(i))}return t},s.parseHiPSProperties=function(t){if(null==t)return null;for(var e={},i=(t=t.replace(/[\r]/g,"")).split("\n"),r=0;r<i.length;r++){var o,s,n=$.trim(i[r]);"#"!==n.slice(0,1)&&((s=n.indexOf("="))<0||(o=$.trim(n.slice(0,s)),s=$.trim(n.slice(s+1)),e[o]=s))}return e},s.findByID=function(t,e){var i=findByIDLocal(t);0<i.length?"function"==typeof e&&e(i):findByIDRemote(t,e)},s.findByIDLocal=function(t,e){for(var i=[],r=0;r<a.length;r++){var o=a[r];null!=o.ID.match(t)&&i.push(new s(o))}return i},s.findByIDRemote=function(t,e){s.findHiPSRemote({ID:"*"+t+"*"},e)},s.findHiPSRemote=function(t,r){(t=t||{}).hasOwnProperty("dataproduct_type")||(t.dataproduct_type="image"),s.getRemoteDefinitions(t,function(t){for(var e=[],i=0;i<t.length;i++)e.push(new s(t[i]));"function"==typeof r&&r(e)})},s.fromURL=function(t,e){var i,r;"properties"===t.slice(-10)?i=(r=t).slice(0,-11):("/"===t.slice(-1)&&(t=t.slice(0,-1)),r=(i=t)+"/properties");function o(t){(t=s.parseHiPSProperties(t)).hasOwnProperty("hips_service_url")||(t.hips_service_url=i),"function"==typeof e&&e(new s(t))}Utils.getAjaxObject(r,"GET","text",!1).done(function(t){o(t)}).fail(function(){Utils.getAjaxObject(r,"GET","text",!0).done(function(t){o(t)}).fail(function(){"function"==typeof e&&e(null)})})},s.fromProperties=function(t){return new s(t)},s.init(),s}(),Downloader=function(){function t(t){this.dlQueue=[],this.urlsInQueue={},this.view=t,this.nbDownloads=0}return t.prototype.emptyQueue=function(){this.dlQueue=[];var t,e,i=[];for([t,e]of Object.entries(this.urlsInQueue))i.push(e);return this.urlsInQueue={},i},t.prototype.requestDownload=function(t,e,i){e in this.urlsInQueue||(this.dlQueue.push({img:t,url:e,cors:i}),this.urlsInQueue[e]=1,this.tryDownload())},t.prototype.tryDownload=function(){for(;0<this.dlQueue.length&&this.nbDownloads<8;)this.startDownloadNext()},t.prototype.startDownloadNext=function(){var e=this.dlQueue.shift();if(e){var t=new Blob(["self.addEventListener('message', async event => {const imageURL = event.data;const response = await fetch(imageURL);const blob = await response.blob();self.postMessage(imageURL: imageURL,blob: blob});})"],{type:"application/javascript"});this.nbDownloads++;var i=this;const r=new Worker(t);r.addEventListener("message",t=>{t=t.data,t=URL.createObjectURL(t.blob);e.img.onload=function(){i.completeDownload(this,!0)},e.img.onerror=function(t){i.completeDownload(this,!1)},e.cors?e.img.crossOrigin="anonymous":void 0!==e.img.crossOrigin&&delete e.img.crossOrigin,e.img.src=t});t=e.url;r.postMessage(t)}},t.prototype.completeDownload=function(t,e){delete this.urlsInQueue[t.src],t.onerror=null,t.onload=null,this.nbDownloads--,e?this.view.requestRedraw():t.dlError=!0,this.tryDownload()},t}(),function(){function t(t,e){for(var i in e)o.call(e,i)&&(t[i]=e[i]);function r(){this.constructor=t}return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t}var e,u,p,f,i,s,r,o={}.hasOwnProperty,n=[].slice;function a(){}function l(t,e,i){var r,o=this;this.arg=t,this.callback=e,this.opts=i,this.hdus=[],this.blockCount=0,this.begin=0,this.end=this.BLOCKLENGTH,this.offset=0,this.headerStorage=new Uint8Array,"string"==typeof this.arg?(this.readNextBlock=this._readBlockFromBuffer,(r=new XMLHttpRequest).open("GET",this.arg),r.responseType="arraybuffer",r.onerror=function(){o.invoke(o.callback,o.opts)},r.onload=function(){if(200===r.status)return o.arg=r.response,o.length=o.arg.byteLength,o.readFromBuffer();o.invoke(o.callback,o.opts)},r.send()):(this.length=this.arg.size,this.readNextBlock=this._readBlockFromFile,this.readFromFile())}function h(t,e,i){var r,o=this;this.arg=t,r=new s(this.arg,function(t){return o.hdus=r.hdus,o.invoke(e,i,o)})}function c(t,e){e instanceof ArrayBuffer?this.buffer=e:this.blob=e}function d(t){var e,i,r;for(i in this.primary=!1,this.extension=!1,this.verifyCard={},r=this.VerifyFns)e=r[i],this.verifyCard[i]=this.proxy(e);this.cards={},this.cards.COMMENT=[],this.cards.HISTORY=[],this.cardIndex=0,this.block=t,this.readBlock(t)}function g(t,e){var i,r,o,s,n,a,l;for(g.__super__.constructor.apply(this,arguments),s=t.get("NAXIS"),this.bitpix=t.get("BITPIX"),this.naxis=[],o=n=1;1<=s?n<=s:s<=n;o=1<=s?++n:--n)this.naxis.push(t.get("NAXIS"+o));for(this.width=t.get("NAXIS1"),this.height=t.get("NAXIS2")||1,this.depth=t.get("NAXIS3")||1,this.bzero=t.get("BZERO")||0,this.bscale=t.get("BSCALE")||1,this.bytes=Math.abs(this.bitpix)/8,this.length=this.naxis.reduce(function(t,e){return t*e})*Math.abs(this.bitpix)/8,this.frame=0,this.frameOffsets=[],this.frameLength=this.bytes*this.width*this.height,this.nBuffers=null!=this.buffer?1:2,o=a=0,l=this.depth-1;0<=l?a<=l:l<=a;o=0<=l?++a:--a)r={begin:i=o*this.frameLength},null!=this.buffer&&(r.buffers=[this.buffer.slice(i,i+this.frameLength)]),this.frameOffsets.push(r)}function v(t,e){v.__super__.constructor.apply(this,arguments),this.rowByteSize=t.get("NAXIS1"),this.rows=t.get("NAXIS2"),this.cols=t.get("TFIELDS"),this.length=this.rowByteSize*this.rows,this.heapLength=t.get("PCOUNT"),this.columns=this.getColumns(t),null!=this.buffer?(this.rowsInMemory=this._rowsInMemoryBuffer,this.heap=this.buffer.slice(this.length,this.length+this.heapLength)):(this.rowsInMemory=this._rowsInMemoryBlob,this.firstRowInBuffer=this.lastRowInBuffer=0,this.nRowsInBuffer=Math.floor(this.maxMemory/this.rowByteSize)),this.accessors=[],this.descriptors=[],this.elementByteLengths=[],this.setAccessors(t)}function m(){return m.__super__.constructor.apply(this,arguments)}function y(){return y.__super__.constructor.apply(this,arguments)}function S(t,e){var i,r,o,s,n,a;for(S.__super__.constructor.apply(this,arguments),this.zcmptype=t.get("ZCMPTYPE"),this.zbitpix=t.get("ZBITPIX"),this.znaxis=t.get("ZNAXIS"),this.zblank=t.get("ZBLANK"),this.blank=t.get("BLANK"),this.zdither=t.get("ZDITHER0")||0,this.ztile=[],i=n=1,a=this.znaxis;1<=a?n<=a:a<=n;i=1<=a?++n:--n)s=t.contains("ZTILE"+i)?t.get("ZTILE"+i):1===i?t.get("ZNAXIS1"):1,this.ztile.push(s);for(this.width=t.get("ZNAXIS1"),this.height=t.get("ZNAXIS2")||1,this.algorithmParameters={},"RICE_1"===this.zcmptype&&(this.algorithmParameters.BLOCKSIZE=32,this.algorithmParameters.BYTEPIX=4),i=1;;){if(!t.contains(r="ZNAME"+i))break;o="ZVAL"+i,this.algorithmParameters[t.get(r)]=t.get(o),i+=1}this.zmaskcmp=t.get("ZMASKCMP"),this.zquantiz=t.get("ZQUANTIZ")||"LINEAR_SCALING",this.bzero=t.get("BZERO")||0,this.bscale=t.get("BSCALE")||1}function w(t,e){this.header=t,this.data=e}null==this.astro&&(this.astro={}),a.include=function(t){var e,i;for(e in t)i=t[e],this.prototype[e]=i;return this},a.extend=function(t){var e,i;for(e in t)i=t[e],this[e]=i;return this},a.prototype.proxy=function(t){var e=this;return function(){return t.apply(e,arguments)}},a.prototype.invoke=function(t,e,i){var r=null!=(null!=e?e.context:void 0)?e.context:this;if(null!=t)return t.call(r,i,e)},t(l,e=a),l.prototype.LINEWIDTH=80,l.prototype.BLOCKLENGTH=2880,File.prototype.slice=File.prototype.slice||File.prototype.webkitSlice,Blob.prototype.slice=Blob.prototype.slice||Blob.prototype.webkitSlice,l.prototype.readFromBuffer=function(){var t=this.arg.slice(this.begin+this.offset,this.end+this.offset);return this.readBlock(t)},l.prototype.readFromFile=function(){var t,e=this;return this.reader=new FileReader,this.reader.onloadend=function(t){return e.readBlock(t.target.result)},t=this.arg.slice(this.begin+this.offset,this.end+this.offset),this.reader.readAsArrayBuffer(t)},l.prototype.readBlock=function(t){var e,i,r,o,s,n,a,l,h,c,u=new Uint8Array(t),d=new Uint8Array(this.headerStorage);for(this.headerStorage=new Uint8Array(this.end),this.headerStorage.set(d,0),this.headerStorage.set(u,this.begin),o=this.BLOCKLENGTH/this.LINEWIDTH;o--;)if(32!==u[n=o*this.LINEWIDTH]){if(69!==u[n]||78!==u[1+n]||68!==u[2+n]||32!==u[3+n])break;for(s="",l=0,h=(c=this.headerStorage).length;l<h;l++)a=c[l],s+=String.fromCharCode(a);return(r=new f(s),this.start=this.end+this.offset,e=r.getDataLength(),n=this.arg.slice(this.start,this.start+e),r.hasDataUnit()&&(i=this.createDataUnit(r,n)),this.hdus.push(new p(r,i)),this.offset+=this.end+e+this.excessBytes(e),this.offset===this.length)?(this.headerStorage=null,void this.invoke(this.callback,this.opts,this)):(this.blockCount=0,this.begin=this.blockCount*this.BLOCKLENGTH,this.end=this.begin+this.BLOCKLENGTH,this.headerStorage=new Uint8Array,t=this.arg.slice(this.begin+this.offset,this.end+this.offset),void this.readNextBlock(t))}this.blockCount+=1,this.begin=this.blockCount*this.BLOCKLENGTH,this.end=this.begin+this.BLOCKLENGTH,t=this.arg.slice(this.begin+this.offset,this.end+this.offset),this.readNextBlock(t)},l.prototype._readBlockFromBuffer=function(t){return this.readBlock(t)},l.prototype._readBlockFromFile=function(t){return this.reader.readAsArrayBuffer(t)},l.prototype.createDataUnit=function(t,e){var i=t.getDataType();return new astro.FITS[i](t,e)},l.prototype.excessBytes=function(t){return(this.BLOCKLENGTH-t%this.BLOCKLENGTH)%this.BLOCKLENGTH},l.prototype.isEOF=function(){return this.offset===this.length},s=l,t(h,e),h.prototype.getHDU=function(t){var e,i,r,o;if(null!=t&&null!=this.hdus[t])return this.hdus[t];for(i=0,r=(o=this.hdus).length;i<r;i++)if((e=o[i]).hasData())return e},h.prototype.getHeader=function(t){return this.getHDU(t).header},h.prototype.getDataUnit=function(t){return this.getHDU(t).data},(i=h).version="0.6.5",this.astro.FITS=i,t(c,e),(c.swapEndian={B:function(t){return t},I:function(t){return t<<8|t>>8},J:function(t){return(255&t)<<24|(65280&t)<<8|t>>8&65280|t>>24&255}})[8]=c.swapEndian.B,c.swapEndian[16]=c.swapEndian.I,c.swapEndian[32]=c.swapEndian.J,this.astro.FITS.DataUnit=r=c,i={verifyOrder:function(t,e){if(e!==this.cardIndex)return console.warn(t+" should appear at index "+this.cardIndex+" in the FITS header")},verifyBetween:function(t,e,i,r){if(!(i<=e&&e<=r))throw"The "+t+" value of "+e+" is not between "+i+" and "+r},verifyBoolean:function(t){return"T"===t},VerifyFns:{SIMPLE:function(){1<=arguments.length&&n.call(arguments,0);var t=arguments[0];return this.primary=!0,this.verifyOrder("SIMPLE",0),this.verifyBoolean(t)},XTENSION:function(){1<=arguments.length&&n.call(arguments,0);return this.extension=!0,this.extensionType=arguments[0],this.verifyOrder("XTENSION",0),this.extensionType},BITPIX:function(){1<=arguments.length&&n.call(arguments,0);var t=parseInt(arguments[0]);if(this.verifyOrder("BITPIX",1),8!==t&&16!==t&&32!==t&&-32!==t&&-64!==t)throw"BITPIX value "+t+" is not permitted";return t},NAXIS:function(){1<=arguments.length&&n.call(arguments,0);var t="NAXIS",e=parseInt(arguments[0]),i=arguments[1];if(!i&&(this.verifyOrder(t,2),this.verifyBetween(t,e,0,999),this.isExtension()&&("TABLE"===(i=this.extensionType)||"BINTABLE"===i)&&2!==e))throw t+" must be 2 for TABLE and BINTABLE extensions";return e},PCOUNT:function(){1<=arguments.length&&n.call(arguments,0);var t=parseInt(arguments[0]),e=3+this.get("NAXIS");if(this.verifyOrder("PCOUNT",e),this.isExtension()&&("IMAGE"===(e=this.extensionType)||"TABLE"===e)&&0!==t)throw"PCOUNT must be 0 for the "+this.extensionType+" extensions";return t},GCOUNT:function(){1<=arguments.length&&n.call(arguments,0);var t=parseInt(arguments[0]),e=3+this.get("NAXIS")+1;if(this.verifyOrder("GCOUNT",e),this.isExtension()&&("IMAGE"===(e=this.extensionType)||"TABLE"===e||"BINTABLE"===e)&&1!==t)throw"GCOUNT must be 1 for the "+this.extensionType+" extensions";return t},EXTEND:function(){1<=arguments.length&&n.call(arguments,0);var t=arguments[0];if(!this.isPrimary())throw"EXTEND must only appear in the primary header";return this.verifyBoolean(t)},BSCALE:function(){1<=arguments.length&&n.call(arguments,0);return parseFloat(arguments[0])},BZERO:function(){1<=arguments.length&&n.call(arguments,0);return parseFloat(arguments[0])},BLANK:function(){1<=arguments.length&&n.call(arguments,0);var t=arguments[0];return 0<this.get("BITPIX")||console.warn("BLANK is not to be used for BITPIX = "+this.get("BITPIX")),parseInt(t)},DATAMIN:function(){1<=arguments.length&&n.call(arguments,0);return parseFloat(arguments[0])},DATAMAX:function(){1<=arguments.length&&n.call(arguments,0);return parseFloat(arguments[0])},EXTVER:function(){1<=arguments.length&&n.call(arguments,0);return parseInt(arguments[0])},EXTLEVEL:function(){1<=arguments.length&&n.call(arguments,0);return parseInt(arguments[0])},TFIELDS:function(){1<=arguments.length&&n.call(arguments,0);var t=parseInt(arguments[0]);return this.verifyBetween("TFIELDS",t,0,999),t},TBCOL:function(){1<=arguments.length&&n.call(arguments,0);var t=arguments[0];return this.verifyBetween("TBCOL",arguments[2],0,this.get("TFIELDS")),t},ZIMAGE:function(){1<=arguments.length&&n.call(arguments,0);return this.verifyBoolean(arguments[0])},ZCMPTYPE:function(){1<=arguments.length&&n.call(arguments,0);var t=arguments[0];if("GZIP_1"!==t&&"RICE_1"!==t&&"PLIO_1"!==t&&"HCOMPRESS_1"!==t)throw"ZCMPTYPE value "+t+" is not permitted";if("RICE_1"!==t)throw"Compress type "+t+" is not yet implement";return t},ZBITPIX:function(){1<=arguments.length&&n.call(arguments,0);var t=parseInt(arguments[0]);if(8!==t&&16!==t&&32!==t&&64!==t&&-32!==t&&-64!==t)throw"ZBITPIX value "+t+" is not permitted";return t},ZNAXIS:function(){1<=arguments.length&&n.call(arguments,0);var t=parseInt(arguments[0]);return arguments[1]||this.verifyBetween("ZNAXIS",t,0,999),t},ZTILE:function(){1<=arguments.length&&n.call(arguments,0);return parseInt(arguments[0])},ZSIMPLE:function(){1<=arguments.length&&n.call(arguments,0);return"T"===arguments[0]},ZPCOUNT:function(){1<=arguments.length&&n.call(arguments,0);return parseInt(arguments[0])},ZGCOUNT:function(){1<=arguments.length&&n.call(arguments,0);return parseInt(arguments[0])},ZDITHER0:function(){1<=arguments.length&&n.call(arguments,0);return parseInt(arguments[0])}}},this.astro.FITS.HeaderVerify=i,t(d,e),d.include(i),d.prototype.arrayPattern=/(\D+)(\d+)/,d.prototype.maxLines=600,d.prototype.get=function(t){return this.contains(t)?this.cards[t].value:null},d.prototype.set=function(t,e,i){return this.cards[t]={index:this.cardIndex,value:e,comment:i=i||""},this.cardIndex+=1},d.prototype.contains=function(t){return this.cards.hasOwnProperty(t)},d.prototype.readLine=function(t){var e,i=t.slice(0,8).trim();if(!(""===i)){if(e=t.slice(8,10),t=t.slice(10),"= "===e)return t=(e=t.split(" /"))[0],e=e[1],"'"===(t=t.trim())[0]?t=t.slice(1,-1).trim():"T"!==t&&"F"!==t&&(t=parseFloat(t)),t=this.validate(i,t),this.set(i,t,e);"COMMENT"!==i&&"HISTORY"!==i||this.cards[i].push(t.trim())}},d.prototype.validate=function(t,e){var i=null,r=t,o=this.arrayPattern.test(t);return o&&(r=(t=this.arrayPattern.exec(t).slice(1))[0],i=t[1]),e=r in this.verifyCard?this.verifyCard[r](e,o,i):e},d.prototype.readBlock=function(t){for(var e,i,r=t.length/80,o=[],s=i=0,n=(r=r<this.maxLines?r:this.maxLines)-1;0<=n?i<=n:n<=i;s=0<=n?++i:--i)e=t.slice(80*s,80*(s+1)),o.push(this.readLine(e));return o},d.prototype.hasDataUnit=function(){return 0!==this.get("NAXIS")},d.prototype.getDataLength=function(){var t,e,i,r,o;if(!this.hasDataUnit())return 0;for(i=[],t=r=1,o=this.get("NAXIS");1<=o?r<=o:o<=r;t=1<=o?++r:--r)i.push(this.get("NAXIS"+t));return e=i.reduce(function(t,e){return t*e})*Math.abs(this.get("BITPIX"))/8,e+=this.get("PCOUNT")},d.prototype.getDataType=function(){switch(this.extensionType){case"BINTABLE":return this.contains("ZIMAGE")?"CompressedImage":"BinaryTable";case"TABLE":return"Table";default:return this.hasDataUnit()?"Image":null}},d.prototype.isPrimary=function(){return this.primary},d.prototype.isExtension=function(){return this.extension},f=d,this.astro.FITS.Header=f,i={getExtent:function(t){for(var e,i,r,o=t.length;o--;)if(r=t[o],!isNaN(r)){i=e=r;break}if(-1===o)return[NaN,NaN];for(;o--;)r=t[o],isNaN(r)||(r<i&&(i=r),e<r&&(e=r));return[i,e]},getPixel:function(t,e,i){return t[i*this.width+e]}},this.astro.FITS.ImageUtils=i,t(g,r),g.include(i),g.prototype.allocationSize=16777216,g.prototype._getFrame=function(t,e,i,r){var o,s,n,a,l,h=Math.abs(e)/8,c=s=t.byteLength/h;Math.abs(e);if(0<e){switch(e){case 8:a=new Uint8Array(t),a=new Uint16Array(a),n=function(t){return t};break;case 16:a=new Int16Array(t),n=function(t){return(255&t)<<8|t>>8&255};break;case 32:a=new Int32Array(t),n=function(t){return(255&t)<<24|(65280&t)<<8|t>>8&65280|t>>24&255}}for(o=parseInt(i)!==i||parseInt(r)!==r?new Float32Array(a.length):a;c--;)a[c]=n(a[c]),o[c]=i+r*a[c]}else{for(o=new Uint32Array(t),n=function(t){return(255&t)<<24|(65280&t)<<8|t>>8&65280|t>>24&255};s--;)l=o[s],o[s]=n(l);for(o=new Float32Array(t);c--;)o[c]=i+r*o[c]}return o},g.prototype._getFrameAsync=function(e,i,r){var o,t,s,n,a,l,h,c,u,d,p=this,f=function(t){var e=t.data,i=e.buffer,r=e.bitpix,o=e.bzero,t=e.bscale,e=e.url;return importScripts(e),t=_getFrame(i,r,o,t),postMessage(t)}.toString().replace("return postMessage","postMessage");f="onmessage = "+f,t=(t=this._getFrame.toString()).replace("function","function _getFrame"),n="application/javascript",f=new Blob([f],{type:n}),n=new Blob([t],{type:n}),o=window.URL||window.webkitURL,u=o.createObjectURL(f),c=o.createObjectURL(n),d=new Worker(u),a={buffer:e[0],bitpix:this.bitpix,bzero:this.bzero,bscale:this.bscale,url:c},l=null,h=s=0,d.onmessage=function(t){t=t.data;return(l=null==l?new t.constructor(p.width*p.height):l).set(t,h),h+=t.length,(s+=1)===p.nBuffers?(p.invoke(i,r,l),o.revokeObjectURL(u),o.revokeObjectURL(c),d.terminate()):(a.buffer=e[s],d.postMessage(a,[e[s]]))},d.postMessage(a,[e[0]])},g.prototype.getFrame=function(e,i,r){var t,o,s,n,a,l,h,c,u,d,p=this;if(this.frame=e||this.frame,(null!=(s=(a=this.frameOffsets[this.frame]).buffers)?s.length:void 0)===this.nBuffers)return this._getFrameAsync(s,i,r);for(this.frameOffsets[this.frame].buffers=[],a=a.begin,t=this.blob.slice(a,a+this.frameLength),o=[],n=Math.floor(this.height/this.nBuffers)*this.bytes*this.width,l=u=0,d=this.nBuffers-1;0<=d?u<=d:d<=u;l=0<=d?++u:--u)c=l*n,l===this.nBuffers-1?o.push(t.slice(c)):o.push(t.slice(c,c+n));return s=[],(h=new FileReader).frame=this.frame,l=0,h.onloadend=function(t){return e=t.target.frame,t=t.target.result,p.frameOffsets[e].buffers.push(t),(l+=1)===p.nBuffers?p.getFrame(e,i,r):h.readAsArrayBuffer(o[l])},h.readAsArrayBuffer(o[0])},g.prototype.getFrames=function(i,r,o,t){var s=this,n=function(t,e){if(s.invoke(o,e,t),i+=1,--r)return s.getFrame(i,n,e)};return this.getFrame(i,n,t)},g.prototype.isDataCube=function(){return 2<this.naxis.length},this.astro.FITS.Image=g,t(v,r),v.prototype.maxMemory=1048576,v.prototype._rowsInMemoryBuffer=function(){return!0},v.prototype._rowsInMemoryBlob=function(t,e){return!(t<this.firstRowInBuffer)&&!(e>this.lastRowInBuffer)},v.prototype.getColumns=function(t){for(var e,i,r=[],o=i=1,s=this.cols;1<=s?i<=s:s<=i;o=1<=s?++i:--i){if(!t.contains(e="TTYPE"+o))return null;r.push(t.get(e))}return r},v.prototype.getColumn=function(i,s,t){var n,a,l,h,e,c,u,d,p,f=this;return null!=this.blob?(u=this.columns.indexOf(i),e=this.descriptors[u],n=this.accessors[u],this.elementByteLengths[u],h=0===(h=this.elementByteLengths.slice(0,u)).length?0:h.reduce(function(t,e){return t+e}),l=null!=this.typedArray[e]?new this.typedArray[e](this.rows):[],p=~~(this.maxMemory/this.rowByteSize),p=Math.min(p,this.rows),e=this.rows/p,d=Math.floor(e)===e?e:Math.floor(e)+1,u=c=0,a=function(t,e){for(var i=t.byteLength/f.rowByteSize,r=new DataView(t),o=h;i--;)l[c]=n(r,o)[0],c+=1,o+=f.rowByteSize;if(u+=1,--d)return t=u*p,f.getTableBuffer(t,p,a,e);f.invoke(s,e,l)},this.getTableBuffer(0,p,a,t)):(a=function(t,e){return l=t.map(function(t){return t[i]}),f.invoke(s,e,l)},this.getRows(0,this.rows,a,t))},v.prototype.getTableBuffer=function(t,e,i,r){var o,s,n=this;return e=Math.min(this.rows-t,e),s=(o=t*this.rowByteSize)+e*this.rowByteSize,o=this.blob.slice(o,s),(s=new FileReader).row=t,s.number=e,s.onloadend=function(t){return n.invoke(i,r,t.target.result)},s.readAsArrayBuffer(o)},v.prototype.getRows=function(e,i,r,o){var t,s,n,a=this;return this.rowsInMemory(e,e+i)?(n=null!=this.blob?this.buffer:(s=(t=e*this.rowByteSize)+i*this.rowByteSize,this.buffer.slice(t,s)),n=this._getRows(n,i),this.invoke(r,o,n),n):(s=(t=e*this.rowByteSize)+Math.max(this.nRowsInBuffer*this.rowByteSize,i*this.rowByteSize),t=this.blob.slice(t,s),(s=new FileReader).row=e,s.number=i,s.onloadend=function(t){t=t.target;return a.buffer=t.result,a.firstRowInBuffer=a.lastRowInBuffer=t.row,a.lastRowInBuffer+=t.number,a.getRows(e,i,r,o)},s.readAsArrayBuffer(t))},this.astro.FITS.Tabular=r=v,t(m,r),m.prototype.dataAccessors={A:function(t){return t.trim()},I:function(t){return parseInt(t)},F:function(t){return parseFloat(t)},E:function(t){return parseFloat(t)},D:function(t){return parseFloat(t)}},m.prototype.setAccessors=function(t){for(var e,i,r=this,o=/([AIFED])(\d+)\.*(\d+)*/,s=[],n=i=1,a=this.cols;1<=a?i<=a:a<=i;n=1<=a?++i:--i)e=t.get("TFORM"+n),t.get("TTYPE"+n),e=o.exec(e)[1],s.push(function(e){var t=function(t){return r.dataAccessors[e](t)};return r.accessors.push(t)}(e));return s},m.prototype._getRows=function(t){for(var e,i,r,o,s,n,a,l,h,c,u,d,p,f,g=t.byteLength/this.rowByteSize,v=new Uint8Array(t),m=[],y=h=0,S=g-1;0<=S?h<=S:S<=h;y=0<=S?++h:--h){for(r=(i=y*this.rowByteSize)+this.rowByteSize,s="",c=0,d=(a=v.subarray(i,r)).length;c<d;c++)l=a[c],s+=String.fromCharCode(l);for(s=s.trim().split(/\s+/),n={},o=u=0,p=(f=this.accessors).length;u<p;o=++u)e=f[o],l=s[o],n[this.columns[o]]=e(l);m.push(n)}return m},this.astro.FITS.Table=m,t(y,r),y.prototype.typedArray={B:Uint8Array,I:Uint16Array,J:Uint32Array,E:Float32Array,D:Float64Array,1:Uint8Array,2:Uint16Array,4:Uint32Array},y.offsets={L:1,B:1,I:2,J:4,K:8,A:1,E:4,D:8,C:8,M:16},y.prototype.dataAccessors={L:function(t,e){return[84===t.getInt8(e),e+=1]},B:function(t,e){return[t.getUint8(e),e+=1]},I:function(t,e){return[t.getInt16(e),e+=2]},J:function(t,e){return[t.getInt32(e),e+=4]},K:function(t,e){var i,r=Math.abs(t.getInt32(e));return e+=4,[((i=r%10)?-1:1)*((r-=i)<<32|Math.abs(t.getInt32(e))),e+=4]},A:function(t,e){t=t.getUint8(e);return[t=String.fromCharCode(t),e+=1]},E:function(t,e){return[t.getFloat32(e),e+=4]},D:function(t,e){return[t.getFloat64(e),e+=8]},C:function(t,e){return[[t.getFloat32(e),t.getFloat32(e+=4)],e+=4]},M:function(t,e){return[[t.getFloat64(e),t.getFloat64(e+=8)],e+=8]}},y.prototype.toBits=function(t){for(var e=[],i=128;1<=i;)e.push(t&i?1:0),i/=2;return e},y.prototype.getFromHeap=function(t,e,i){var r,o,s=t.getInt32(e),t=t.getInt32(e+=4);for(e+=4,s=this.heap.slice(t,t+s),o=(r=new this.typedArray[i](s)).length;o--;)r[o]=this.constructor.swapEndian[i](r[o]);return[r,e]},y.prototype.setAccessors=function(t){for(var e,i,r,o,s,h=this,n=/(\d*)([P|Q]*)([L|X|B|I|J|K|A|E|D|C|M]{1})/,a=[],c=s=1,l=this.cols;1<=l?s<=l:l<=s;c=1<=l?++s:--s)e=t.get("TFORM"+c),o=t.get("TTYPE"+c),r=n.exec(e),e=parseInt(r[1])||1,i=r[2],r=r[3],a.push(function(s,a){var t,l;if(h.descriptors.push(s),h.elementByteLengths.push(h.constructor.offsets[s]*a),i)switch(o){case"COMPRESSED_DATA":t=function(t,e){var i=h.getFromHeap(t,e,s),t=i[0];return e=i[1],i=new h.typedArray[h.algorithmParameters.BYTEPIX](h.ztile[0]),u.Rice(t,h.algorithmParameters.BLOCKSIZE,h.algorithmParameters.BYTEPIX,i,h.ztile[0],u.RiceSetup),[i,e]};break;case"GZIP_COMPRESSED_DATA":t=function(t,e){var i=new Float32Array(h.width);for(c=i.length;c--;)i[c]=NaN;return[i,e]};break;default:t=function(t,e){return h.getFromHeap(t,e,s)}}else t=1===a?function(t,e){t=h.dataAccessors[s](t,e);return[t[0],e=t[1]]}:"X"===s?(l=Math.log(a)/Math.log(2),function(t,e){for(var i,t=t.buffer.slice(e,e+l),r=new Uint8Array(t),o=[],s=0,n=r.length;s<n;s++)i=r[s],i=h.toBits(i),o=o.concat(i);return e+=l,[o.slice(0,+(a-1)+1||9e9),e]}):"A"===s?function(t,e){for(var i,t=t.buffer.slice(e,e+a),r=new Uint8Array(t),o="",s=0,n=r.length;s<n;s++)i=r[s],o+=String.fromCharCode(i);return[o=o.trim(),e+=a]}:function(t,e){var i,r,o;for(c=a,i=[];c--;)r=(o=h.dataAccessors[s](t,e))[0],e=o[1],i.push(r);return[i,e]};return h.accessors.push(t)}(r,e));return a},y.prototype._getRows=function(t,e){for(var i,r,o,s,n,a,l,h=new DataView(t),c=0,u=[];e--;){for(r={},i=s=0,n=(a=this.accessors).length;s<n;i=++s)o=(l=(0,a[i])(h,c))[0],c=l[1],r[this.columns[i]]=o;u.push(r)}return u},this.astro.FITS.BinaryTable=r=y,u={RiceSetup:{1:function(t){return[3,6,t[0],1]},2:function(t){var e=0,i=t[0];return e=0|i<<8,[4,14,e|=t[1],2]},4:function(t){var e=0,i=t[0];return e=0|i<<24,e|=t[1]<<16,e|=t[2]<<8,[5,25,e|=t[3],4]}},Rice:function(t,e,i,r,o,s){for(var n,a,l,h,c,i=s[i](t),u=i[0],d=i[1],p=i[2],f=i[3],g=new Uint8Array(256),v=8,i=[128,255],m=i[0],y=i[1];0<=y;){for(;m<=y;)g[y]=v,--y;m/=2,--v}for(g[0]=0,n=t[f++],c=8,y=0;y<o;){for(c-=u;c<0;)n=n<<8|t[f++],c+=8;if(l=(n>>c)-1,n&=(1<<c)-1,o<(h=y+e)&&(h=o),l<0)for(;y<h;)r[y]=p,y+=1;else if(l===d)for(;y<h;){for(a=n<<(m=1-c),m-=8;0<=m;)a|=(n=t[f++])<<m,m-=8;0<c?(a|=(n=t[f++])>>-m,n&=(1<<c)-1):n=0,0==(1&a)?a>>=1:a=~(a>>1),r[y]=a+p,p=r[y],y++}else for(;y<h;){for(;0===n;)c+=8,n=t[f++];for(n^=1<<(c-=(v=c-g[n])+1),c-=l;c<0;)n=n<<8|t[f++],c+=8;a=v<<l|n>>c,n&=(1<<c)-1,0==(1&a)?a>>=1:a=~(a>>1),r[y]=a+p,p=r[y],y++}}return r}},this.astro.FITS.Decompress=u,t(S,r),S.include(i),S.extend(u),S.randomSequence=(S.randomGenerator=function(){for(var t,e,i=2147483647,r=1,o=new Float32Array(1e4),s=e=0;e<=9999;s=++e)r=(t=16807*r)-i*parseInt(t/i),o[s]=r/i;return o})(),S.prototype._getRows=function(t,e){for(var i,r,o,s,n,a,l,h,c,u,d,p,f,g,v,m,y,S=new DataView(t),w=0,C=new Float32Array(this.width*this.height);e--;){for(l={},o=p=0,g=(m=this.accessors).length;p<g;o=++p)u=(y=(0,m[o])(S,w))[0],w=y[1],l[this.columns[o]]=u;for(i=l.COMPRESSED_DATA||l.UNCOMPRESSED_DATA||l.GZIP_COMPRESSED_DATA,l.ZBLANK||this.zblank,h=l.ZSCALE||this.bscale,d=l.ZZERO||this.bzero,c=((s=this.height-e)+this.zdither-1-1)%1e4,a=parseInt(500*this.constructor.randomSequence[c]),o=f=0,v=i.length;f<v;o=++f)u=i[o],r=(s-1)*this.width+o,-2147483647===u?C[r]=NaN:-2147483646===u?C[r]=0:(n=this.constructor.randomSequence[a],C[r]=(u-n+.5)*h+d),1e4===(a+=1)&&(c=(c+1)%1e4,a=parseInt(500*this.randomSequence[c]))}return C},S.prototype.getFrame=function(e,i,r){var t,o,s=this;return this.heap?(this.frame=e||this.frame,this.getRows(0,this.rows,i,r)):(t=this.blob.slice(this.length,this.length+this.heapLength),(o=new FileReader).onloadend=function(t){return s.heap=t.target.result,s.getFrame(e,i,r)},o.readAsArrayBuffer(t))},this.astro.FITS.CompressedImage=S,w.prototype.hasData=function(){return null!=this.data},p=w,this.astro.FITS.HDU=p}.call(this),MOC=function(){MOC=function(t){this.order=void 0,this.type="moc",this.name=(t=t||{}).name||"MOC",this.color=t.color||Color.getNextColor(),this.opacity=t.opacity||1,this.opacity=Math.max(0,Math.min(1,this.opacity)),this.lineWidth=t.lineWidth||1,this.adaptativeDisplay=!1!==t.adaptativeDisplay,this.proxyCalled=!1,this._highResIndexOrder3=new Array(768),this._lowResIndexOrder3=new Array(768);for(var e=0;e<768;e++)this._highResIndexOrder3[e]={},this._lowResIndexOrder3[e]={};this.nbCellsDeepestLevel=0,this.isShowing=!0,this.ready=!1},MOC.MAX_NORDER=13,MOC.LOWRES_MAXORDER=6,MOC.HIGHRES_MAXORDER=11,MOC.PIVOT_FOV=30,MOC.prototype._removeDuplicatesFromIndexes=function(){for(var t,e,i=0;i<768;i++){for(var r in this._highResIndexOrder3[i])t=this._highResIndexOrder3[i][r],e=o(t),this._highResIndexOrder3[i][r]=e;for(var r in this._lowResIndexOrder3[i])t=this._lowResIndexOrder3[i][r],e=o(t),this._lowResIndexOrder3[i][r]=e}},MOC.prototype._addPix=function(t,e){var i,r,o,s=Math.floor(e*Math.pow(4,3-t));t<=MOC.LOWRES_MAXORDER?(t in this._lowResIndexOrder3[s]||(this._lowResIndexOrder3[s][t]=[],this._highResIndexOrder3[s][t]=[]),this._lowResIndexOrder3[s][t].push(e),this._highResIndexOrder3[s][t].push(e)):t<=MOC.HIGHRES_MAXORDER?(t in this._highResIndexOrder3[s]||(this._highResIndexOrder3[s][t]=[]),this._highResIndexOrder3[s][t].push(e),i=MOC.LOWRES_MAXORDER,r=Math.floor(e/Math.pow(4,t-i)),o=Math.floor(r*Math.pow(4,3-i)),i in this._lowResIndexOrder3[o]||(this._lowResIndexOrder3[o][i]=[]),this._lowResIndexOrder3[o][i].push(r)):(i=MOC.LOWRES_MAXORDER,r=Math.floor(e/Math.pow(4,t-i)),o=Math.floor(r*Math.pow(4,3-i)),i in this._lowResIndexOrder3[o]||(this._lowResIndexOrder3[o][i]=[]),this._lowResIndexOrder3[o][i].push(r),i=MOC.HIGHRES_MAXORDER,r=Math.floor(e/Math.pow(4,t-i)),o=Math.floor(r*Math.pow(4,3-i)),i in this._highResIndexOrder3[o]||(this._highResIndexOrder3[o][i]=[]),this._highResIndexOrder3[o][i].push(r)),this.nbCellsDeepestLevel+=Math.pow(4,this.order-t)},MOC.prototype.skyFraction=function(){return this.nbCellsDeepestLevel/(12*Math.pow(4,this.order))},MOC.prototype.dataFromJSON=function(t){var e,i,r;for(r in t)if(t.hasOwnProperty(r)){e=parseInt(r),(void 0===this.order||e>this.order)&&(this.order=e);for(var o=0;o<t[r].length;o++)i=t[r][o],this._addPix(e,i)}this.reportChange(),this.ready=!0},MOC.prototype.dataFromFITSURL=function(t,i){function r(){var t;try{if(0==this.hdus.length)return void(!0!==s.proxyCalled&&(s.proxyCalled=!0,e=Aladin.JSONP_PROXY+"?url="+encodeURIComponent(s.dataURL),new astro.FITS(e,r)));t=this.getHeader(0)}catch(t){return void console.error("Could not get header of extension #0")}var e=this.getHeader(1);if(t.contains("HPXMOC"))s.order=t.get("HPXMOC");else if(t.contains("MOCORDER"))s.order=t.get("MOCORDER");else if(e.contains("HPXMOC"))s.order=e.get("HPXMOC");else{if(!e.contains("MOCORDER"))return void console.error("Can not find MOC order in FITS file");s.order=e.get("MOCORDER")}var o=(e=this.getDataUnit(1)).columns[0];e.getRows(0,e.rows,function(t){for(var e=0;e<t.length;e++){var i=t[e][o],r=Math.floor(Math.floor((r=Math.floor(i/4),Math.log(r)/Math.LN2))/2),i=i-4*Math.pow(4,r);s._addPix(r,i)}}),e=null,s._removeDuplicatesFromIndexes(),i&&i(),s.reportChange(),s.ready=!0}var s=this;this.dataURL=t,new astro.FITS(this.dataURL,r)},MOC.prototype.setView=function(t){this.view=t,this.reportChange()},MOC.prototype.draw=function(t,e,i,r,o,s,n,a){var l;this.isShowing&&this.ready&&(l=a>MOC.PIVOT_FOV&&this.adaptativeDisplay?this._lowResIndexOrder3:this._highResIndexOrder3,this._drawCells(t,l,a,e,i,CooFrameEnum.J2000,r,o,s,n))},MOC.prototype._drawCells=function(t,e,i,r,o,s,n,a,l,h){t.lineWidth=this.lineWidth,1==this.opacity?t.strokeStyle=this.color:(t.fillStyle=this.color,t.globalAlpha=this.opacity),t.beginPath();for(var c=[],u=0;u<768;u++)for(key in m=e[u])c.push(parseInt(key));c.sort(function(t,e){return t-e});for(var d=c[c.length-1],p=this.view.getVisiblePixList(3,CooFrameEnum.J2000),f=[],u=0;u<p.length;u++){var g,v=p[u];(g=b(8,v,o,s,n,a,l,h,r))&&f.push(v)}for(var m,y=0;y<=d;y++)for(var S=1<<y,w=0;w<f.length;w++)if(void 0!==(m=e[f[w]])[y])if(y<=3)for(var C=0;C<m[y].length;C++){v=m[y][C];for(var x=Math.pow(4,3-y),I=v*x,u=0;u<x;u++)norder3Ipix=I+u,(g=b(8,norder3Ipix,o,s,n,a,l,h,r))&&_(t,g)}else for(C=0;C<m[y].length;C++){v=m[y][C];Math.floor(v/Math.pow(4,y-3));(g=b(S,v,o,s,n,a,l,h,r))&&_(t,g)}1==this.opacity?t.stroke():(t.fill(),t.globalAlpha=1)};var _=function(t,e){t.moveTo(e[0].vx,e[0].vy),t.lineTo(e[1].vx,e[1].vy),t.lineTo(e[2].vx,e[2].vy),t.lineTo(e[3].vx,e[3].vy),t.lineTo(e[0].vx,e[0].vy)},o=function(t){for(var e={},i=[],r=t.length,o=0,s=0;s<r;s++){var n=t[s];1!==e[n]&&(e[n]=1,i[o++]=n)}return i},g=new SpatialVector,b=function(t,e,i,r,o,s,n,a,l){for(var h,c=[],u=[],d=g,p=HealpixCache.corners_nest(e,t),f=0;f<4;f++)d.setXYZ(p[f].x,p[f].y,p[f].z),r&&r.system!=i.system?r.system==CooFrameEnum.SYSTEMS.J2000?(h=CooConversion.J2000ToGalactic([d.ra(),d.dec()]),lon=h[0],lat=h[1]):r.system==CooFrameEnum.SYSTEMS.GAL&&(h=CooConversion.GalacticToJ2000([d.ra(),d.dec()]),lon=h[0],lat=h[1]):(lon=d.ra(),lat=d.dec()),u[f]=l.project(lon,lat);if(null==u[0]||null==u[1]||null==u[2]||null==u[3])return null;for(f=0;f<4;f++)c[f]=AladinUtils.xyToView(u[f].X,u[f].Y,o,s,n,a);return c[0].vx<0&&c[1].vx<0&&c[2].vx<0&&c[3].vx<0||c[0].vy<0&&c[1].vy<0&&c[2].vy<0&&c[3].vy<0||c[0].vx>=o&&c[1].vx>=o&&c[2].vx>=o&&c[3].vx>=o||c[0].vy>=s&&c[1].vy>=s&&c[2].vy>=s&&c[3].vy>=s?null:c=AladinUtils.grow2(c,1)};return MOC.prototype.reportChange=function(){this.view&&this.view.requestRedraw()},MOC.prototype.show=function(){this.isShowing||(this.isShowing=!0,this.reportChange())},MOC.prototype.hide=function(){this.isShowing&&(this.isShowing=!1,this.reportChange())},MOC.prototype.contains=function(t,e){var i=new HealpixIndex(Math.pow(2,this.order));i.init();for(var e=Utils.radecToPolar(t,e),r=i.ang2pix_nest(e.theta,e.phi),o={},s=0;s<=this.order;s++)o[s]=Math.floor(r/Math.pow(4,this.order-s));for(var n=0;n<768;n++)for(h in l=this._highResIndexOrder3[n])if(h<3)for(var a=l[h].length;0<=a;a--)if(o[h]==l[h][a])return!0;var l,h,n=o[3];for(h in l=this._highResIndexOrder3[n])for(a=l[h].length;0<=a;a--)if(o[h]==l[h][a])return!0;return!1},MOC}(),CooGrid=function(){function t(){}function x(t,e,i,r,o,s,n){var a,n=AladinUtils.viewToXy(e,i,r,o,s,n);try{a=t.unproject(n.x,n.y)}catch(t){return null}return{lon:a.ra,lat:a.dec}}return t.prototype.redraw=function(t,e,i,r,o,s,n,a){if(!(60<a)){var l=x(e,0,0,r,o,s,n),h=x(e,r-1,o-1,r,o,s,n),c=Math.min(l.lon,h.lon),u=Math.max(l.lon,h.lon),d=Math.min(l.lat,h.lat),p=Math.max(l.lat,h.lat),h=x(e,0,o-1,r,o,s,n);c=Math.min(c,h.lon),u=Math.max(u,h.lon),d=Math.min(d,h.lat),p=Math.max(p,h.lat);h=x(e,r-1,0,r,o,s,n);c=Math.min(c,h.lon),u=Math.max(u,h.lon),d=Math.min(d,h.lat);var f,g=u-c,v=(p=Math.max(p,h.lat))-d,m=f=10<a?4:1<a?1:.1<a?.1:.01,h=Math.round(c%f)*f,a=Math.round(d%m)*m;t.lineWidth=1,t.strokeStyle="rgb(120,120,255)";for(var y=a;y<p+m;y+=m)if(t.beginPath(),C=AladinUtils.radecToViewXy(c,y,e,CooFrameEnum.J2000,r,o,s,n)){t.moveTo(C.vx,C.vy);for(var S=0,w=c;w<u+f;w+=g/10)S++,C=AladinUtils.radecToViewXy(w,y,e,CooFrameEnum.J2000,r,o,s,n),t.lineTo(C.vx,C.vy),3==S&&t.strokeText(y.toFixed(2),C.vx,C.vy-2);t.stroke()}for(var C,w=h;w<u+f;w+=f)if(t.beginPath(),C=AladinUtils.radecToViewXy(w,d,e,CooFrameEnum.J2000,r,o,s,n)){t.moveTo(C.vx,C.vy);for(S=0,y=d;y<p+m;y+=v/10)S++,C=AladinUtils.radecToViewXy(w,y,e,CooFrameEnum.J2000,r,o,s,n),t.lineTo(C.vx,C.vy),3==S&&t.strokeText(w.toFixed(2),C.vx,C.vy-2);t.stroke()}}},t}(),Footprint=(Footprint=function(t){this.polygons=t,this.overlay=null,this.id="footprint-"+Utils.uuidv4(),this.isShowing=!0,this.isSelected=!1},Footprint.prototype.setOverlay=function(t){this.overlay=t},Footprint.prototype.show=function(){this.isShowing||(this.isShowing=!0,this.overlay&&this.overlay.reportChange())},Footprint.prototype.hide=function(){this.isShowing&&(this.isShowing=!1,this.overlay&&this.overlay.reportChange())},Footprint.prototype.dispatchClickEvent=function(){this.overlay&&this.overlay.view.aladinDiv.dispatchEvent(new CustomEvent("footprintClicked",{detail:{footprintId:this.id,overlayName:this.overlay.name}}))},Footprint.prototype.select=function(){this.isSelected||(this.isSelected=!0,this.overlay&&this.overlay.reportChange())},Footprint.prototype.deselect=function(){this.isSelected&&(this.isSelected=!1,this.overlay&&this.overlay.reportChange())},Footprint),Popup=(Popup=function(t,e){this.domEl=$('<div class="aladin-popup-container"><div class="aladin-popup"><a class="aladin-closeBtn">&times;</a><div class="aladin-popupTitle"></div><div class="aladin-popupText"></div></div><div class="aladin-popup-arrow"></div></div>'),this.domEl.appendTo(t),this.view=e;var i=this;this.domEl.find(".aladin-closeBtn").click(function(){i.hide()})},Popup.prototype.hide=function(){this.domEl.hide(),this.view.mustClearCatalog=!0,this.view.catalogForPopup.hide()},Popup.prototype.show=function(){this.domEl.show()},Popup.prototype.setTitle=function(t){this.domEl.find(".aladin-popupTitle").html(t||"")},Popup.prototype.setText=function(t){this.domEl.find(".aladin-popupText").html(t||""),this.w=this.domEl.outerWidth(),this.h=this.domEl.outerHeight()},Popup.prototype.setSource=function(t){this.source&&(this.source.popup=null),(t.popup=this).source=t,this.setPosition(t.x,t.y)},Popup.prototype.setPosition=function(t,e){t-=this.w/2,e-=this.h;this.source&&(e+=this.source.catalog.sourceSize/2),this.domEl[0].style.left=t+"px",this.domEl[0].style.top=e+"px"},Popup),Circle=(Circle=function(t,e,i){this.color=(i=i||{}).color||void 0,this.id="circle-"+Utils.uuidv4(),this.setCenter(t),this.setRadius(e),this.overlay=null,this.isShowing=!0,this.isSelected=!1},Circle.prototype.setOverlay=function(t){this.overlay=t},Circle.prototype.show=function(){this.isShowing||(this.isShowing=!0,this.overlay&&this.overlay.reportChange())},Circle.prototype.hide=function(){this.isShowing&&(this.isShowing=!1,this.overlay&&this.overlay.reportChange())},Circle.prototype.dispatchClickEvent=function(){this.overlay&&this.overlay.view.aladinDiv.dispatchEvent(new CustomEvent("footprintClicked",{detail:{footprintId:this.id,overlayName:this.overlay.name}}))},Circle.prototype.select=function(){this.isSelected||(this.isSelected=!0,this.overlay&&this.overlay.reportChange())},Circle.prototype.deselect=function(){this.isSelected&&(this.isSelected=!1,this.overlay&&this.overlay.reportChange())},Circle.prototype.setCenter=function(t){this.centerRaDec=t,this.overlay&&this.overlay.reportChange()},Circle.prototype.setRadius=function(t){this.radiusDegrees=t,this.overlay&&this.overlay.reportChange()},Circle.prototype.draw=function(t,e,i,r,o,s,n,a){var l,h,c,u;this.isShowing&&(a=!0===a||!1,(u=i.system!=CooFrameEnum.SYSTEMS.J2000?(c=CooConversion.J2000ToGalactic([this.centerRaDec[0],this.centerRaDec[1]]),e.project(c[0],c[1])):e.project(this.centerRaDec[0],this.centerRaDec[1]))&&(l=AladinUtils.xyToView(u.X,u.Y,r,o,s,n,!1),h=this.centerRaDec[0],u=this.centerRaDec[1]+(0<h?-this.radiusDegrees:this.radiusDegrees),(u=i.system!=CooFrameEnum.SYSTEMS.J2000?(c=CooConversion.J2000ToGalactic([h,u]),e.project(c[0],c[1])):e.project(h,u))&&(n=(s=AladinUtils.xyToView(u.X,u.Y,r,o,s,n,!1)).vx-l.vx,s=s.vy-l.vy,n=Math.sqrt(n*n+s*s),s=(!(s=this.color)&&this.overlay?this.overlay.color:s)||"#ff0000",this.isSelected?t.strokeStyle=Overlay.increaseBrightness(s,50):t.strokeStyle=s,t.beginPath(),t.arc(l.vx,l.vy,n,0,2*Math.PI,!1),a||t.stroke())))},Circle),Polyline=(Polyline=function(t,e){this.color=(e=e||{}).color||"white",this.lineWidth=e.lineWidth||2,this.radecArray=t,this.overlay=null,this.isShowing=!0,this.isSelected=!1},Polyline.prototype.setOverlay=function(t){this.overlay=t},Polyline.prototype.show=function(){this.isShowing||(this.isShowing=!0,this.overlay&&this.overlay.reportChange())},Polyline.prototype.hide=function(){this.isShowing&&(this.isShowing=!1,this.overlay&&this.overlay.reportChange())},Polyline.prototype.select=function(){this.isSelected||(this.isSelected=!0,this.overlay&&this.overlay.reportChange())},Polyline.prototype.deselect=function(){this.isSelected&&(this.isSelected=!1,this.overlay&&this.overlay.reportChange())},Polyline.prototype.setLineWidth=function(t){this.lineWidth!=t&&(this.lineWidth=t,this.overlay.reportChange())},Polyline.prototype.setColor=function(t){this.color!=t&&(this.color=t,this.overlay.reportChange())},Polyline.prototype.draw=function(t,e,i,r,o,s,n){if(this.isShowing&&this.radecArray&&!(this.radecArray.length<2)){this.color&&(t.strokeStyle=this.color);for(var a,l=AladinUtils.radecToViewXy(this.radecArray[0][0],this.radecArray[0][1],e,i,r,o,s,n),h=0;h<this.radecArray.length&&!(l=AladinUtils.radecToViewXy(this.radecArray[h][0],this.radecArray[h][1],e,i,r,o,s,n));h++);if(l){t.moveTo(l.vx,l.vy);for(var c=!1,u=!0,h=1;h<this.radecArray.length;h++)(a=AladinUtils.radecToViewXy(this.radecArray[h][0],this.radecArray[h][1],e,i,r,o,s,n))?c?(u=!0,t.beginPath(),t.lineWidth=this.lineWidth,t.moveTo(a.vx,a.vy),c=!1):t.lineTo(a.vx,a.vy):(u&&t.stroke(),c=!(u=!1));t.stroke()}}},Polyline),Overlay=(Overlay=function(t){t=t||{},this.type="overlay",this.name=t.name||"overlay",this.color=t.color||Color.getNextColor(),this.lineWidth=t.lineWidth||2,this.overlays=[],this.overlay_items=[],this.isShowing=!0},Overlay.prototype.show=function(){this.isShowing||(this.isShowing=!0,this.reportChange())},Overlay.prototype.hide=function(){this.isShowing&&(this.isShowing=!1,this.reportChange())},Overlay.parseSTCS=function(t){for(var e=[],i=t.match(/\S+/g),r=0,o=i.length;r<o;){var s,n=i[r].toLowerCase();if("polygon"==n){var a=[];if("icrs"==(s=i[++r].toLowerCase())||"j2000"==s||"fk5"==s){for(;r+2<o;){var l=parseFloat(i[r+1]);if(isNaN(l))break;var h=parseFloat(i[r+2]);a.push([l,h]),r+=2}a.push(a[0]),e.push(new Footprint(a))}}else"circle"==n&&("icrs"!=(s=i[++r].toLowerCase())&&"j2000"!=s&&"fk5"!=s||(l=parseFloat(i[r+1]),h=parseFloat(i[r+2]),n=parseFloat(i[r+3]),e.push(A.circle(l,h,n)),r+=3));r++}return e},Overlay.prototype.addFootprints=function(t){for(var e=0,i=t.length;e<i;e++)this.add(t[e],!1);this.view.requestRedraw()},Overlay.prototype.add=function(t,e){e=void 0===e||e,(t instanceof Footprint?this.overlays:this.overlay_items).push(t),t.setOverlay(this),e&&this.view.requestRedraw()},Overlay.prototype.getFootprint=function(t){return t<this.footprints.length?this.footprints[t]:null},Overlay.prototype.setView=function(t){this.view=t},Overlay.prototype.removeAll=function(){this.overlays=[],this.overlay_items=[]},Overlay.prototype.draw=function(t,e,i,r,o,s,n){if(this.isShowing){t.strokeStyle=this.color,t.lineWidth=this.lineWidth,t.beginPath(),xyviews=[];for(var a=0,l=this.overlays.length;a<l;a++)xyviews.push(this.drawFootprint(this.overlays[a],t,e,i,r,o,s,n));t.stroke(),t.strokeStyle=Overlay.increaseBrightness(this.color,50),t.beginPath();for(a=0,l=this.overlays.length;a<l;a++)this.overlays[a].isSelected&&this.drawFootprintSelected(t,xyviews[a]);t.stroke();for(a=0;a<this.overlay_items.length;a++)this.overlay_items[a].draw(t,e,i,r,o,s,n)}},Overlay.increaseBrightness=function(t,e){3==(t=t.replace(/^\s*#|\s*$/g,"")).length&&(t=t.replace(/(.)/g,"$1$1"));var i=parseInt(t.substr(0,2),16),r=parseInt(t.substr(2,2),16),t=parseInt(t.substr(4,2),16);return"#"+(0|256+i+(256-i)*e/100).toString(16).substr(1)+(0|256+r+(256-r)*e/100).toString(16).substr(1)+(0|256+t+(256-t)*e/100).toString(16).substr(1)},Overlay.prototype.drawFootprint=function(t,e,i,r,o,s,n,a){if(!t.isShowing)return null;for(var l=[],h=!1,c=t.polygons,u=0,d=c.length;u<d;u++){if(!(p=r.system!=CooFrameEnum.SYSTEMS.J2000?(p=CooConversion.J2000ToGalactic([c[u][0],c[u][1]]),i.project(p[0],p[1])):i.project(c[u][0],c[u][1])))return null;var p=AladinUtils.xyToView(p.X,p.Y,o,s,n,a);l.push(p),!h&&p.vx<o&&0<=p.vx&&p.vy<=s&&0<=p.vy&&(h=!0)}if(h){e.moveTo(l[0].vx,l[0].vy);for(u=1,d=l.length;u<d;u++)e.lineTo(l[u].vx,l[u].vy)}return l},Overlay.prototype.drawFootprintSelected=function(t,e){if(e){var i=e;t.moveTo(i[0].vx,i[0].vy);for(var r=1,o=i.length;r<o;r++)t.lineTo(i[r].vx,i[r].vy)}},Overlay.prototype.reportChange=function(){this.view.requestRedraw()},Overlay),cds.Source=(cds.Source=function(t,e,i,r){this.ra=t,this.dec=e,this.data=i,this.catalog=null,this.marker=r&&r.marker||!1,this.marker&&(this.popupTitle=r&&r.popupTitle?r.popupTitle:"",this.popupDesc=r&&r.popupDesc?r.popupDesc:"",this.useMarkerDefaultIcon=!r||void 0===r.useMarkerDefaultIcon||r.useMarkerDefaultIcon),this.isShowing=!0,this.isSelected=!1},cds.Source.prototype.setCatalog=function(t){this.catalog=t},cds.Source.prototype.show=function(){this.isShowing||(this.isShowing=!0,this.catalog&&this.catalog.reportChange())},cds.Source.prototype.hide=function(){this.isShowing&&(this.isShowing=!1,this.catalog&&this.catalog.reportChange())},cds.Source.prototype.select=function(){this.isSelected||(this.isSelected=!0,this.catalog&&this.catalog.reportChange())},cds.Source.prototype.deselect=function(){this.isSelected&&(this.isSelected=!1,this.catalog&&this.catalog.reportChange())},cds.Source.prototype.actionClicked=function(){if(this.catalog&&this.catalog.onClick){var t=this.catalog.view;if("showTable"==this.catalog.onClick)t.aladin.measurementTable.showMeasurement(this),this.select();else if("showPopup"==this.catalog.onClick){t.popup.setTitle("<br><br>");var e,i='<div class="aladin-marker-measurement">';for(e in i+="<table>",this.data)i+="<tr><td>"+e+"</td><td>"+this.data[e]+"</td></tr>";i+="</table>",t.popup.setText(i+="</div>"),t.popup.setSource(this),t.popup.show()}else"function"==typeof this.catalog.onClick&&(this.catalog.onClick(this),t.lastClickedObject=this)}},cds.Source.prototype.actionOtherObjectClicked=function(){this.catalog&&this.catalog.onClick&&this.deselect()},cds.Source),cds.Catalog=function(){function v(t,e,i){var r,o=r=null;if(e)for(var s=0,n=t.length;s<n;s++){var a=t[s];if(Utils.isInt(e)&&e<t.length){o=e;break}if(a.ID&&a.ID===e||a.name&&a.name===e){o=s;break}}if(i)for(s=0,n=t.length;s<n;s++){a=t[s];if(Utils.isInt(i)&&i<t.length){r=i;break}if(a.ID&&a.ID===i||a.name&&a.name===i){r=s;break}}for(s=0,n=t.length;s<n&&(null==o||null==r);s++){var l,a=t[s];o||!a.ucd||0!=(l=$.trim(a.ucd.toLowerCase())).indexOf("pos.eq.ra")&&0!=l.indexOf("pos_eq_ra")?r||a.ucd&&(0!=(l=$.trim(a.ucd.toLowerCase())).indexOf("pos.eq.dec")&&0!=l.indexOf("pos_eq_dec")||(r=s)):o=s}if(null==o&&null==r)for(s=0,n=t.length;s<n;s++){var h=(h=(a=t[s]).name||a.ID||"").toLowerCase();o||0!=h.indexOf("ra")&&0!=h.indexOf("_ra")&&0!=h.indexOf("ra(icrs)")&&0!=h.indexOf("_ra")&&0!=h.indexOf("alpha")?r||0!=h.indexOf("dej2000")&&0!=h.indexOf("_dej2000")&&0!=h.indexOf("de")&&0!=h.indexOf("de(icrs)")&&0!=h.indexOf("_de")&&0!=h.indexOf("delta")||(r=s):o=s}return null!=o&&null!=r||(o=0,r=1),[o,r]}return cds.Catalog=function(t){t=t||{},this.type="catalog",this.name=t.name||"catalog",this.color=t.color||Color.getNextColor(),this.sourceSize=t.sourceSize||8,this.markerSize=t.sourceSize||12,this.shape=t.shape||"square",this.maxNbSources=t.limit||void 0,this.onClick=t.onClick||void 0,this.raField=t.raField||void 0,this.decField=t.decField||void 0,this.indexationNorder=5,this.sources=[],this.hpxIdx=new HealpixIndex(this.indexationNorder),this.displayLabel=t.displayLabel||!1,this.labelColor=t.labelColor||this.color,this.labelFont=t.labelFont||"10px sans-serif",this.displayLabel&&(this.labelColumn=t.labelColumn,this.labelColumn||(this.displayLabel=!1)),(this.shape instanceof Image||this.shape instanceof HTMLCanvasElement)&&(this.sourceSize=this.shape.width),this._shapeIsFunction=!1,$.isFunction(this.shape)&&(this._shapeIsFunction=!0),this.selectionColor="#00ff00",this.updateShape(t),this.cacheMarkerCanvas=document.createElement("canvas"),this.cacheMarkerCanvas.width=this.markerSize,this.cacheMarkerCanvas.height=this.markerSize;var e=this.cacheMarkerCanvas.getContext("2d");e.fillStyle=this.color,e.beginPath();t=this.markerSize/2;e.arc(t,t,t-2,0,2*Math.PI,!1),e.fill(),e.lineWidth=2,e.strokeStyle="#ccc",e.stroke(),this.isShowing=!0},cds.Catalog.createShape=function(t,e,i){if(t instanceof Image||t instanceof HTMLCanvasElement)return t;var r=document.createElement("canvas");r.width=r.height=i;var o=r.getContext("2d");return o.beginPath(),o.strokeStyle=e,o.lineWidth=2,"plus"==t?(o.moveTo(i/2,0),o.lineTo(i/2,i),o.stroke(),o.moveTo(0,i/2),o.lineTo(i,i/2)):"cross"==t?(o.moveTo(0,0),o.lineTo(i-1,i-1),o.stroke(),o.moveTo(i-1,0),o.lineTo(0,i-1)):"rhomb"==t?(o.moveTo(i/2,0),o.lineTo(0,i/2),o.lineTo(i/2,i),o.lineTo(i,i/2),o.lineTo(i/2,0)):"triangle"==t?(o.moveTo(i/2,0),o.lineTo(0,i-1),o.lineTo(i-1,i-1),o.lineTo(i/2,0)):"circle"==t?o.arc(i/2,i/2,i/2-1,0,2*Math.PI,!0):(o.moveTo(1,0),o.lineTo(1,i-1),o.lineTo(i-1,i-1),o.lineTo(i-1,1),o.lineTo(1,1)),o.stroke(),r},cds.Catalog.parseVOTable=function(t,e,p,i,f,g){function r(t,e){t=t.replace(/^\s+/g,"");var r=["name","ID","ucd","utype","unit","datatype","arraysize","width","precision"],o=[],s=0,i=$($.parseXML(t)),n=function(t){if(0<t.find("RESOURCE").length)e="";else{if(0==(e=t.find("*").first()).length)return"";var e,t=(e=e.prop("tagName")).indexOf(":");e=e.substring(0,t)+"\\:"}return e}(i);i.find(n+"FIELD").each(function(){for(var t={},e=0;e<r.length;e++){var i=r[e];$(this).attr(i)&&(t[i]=$(this).attr(i))}t.ID||(t.ID="col_"+s),o.push(t),s++});var a,l,t=v(o,f,g),h=t[0],c=t[1],u=[],d=new Coo;i.find(n+"TR").each(function(){var e={},i=0;$(this).find(n+"TD").each(function(){var t=o[i].name||o[i].id;e[t]=$(this).text(),i++});var t=o[h].name||o[h].id,r=o[c].name||o[c].id;if(l=Utils.isNumber(e[t])&&Utils.isNumber(e[r])?(a=parseFloat(e[t]),parseFloat(e[r])):(d.parse(e[t]+" "+e[r]),a=d.lon,d.lat),u.push(new cds.Source(a,l,e)),p&&u.length==p)return!1}),e&&e(u)}Utils.getAjaxObject(t,"GET","text",i).done(function(t){r(t,e)})},cds.Catalog.prototype.updateShape=function(t){this.color=(t=t||{}).color||this.color||Color.getNextColor(),this.sourceSize=t.sourceSize||this.sourceSize||6,this.shape=t.shape||this.shape||"square",this.selectSize=this.sourceSize+2,this.cacheCanvas=cds.Catalog.createShape(this.shape,this.color,this.sourceSize),this.cacheSelectCanvas=cds.Catalog.createShape("square",this.selectionColor,this.selectSize),this.reportChange()},cds.Catalog.prototype.addSources=function(t){t=[].concat(t),this.sources=this.sources.concat(t);for(var e=0,i=t.length;e<i;e++)t[e].setCatalog(this);this.reportChange()},cds.Catalog.prototype.addSourcesAsArray=function(t,e){for(var i=[],r=0;r<t.length;r++)i.push({name:t[r]});for(var o,s=v(i,this.raField,this.decField),n=s[0],a=s[1],l=[],h=new Coo,c=0;c<e.length;c++){for(var u=e[c],d=Utils.isNumber(u[n])&&Utils.isNumber(u[a])?(o=parseFloat(u[n]),parseFloat(u[a])):(h.parse(u[n]+" "+u[a]),o=h.lon,h.lat),p={},r=0;r<t.length;r++)p[t[r]]=u[r];l.push(A.source(o,d,p))}this.addSources(l)},cds.Catalog.prototype.getSources=function(){return this.sources},cds.Catalog.prototype.selectAll=function(){if(this.sources)for(var t=0;t<this.sources.length;t++)this.sources[t].select()},cds.Catalog.prototype.deselectAll=function(){if(this.sources)for(var t=0;t<this.sources.length;t++)this.sources[t].deselect()},cds.Catalog.prototype.getSource=function(t){return t<this.sources.length?this.sources[t]:null},cds.Catalog.prototype.setView=function(t){this.view=t,this.reportChange()},cds.Catalog.prototype.remove=function(t){t=this.sources.indexOf(t);t<0||(this.sources[t].deselect(),this.sources.splice(t,1),this.reportChange())},cds.Catalog.prototype.removeAll=cds.Catalog.prototype.clear=function(){this.sources=[]},cds.Catalog.prototype.draw=function(t,e,i,r,o,s,n){if(this.isShowing){this._shapeIsFunction&&t.save();for(var a,l=[],h=0,c=this.sources.length;h<c;h++)cds.Catalog.drawSource(this,this.sources[h],t,e,i,r,o,s,n)&&l.push(this.sources[h]);this._shapeIsFunction&&t.restore(),t.strokeStyle=this.selectionColor;for(h=0,c=l.length;h<c;h++)(a=l[h]).isSelected&&cds.Catalog.drawSourceSelection(this,a,t);if(this.displayLabel){t.fillStyle=this.labelColor,t.font=this.labelFont;for(h=0,c=l.length;h<c;h++)cds.Catalog.drawSourceLabel(this,l[h],t)}}},cds.Catalog.drawSource=function(t,e,i,r,o,s,n,a,l){if(!e.isShowing)return!1;var h=t.sourceSize;if(r=o.system!=CooFrameEnum.SYSTEMS.J2000?(o=CooConversion.J2000ToGalactic([e.ra,e.dec]),r.project(o[0],o[1])):r.project(e.ra,e.dec)){a=AladinUtils.xyToView(r.X,r.Y,s,n,a,l,!0),l=e.popup?100:e.sourceSize;if(a){if(a.vx>s+l||a.vx<0-l||a.vy>n+l||a.vy<0-l)return e.x=e.y=void 0,!1;e.x=a.vx,e.y=a.vy,t._shapeIsFunction?t.shape(e,i,t.view.getViewParams()):e.marker&&e.useMarkerDefaultIcon?i.drawImage(t.cacheMarkerCanvas,e.x-h/2,e.y-h/2):i.drawImage(t.cacheCanvas,e.x-t.cacheCanvas.width/2,e.y-t.cacheCanvas.height/2),e.popup&&e.popup.setPosition(e.x,e.y)}return!0}return!1},cds.Catalog.drawSourceSelection=function(t,e,i){var r;e&&e.isShowing&&e.x&&e.y&&(r=t.selectSize,i.drawImage(t.cacheSelectCanvas,e.x-r/2,e.y-r/2))},cds.Catalog.drawSourceLabel=function(t,e,i){e&&e.isShowing&&e.x&&e.y&&((t=e.data[t.labelColumn])&&i.fillText(t,e.x,e.y))},cds.Catalog.prototype.reportChange=function(){this.view&&this.view.requestRedraw()},cds.Catalog.prototype.show=function(){this.isShowing||(this.isShowing=!0,this.reportChange())},cds.Catalog.prototype.hide=function(){this.isShowing&&(this.isShowing=!1,this.view&&this.view.popup&&this.view.popup.source&&this.view.popup.source.catalog==this&&this.view.popup.hide(),this.reportChange())},cds.Catalog}(),ProgressiveCat=function(){function i(r,t){var o=["name","ID","ucd","utype","unit","datatype","arraysize","width","precision"],s=[],n=0;return r.keyRa=r.keyDec=null,$(t).find("FIELD").each(function(){for(var t={},e=0;e<o.length;e++){var i=o[e];$(this).attr(i)&&(t[i]=$(this).attr(i))}t.ID||(t.ID="col_"+n),r.keyRa||!t.ucd||0!=t.ucd.indexOf("pos.eq.ra")&&0!=t.ucd.indexOf("POS_EQ_RA")||(t.name?r.keyRa=t.name:r.keyRa=t.ID),r.keyDec||!t.ucd||0!=t.ucd.indexOf("pos.eq.dec")&&0!=t.ucd.indexOf("POS_EQ_DEC")||(t.name?r.keyDec=t.name:r.keyDec=t.ID),s.push(t),n++}),s}function h(t,e,i){if(!t.keyRa||!t.keyDec)return[];lines=e.split("\n");for(var r=[],o=0;o<i.length;o++)i[o].name?r.push(i[o].name):r.push(i[o].ID);for(var s=[],n=new Coo,a=2;a<lines.length;a++){var l={},h=lines[a].split("\t");if(!(h.length<r.length)){for(var c,u,d=0;d<r.length;d++)l[r[d]]=h[d];u=Utils.isNumber(l[t.keyRa])&&Utils.isNumber(l[t.keyDec])?(c=parseFloat(l[t.keyRa]),parseFloat(l[t.keyDec])):(n.parse(l[t.keyRa]+" "+l[t.keyDec]),c=n.lon,n.lat),u=new cds.Source(c,u,l),s.push(u),u.setCatalog(t)}}return s}return ProgressiveCat=function(t,e,i,r){r=r||{},this.type="progressivecat",this.rootUrl=t,Utils.isHttpsContext()&&(/u-strasbg.fr/i.test(this.rootUrl)||/unistra.fr/i.test(this.rootUrl))&&(this.rootUrl=this.rootUrl.replace("http://","https://")),this.frameStr=e,this.frame=CooFrameEnum.fromString(e)||CooFrameEnum.J2000,this.maxOrder=i,this.isShowing=!0,this.name=r.name||"progressive-cat",this.color=r.color||Color.getNextColor(),this.shape=r.shape||"square",this.sourceSize=r.sourceSize||6,this.selectSize=this.sourceSize+2,this.selectionColor="#00ff00",this.filterFn=r.filter||void 0,this.onClick=r.onClick||void 0,this.sourcesCache=new Utils.LRUCache(100),this.updateShape(r),this.maxOrderAllsky=2,this.isReady=!1},ProgressiveCat.readProperties=function(t,a,e){a&&$.ajax({url:t+"/properties",method:"GET",dataType:"text",success:function(t){for(var e={},i=t.split("\n"),r=0;r<i.length;r++){var o=i[r],s=o.indexOf("="),n=$.trim(o.substring(0,s)),s=$.trim(o.substring(s+1));e[n]=s}a(e)},error:function(t){e&&e(t)}})},ProgressiveCat.prototype={init:function(t){var e=this;this.view=t,this.maxOrder&&this.frameStr?this._loadMetadata():ProgressiveCat.readProperties(e.rootUrl,function(t){e.properties=t,e.maxOrder=e.properties.hips_order,e.frame=CooFrameEnum.fromString(e.properties.hips_frame),e._loadMetadata()},function(t){console.log("Could not find properties for HiPS "+e.rootUrl)})},updateShape:cds.Catalog.prototype.updateShape,_loadMetadata:function(){var e=this;$.ajax({url:e.rootUrl+"/Metadata.xml",method:"GET",success:function(t){e.fields=i(e,t),e._loadAllskyNewMethod()},error:function(t){e._loadAllskyOldMethod()}})},_loadAllskyNewMethod:function(){var e=this;$.ajax({url:e.rootUrl+"/Norder1/Allsky.tsv",method:"GET",success:function(t){e.order1Sources=h(e,t,e.fields),e.order2Sources&&(e.isReady=!0,e._finishInitWhenReady())},error:function(t){console.log("Something went wrong: "+t)}}),$.ajax({url:e.rootUrl+"/Norder2/Allsky.tsv",method:"GET",success:function(t){e.order2Sources=h(e,t,e.fields),e.order1Sources&&(e.isReady=!0,e._finishInitWhenReady())},error:function(t){console.log("Something went wrong: "+t)}})},_loadAllskyOldMethod:function(){this.maxOrderAllsky=3,this._loadLevel2Sources(),this._loadLevel3Sources()},_loadLevel2Sources:function(){var e=this;$.ajax({url:e.rootUrl+"/Norder2/Allsky.xml",method:"GET",success:function(t){e.fields=i(e,t),e.order2Sources=h(e,$(t).find("CSV").text(),e.fields),e.order3Sources&&(e.isReady=!0,e._finishInitWhenReady())},error:function(t){console.log("Something went wrong: "+t)}})},_loadLevel3Sources:function(){var e=this;$.ajax({url:e.rootUrl+"/Norder3/Allsky.xml",method:"GET",success:function(t){e.order3Sources=h(e,$(t).find("CSV").text(),e.fields),e.order2Sources&&(e.isReady=!0,e._finishInitWhenReady())},error:function(t){console.log("Something went wrong: "+t)}})},_finishInitWhenReady:function(){this.view.requestRedraw(),this.loadNeededTiles()},draw:function(t,e,i,r,o,s,n){if(this.isShowing&&this.isReady&&(this.drawSources(this.order1Sources,t,e,i,r,o,s,n),this.drawSources(this.order2Sources,t,e,i,r,o,s,n),this.drawSources(this.order3Sources,t,e,i,r,o,s,n),this.tilesInView))for(var a,l=0;l<this.tilesInView.length;l++)a=(a=this.tilesInView[l])[0]+"-"+a[1],(a=this.sourcesCache.get(a))&&this.drawSources(a,t,e,i,r,o,s,n)},drawSources:function(t,e,i,r,o,s,n,a){if(t){for(var l,h=0,c=t.length;h<c;h++)l=t[h],this.filterFn&&!this.filterFn(l)||cds.Catalog.drawSource(this,l,e,i,r,o,s,n,a);for(h=0,c=t.length;h<c;h++)(l=t[h]).isSelected&&(this.filterFn&&!this.filterFn(l)||cds.Catalog.drawSourceSelection(this,l,e))}},getSources:function(){var t=[];if(this.order1Sources&&(t=t.concat(this.order1Sources)),this.order2Sources&&(t=t.concat(this.order2Sources)),this.order3Sources&&(t=t.concat(this.order3Sources)),this.tilesInView)for(var e,i=0;i<this.tilesInView.length;i++)e=(e=this.tilesInView[i])[0]+"-"+e[1],(e=this.sourcesCache.get(e))&&(t=t.concat(e));return t},deselectAll:function(){if(this.order1Sources)for(var t=0;t<this.order1Sources.length;t++)this.order1Sources[t].deselect();if(this.order2Sources)for(t=0;t<this.order2Sources.length;t++)this.order2Sources[t].deselect();if(this.order3Sources)for(t=0;t<this.order3Sources.length;t++)this.order3Sources[t].deselect();for(key in this.sourcesCache.keys())if(this.sourcesCache[key])for(var e=this.sourcesCache[key],t=0;t<e.length;t++)e[t].deselect()},show:function(){this.isShowing||(this.isShowing=!0,this.loadNeededTiles(),this.reportChange())},hide:function(){this.isShowing&&(this.isShowing=!1,this.reportChange())},reportChange:function(){this.view&&this.view.requestRedraw()},getTileURL:function(t,e){var i=1e4*Math.floor(e/1e4);return this.rootUrl+"/Norder"+t+"/Dir"+i+"/Npix"+e+".tsv"},loadNeededTiles:function(){if(this.isShowing){this.tilesInView=[];var t=this.view.realNorder;if(!((t=t>this.maxOrder?this.maxOrder:t)<=this.maxOrderAllsky)){for(var e,i,r,o=this.view.getVisibleCells(t,this.frame),s=3;s<=t;s++){for(var n=[],a=0;a<o.length;a++)e=Math.floor(o[a].ipix/Math.pow(4,t-s)),n.indexOf(e)<0&&n.push(e);for(var l=0;l<n.length;l++)this.tilesInView.push([s,n[l]])}for(a=0;a<this.tilesInView.length;a++)r=(i=this.tilesInView[a])[0]+"-"+i[1],this.sourcesCache.get(r)||function(e,t,i){var r=t+"-"+i;$.ajax({url:e.getTileURL(t,i),method:"GET",success:function(t){e.sourcesCache.set(r,h(e,t,e.fields)),e.view.requestRedraw()},error:function(){e.sourcesCache.set(r,[])}})}(this,i[0],i[1])}}}},ProgressiveCat}(),Tile=function(){function t(t,e){this.img=t,this.url=e}return t.isImageOk=function(t){return!!t.allSkyTexture||!!t.src&&(!!t.complete&&(void 0===t.naturalWidth||0!=t.naturalWidth))},t}(),TileBuffer=function(){function t(){this.pointer=0,this.tilesMap={},this.tilesArray=new Array(800);for(var t=0;t<800;t++)this.tilesArray[t]=new Tile(new Image,null)}return t.prototype.addTile=function(t){if(this.getTile(t))return null;var e=this.tilesArray[this.pointer];return null!=e.url&&(e.img.src=null,delete this.tilesMap[e.url]),this.tilesArray[this.pointer].url=t,this.tilesMap[t]=this.tilesArray[this.pointer],this.pointer++,800<=this.pointer&&(this.pointer=0),this.tilesMap[t]},t.prototype.getTile=function(t){return this.tilesMap[t]},t.prototype.removeTile=function(t){delete this.tilesMap[t],this.pointer--},t.prototype.removeTiles=function(t){for(url of t)delete this.tilesMap[url],this.pointer--},t}(),ColorMap=(ColorMap=function(t){this.view=t,this.reversed=!1,this.mapName="native",this.sig=this.signature()},ColorMap.MAPS={},ColorMap.MAPS.eosb={name:"Eos B",r:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,9,18,27,36,45,49,57,72,81,91,100,109,118,127,136,131,139,163,173,182,191,200,209,218,227,213,221,255,255,255,255,255,255,255,255,229,229,255,255,255,255,255,255,255,255,229,229,255,255,255,255,255,255,255,255,229,229,255,255,255,255,255,255,255,255,229,229,255,255,255,255,255,255,255,255,229,229,255,255,255,255,255,255,255,255,229,229,255,255,255,255,255,255,255,255,229,229,255,255,255,255,255,255,255,255,229,229,255,255,255,255,255,255,255,255,229,229,255,253,251,249,247,245,243,241,215,214,235,234,232,230,228,226,224,222,198,196,216,215,213,211,209,207,205,203,181,179,197,196,194,192,190,188,186,184,164,162,178,176,175,173,171,169,167,165,147,145,159,157,156,154,152,150,148,146,130,128,140,138,137,135,133,131,129,127,113,111,121,119,117,117],g:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,7,15,23,31,39,47,55,57,64,79,87,95,103,111,119,127,135,129,136,159,167,175,183,191,199,207,215,200,207,239,247,255,255,255,255,255,255,229,229,255,255,255,255,255,255,255,255,229,229,255,255,255,255,255,255,255,255,229,229,255,250,246,242,238,233,229,225,198,195,212,208,204,199,195,191,187,182,160,156,169,165,161,157,153,148,144,140,122,118,127,125,123,121,119,116,114,112,99,97,106,104,102,99,97,95,93,91,80,78,84,82,80,78,76,74,72,70,61,59,63,61,59,57,55,53,50,48,42,40,42,40,38,36,33,31,29,27,22,21,21,19,16,14,12,13,8,6,3,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],b:[116,121,127,131,136,140,144,148,153,157,145,149,170,174,178,182,187,191,195,199,183,187,212,216,221,225,229,233,238,242,221,225,255,247,239,231,223,215,207,199,172,164,175,167,159,151,143,135,127,119,100,93,95,87,79,71,63,55,47,39,28,21,15,7,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},ColorMap.MAPS.rainbow={name:"Rainbow",r:[0,4,9,13,18,22,27,31,36,40,45,50,54,58,61,64,68,69,72,74,77,79,80,82,83,85,84,86,87,88,86,87,87,87,85,84,84,84,83,79,78,77,76,71,70,68,66,60,58,55,53,46,43,40,36,33,25,21,16,12,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,8,12,21,25,29,33,42,46,51,55,63,67,72,76,80,89,93,97,101,110,114,119,123,131,135,140,144,153,157,161,165,169,178,182,187,191,199,203,208,212,221,225,229,233,242,246,250,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255],g:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,8,16,21,25,29,38,42,46,51,55,63,67,72,76,84,89,93,97,106,110,114,119,127,131,135,140,144,152,157,161,165,174,178,182,187,195,199,203,208,216,220,225,229,233,242,246,250,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,250,242,238,233,229,221,216,212,208,199,195,191,187,178,174,170,165,161,153,148,144,140,131,127,123,119,110,106,102,97,89,85,80,76,72,63,59,55,51,42,38,34,29,21,17,12,8,0],b:[0,3,7,10,14,19,23,28,32,38,43,48,53,59,63,68,72,77,81,86,91,95,100,104,109,113,118,122,127,132,136,141,145,150,154,159,163,168,173,177,182,186,191,195,200,204,209,214,218,223,227,232,236,241,245,250,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,246,242,238,233,225,220,216,212,203,199,195,191,187,178,174,170,165,157,152,148,144,135,131,127,123,114,110,106,102,97,89,84,80,76,67,63,59,55,46,42,38,34,25,21,16,12,8,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},ColorMap.MAPS.cubehelix={name:"Cubehelix",r:[0,1,3,4,6,8,9,10,12,13,14,15,17,18,19,20,20,21,22,23,23,24,24,25,25,25,26,26,26,26,26,26,26,26,26,26,26,25,25,25,25,24,24,24,23,23,23,23,22,22,22,21,21,21,21,21,21,20,20,20,21,21,21,21,21,22,22,22,23,23,24,25,26,27,27,28,30,31,32,33,35,36,38,39,41,43,45,47,49,51,53,55,57,60,62,65,67,70,72,75,78,81,83,86,89,92,95,98,101,104,107,110,113,116,120,123,126,129,132,135,138,141,144,147,150,153,155,158,161,164,166,169,171,174,176,178,181,183,185,187,189,191,193,194,196,198,199,201,202,203,204,205,206,207,208,209,209,210,211,211,211,212,212,212,212,212,212,212,212,211,211,211,210,210,210,209,208,208,207,207,206,205,205,204,203,203,202,201,201,200,199,199,198,197,197,196,196,195,195,194,194,194,193,193,193,193,193,193,193,193,193,193,194,194,195,195,196,196,197,198,199,200,200,202,203,204,205,206,208,209,210,212,213,215,217,218,220,222,223,225,227,229,231,232,234,236,238,240,242,244,245,247,249,251,253,255],g:[0,0,1,1,2,2,3,4,4,5,6,6,7,8,9,10,11,11,12,13,14,15,17,18,19,20,21,22,24,25,26,28,29,31,32,34,35,37,38,40,41,43,45,46,48,50,52,53,55,57,58,60,62,64,66,67,69,71,73,74,76,78,79,81,83,84,86,88,89,91,92,94,95,97,98,99,101,102,103,104,106,107,108,109,110,111,112,113,114,114,115,116,116,117,118,118,119,119,120,120,120,121,121,121,121,122,122,122,122,122,122,122,122,122,122,122,122,122,122,122,121,121,121,121,121,121,121,121,121,120,120,120,120,120,120,120,120,120,120,121,121,121,121,121,122,122,122,123,123,124,124,125,125,126,127,127,128,129,130,131,131,132,133,135,136,137,138,139,140,142,143,144,146,147,149,150,152,154,155,157,158,160,162,164,165,167,169,171,172,174,176,178,180,182,183,185,187,189,191,193,194,196,198,200,202,203,205,207,208,210,212,213,215,216,218,219,221,222,224,225,226,228,229,230,231,232,233,235,236,237,238,239,240,240,241,242,243,244,244,245,246,247,247,248,248,249,250,250,251,251,252,252,253,253,254,255],b:[0,1,3,4,6,8,9,11,13,15,17,19,21,23,25,27,29,31,33,35,37,39,41,43,45,47,48,50,52,54,56,57,59,60,62,63,65,66,67,69,70,71,72,73,74,74,75,76,76,77,77,77,78,78,78,78,78,78,78,77,77,77,76,76,75,75,74,73,73,72,71,70,69,68,67,66,66,65,64,63,61,60,59,58,58,57,56,55,54,53,52,51,51,50,49,49,48,48,47,47,47,46,46,46,46,46,47,47,47,48,48,49,50,50,51,52,53,55,56,57,59,60,62,64,65,67,69,71,74,76,78,81,83,86,88,91,94,96,99,102,105,108,111,114,117,120,124,127,130,133,136,140,143,146,149,153,156,159,162,165,169,172,175,178,181,184,186,189,192,195,197,200,203,205,207,210,212,214,216,218,220,222,224,226,227,229,230,231,233,234,235,236,237,238,239,239,240,241,241,242,242,242,243,243,243,243,243,243,243,243,243,243,242,242,242,242,241,241,241,241,240,240,240,239,239,239,239,239,238,238,238,238,238,238,238,238,239,239,239,240,240,240,241,242,242,243,244,245,246,247,248,249,250,252,253,255]},ColorMap.MAPS_CUSTOM=["cubehelix","eosb","rainbow"],ColorMap.MAPS_NAMES=["native","grayscale"].concat(ColorMap.MAPS_CUSTOM),ColorMap.prototype.reverse=function(t){this.reversed=t||!this.reversed,this.sig=this.signature(),this.view.requestRedraw()},ColorMap.prototype.signature=function(){var t=this.mapName;return this.reversed&&(t+=" reversed"),t},ColorMap.prototype.update=function(t){this.mapName=t,this.sig=this.signature(),this.view.requestRedraw()},ColorMap.prototype.apply=function(t){if("native"==this.sig)return t;if(t.cmSig==this.sig)return t.cmImg;var e=document.createElement("canvas");e.width=t.width,e.height=t.height;var i=e.getContext("2d");i.drawImage(t,0,0);var r,o,s,n=i.getImageData(0,0,e.width,e.height),a=n.data,l=a.length,h=3;"grayscale"==this.mapName?h=1:0<=ColorMap.MAPS_CUSTOM.indexOf(this.mapName)&&(h=2);for(var c=0;c<l;c+=4){switch(h){case 1:r=o=s=AladinUtils.myRound((a[c]+a[c+1]+a[c+2])/3);break;case 2:s=this.reversed?(r=ColorMap.MAPS[this.mapName].r[255-a[c]],o=ColorMap.MAPS[this.mapName].g[255-a[c+1]],ColorMap.MAPS[this.mapName].b[255-a[c+2]]):(r=ColorMap.MAPS[this.mapName].r[a[c]],o=ColorMap.MAPS[this.mapName].g[a[c+1]],ColorMap.MAPS[this.mapName].b[a[c+2]]);break;default:r=a[c],o=a[c+1],s=a[c+2]}2!=h&&this.reversed&&(r=255-r,o=255-o,s=255-s),a[c]=r,a[c+1]=o,a[c+2]=s}return n.data=a,i.putImageData(n,0,0),t.cmSig=this.sig,t.cmImg=e,t.cmImg},ColorMap),HpxKey=function(){"use strict";function r(t,e,i,r,o,s,n,a,l){this.norder=t,this.npix=e,this.nside=Math.pow(2,t),this.hips=i,this.frame=i.cooFrame,this.width=r,this.height=o,this.dx=s||0,this.dy=n||0,this.allskyTexture=a||void 0,this.allskyTextureSize=l,this.parente=0,this.children=null,this.ancestor=null}r.createHpxKeyfromAncestor=function(t,e){e=new r(t.norder+1,4n*t.npix+BigInt(e),t.hips,t.width/2,t.height/2,2==e||3==e?t.dx+t.width/2:t.dx,1==e||3==e?t.dy+t.height/2:t.dy,t.allskyTexture,t.allskyTextureSize);return e.parente=t.parente+1,e.ancestor=t.ancestor||t,e};r.prototype={draw:function(t,e,i,r){var o=0,s=this.getProjViewCorners(i);if(null==s)return 0;var n=(new Date).getTime(),a=null==this.ancestor&&3<=this.norder&&.1<n-this.hips.lastUpdateDateNeededTiles;try{if(g(s)){var l=this.drawChildren(t,e,i,r,4);if(0<l)return l}}catch(t){return console.log("error "+t),0}var h=(null==this.ancestor?this:this.ancestor).norder,c=(null==this.ancestor?this:this.ancestor).npix,u=this.hips.getTileURL(h,c);console.log("url is "+u);var d,p,f=this.hips.tileBuffer.getTile(u);return f&&Tile.isImageOk(f.img)||this.allskyTexture?(this.allskyTexture||this.hips.tileSize||(this.hips.tileSize=f.img.width),d=this.allskyTexture||f.img,p=this.allskyTextureSize||d.width,this.parente&&(p/=Math.pow(2,this.parente)),l=i.imageSurveys[r].blendingMode,c=i.imageSurveys[r].colorCorrection,r=i.imageSurveys[r].alpha,this.hips.drawOneTile2(l,c,t,e,d,s,p,r,this.dx,this.dy,!0,h),o+=2):a&&!f&&(f=this.hips.tileBuffer.addTile(u),i.downloader.requestDownload(f.img,f.url,this.hips.useCors),this.hips.lastUpdateDateNeededTiles=n,i.requestRedrawAtDate(n+HpxImageSurvey.UPDATE_NEEDED_TILES_DELAY+10)),o},drawChildren:function(t,e,i,r,o){var s=0;if(1<this.width&&this.norder<24&&this.parente<o){var n=this.getChildren();if(null!=n)for(var a=0;a<4;a++)null!=n[a]&&(s+=n[a].draw(t,e,i,r,o))}return s},getChildren:function(){if(null!=this.children)return this.children;for(var t=[],e=0;e<4;e++){var i=r.createHpxKeyfromAncestor(this,e);t[e]=i}return this.children=t,this.children},getProjViewCorners:function(t){var e=[],i=[],r=new SpatialVector;corners=HealpixCache.corners_nest(this.npix,this.nside);for(var o,s,n,a=0;a<4;a++)r.setXYZ(corners[a].x,corners[a].y,corners[a].z),this.frame.system!=t.cooFrame.system?this.frame.system==CooFrameEnum.SYSTEMS.J2000?(o=(n=CooConversion.J2000ToGalactic([r.ra(),r.dec()]))[0],s=n[1]):this.frame.system==CooFrameEnum.SYSTEMS.GAL&&(o=(n=CooConversion.GalacticToJ2000([r.ra(),r.dec()]))[0],s=n[1]):(o=r.ra(),s=r.dec()),e[a]=t.projection.project(o,s);if(null==e[0]||null==e[1]||null==e[2]||null==e[3])return null;for(a=0;a<4;a++)i[a]=AladinUtils.xyToView(e[a].X,e[a].Y,t.width,t.height,t.largestDim,t.zoomFactor);return i}};function o(t,e,i){var r=t[e].vx-t[i].vx,i=t[e].vy-t[i].vy;return r*r+i*i}var g=function(t){var e;if(78400<(e=o(t,0,2))||78400<(i=o(t,2,1)))return!0;if(0==e||0==i)throw"Rhomb error";var i=o(t,0,3),t=o(t,1,2);if(0==t)throw"Rhomb error";return(i<t?i/t:t/i)<.7&&(22500<i||22500<t)};return r}(),HpxImageSurvey=function(){function A(t,e,i,r,o,s){var n;t instanceof HiPSDefinition?this.hipsDefinition=t:(n={},this.id=t,n.ID=this.id,this.name=e,n.obs_title=this.name,"/"===i.slice(-1)?this.rootUrl=i.substr(0,i.length-1):this.rootUrl=i,this.additionalParams=s&&s.additionalParams||null,this.rootUrl=Utils.getAbsoluteURL(this.rootUrl),Utils.isHttpsContext()&&(/u-strasbg.fr/i.test(this.rootUrl)||/unistra.fr/i.test(this.rootUrl))&&(this.rootUrl=this.rootUrl.replace("http://","https://")),this.imgFormat=(s=s||{}).imgFormat||"jpg",this.minOrder=s.minOrder||null,this.cooFrame=CooFrameEnum.fromString(r,CooFrameEnum.J2000),this.longitudeReversed=s.longitudeReversed||!1,0<=this.rootUrl.indexOf("/glimpse360/aladin/data")&&(this.cooFrame=CooFrameEnum.J2000),this.maxOrder=o,this.hipsDefinition=HiPSDefinition.fromProperties(n)),this.ascendingLongitude=!1,this.tileSize=void 0,this.allskyTexture=null,this.alpha=s.alpha||0,this.allskyTextureSize=0;for(var a=!1,l=this.lastUpdateDateNeededTiles=0;l<A.SURVEYS.length;l++)A.SURVEYS[l].id==this.id&&(a=!0);a||A.SURVEYS.push({id:this.id,url:this.rootUrl,name:this.name,maxOrder:this.maxOrder,frame:this.cooFrame}),this.blendingMode=s.blendingMode,this.colorCorrection=s.colorCorrection,A.SURVEYS_OBJECTS[this.id]=this}A.UPDATE_NEEDED_TILES_DELAY=1e3,A.prototype.init=function(t,r){this.view=t,this.cm||(this.cm=new ColorMap(this.view)),this.tileBuffer=new TileBuffer,this.view.tileBuffers.push(this.tileBuffer),this.useCors=!1;var o=this;$.support.cors?$.ajax({type:"GET",url:this.rootUrl+"/properties"+(this.additionalParams?"?"+this.additionalParams:""),dataType:"text",xhrFields:{},headers:{},success:function(){o.useCors=!0,o.retrieveAllskyTextures(),r&&r()},error:function(t,e,i){console.log("CORS not supported"),o.retrieveAllskyTextures(),r&&r()}}):(this.retrieveAllskyTextures(),r())},A.DEFAULT_SURVEY_ID="P/DSS2/color",A.SURVEYS_OBJECTS={},A.SURVEYS=[{id:"P/2MASS/color",url:"http://alasky.u-strasbg.fr/2MASS/Color",name:"2MASS colored",maxOrder:9,frame:"equatorial",format:"jpeg",blendingMode:"overlay",colorCorrection:"#F00"},{id:"P/DSS2/color",url:"http://alasky.u-strasbg.fr/DSS/DSSColor",name:"DSS colored",maxOrder:9,frame:"equatorial",format:"jpeg",blendingMode:"sourceover",colorCorrection:"#000"},{id:"P/DSS2/red",url:"http://alasky.u-strasbg.fr/DSS/DSS2Merged",name:"DSS2 Red (F+R)",maxOrder:9,frame:"equatorial",format:"jpeg fits",blendingMode:"overlay",colorCorrection:"#F00"},{id:"P/PanSTARRS/DR1/g",url:"http://alasky.u-strasbg.fr/Pan-STARRS/DR1/g",name:"PanSTARRS DR1 g",maxOrder:11,frame:"equatorial",format:"jpeg fits",blendingMode:"overlay",colorCorrection:"#0F0"},{id:"P/PanSTARRS/DR1/color-z-zg-g",url:"http://alasky.u-strasbg.fr/Pan-STARRS/DR1/color-z-zg-g",name:"PanSTARRS DR1 color",maxOrder:11,frame:"equatorial",format:"jpeg",blendingMode:"overlay",colorCorrection:"#00F"},{id:"P/DECaPS/DR1/color",url:"http://alasky.u-strasbg.fr/DECaPS/DR1/color",name:"DECaPS DR1 color",maxOrder:11,frame:"equatorial",format:"jpeg png"},{id:"P/Fermi/color",url:"http://alasky.u-strasbg.fr/Fermi/Color",name:"Fermi color",maxOrder:3,frame:"equatorial",format:"jpeg"},{id:"P/Finkbeiner",url:"http://alasky.u-strasbg.fr/FinkbeinerHalpha",maxOrder:3,frame:"galactic",format:"jpeg fits",name:"Halpha"},{id:"P/GALEXGR6/AIS/color",url:"http://alasky.unistra.fr/GALEX/GR6-03-2014/AIS-Color",name:"GALEX Allsky Imaging Survey colored",maxOrder:8,frame:"equatorial",format:"jpeg",blendingMode:"overlay",colorCorrection:"#F00"},{id:"P/IRIS/color",url:"http://alasky.u-strasbg.fr/IRISColor",name:"IRIS colored",maxOrder:3,frame:"galactic",format:"jpeg"},{id:"P/Mellinger/color",url:"http://alasky.u-strasbg.fr/MellingerRGB",name:"Mellinger colored",maxOrder:4,frame:"galactic",format:"jpeg"},{id:"P/SDSS9/color",url:"http://alasky.u-strasbg.fr/SDSS/DR9/color",name:"SDSS9 colored",maxOrder:10,frame:"equatorial",format:"jpeg"},{id:"P/SPITZER/color",url:"http://alasky.u-strasbg.fr/SpitzerI1I2I4color",name:"IRAC color I1,I2,I4 - (GLIMPSE, SAGE, SAGE-SMC, SINGS)",maxOrder:9,frame:"galactic",format:"jpeg"},{id:"P/VTSS/Ha",url:"http://alasky.u-strasbg.fr/VTSS/Ha",maxOrder:3,frame:"galactic",format:"png jpeg fits",name:"VTSS-Ha"},{id:"P/XMM/EPIC",url:"http://saada.u-strasbg.fr/xmmallsky",name:"XMM-Newton stacked EPIC images (no phot. normalization)",maxOrder:7,frame:"equatorial",format:"png fits"},{id:"P/XMM/PN/color",url:"http://saada.unistra.fr/PNColor",name:"XMM PN colored",maxOrder:7,frame:"equatorial",format:"png jpeg"},{id:"P/allWISE/color",url:"http://alasky.u-strasbg.fr/AllWISE/RGB-W4-W2-W1/",name:"AllWISE color",maxOrder:8,frame:"equatorial",format:"jpeg",blendingMode:"overlay",colorCorrection:"#F00"},{id:"P/GLIMPSE360",url:"http://www.spitzer.caltech.edu/glimpse360/aladin/data",name:"GLIMPSE360",maxOrder:9,frame:"equatorial",format:"jpeg"},{id:"P/HST/V",url:"http://alasky.u-strasbg.fr/HST-hips/filter_V_hips",name:"HST V",maxOrder:13,frame:"equatorial",format:"png fits"}],A.getAvailableSurveys=function(){return A.SURVEYS},A.getSurveyInfoFromId=function(t){for(var e=A.getAvailableSurveys(),i=0;i<e.length;i++)if(e[i].id==t)return e[i];return null},A.getSurveyFromId=function(t,e,i,r){if(A.SURVEYS_OBJECTS[t]){var o=A.SURVEYS_OBJECTS[t];return o.blendingMode=e,o.colorCorrection=i,o.alpha=r,o}t=A.getSurveyInfoFromId(t);if(t){r={blendingMode:e,colorCorrection:i,alpha:r};return t.format&&t.format.indexOf("jpeg")<0&&0<=t.format.indexOf("png")&&(r.imgFormat="png"),new A(t.id,t.name,t.url,t.frame,t.maxOrder,r)}return null},A.prototype.getTileURL=function(t,e){return this.rootUrl+"/Norder"+t+"/Dir"+e/10000n*10000n+"/Npix"+e+"."+this.imgFormat+(this.additionalParams?"?"+this.additionalParams:"")},A.prototype.retrieveAllskyTextures=function(){var t=new Blob(["self.addEventListener('message', async event => {const imageURL = event.data;const response = await fetch(imageURL);const blob = await response.blob();self.postMessage(imageURL: imageURL,blob: blob});})"],{type:"application/javascript"}),e=this,i=new Image;this.useCors&&(i.crossOrigin="anonymous");const r=new Worker(t);r.addEventListener("message",t=>{t=t.data,t=URL.createObjectURL(t.blob);i.onload=function(){console.log("loaded image"),e.allskyTextureSize=i.width/27,e.allskyTexture=i,e.view.requestRedraw()},i.src=t});t=this.rootUrl+"/Norder3/Allsky."+this.imgFormat+(this.additionalParams?"?"+this.additionalParams:"");r.postMessage(t)},A.prototype.draw=function(t,e,i,r,o,s){o=void 0!==o&&o;var n=i.getVisibleCells(3,this.cooFrame),a=null,l=Math.min(s,this.maxOrder);if(3<=s&&(a=3==s?n:i.getVisibleCells(l,this.cooFrame)),o)return s<=4&&this.drawAllsky(t,e,n,l,i,r),void(3<=s&&this.drawHighres(t,e,a,l,i,r));3<=i.curNorder?this.redrawHighres(blend,hue,t,e,a,i.curNorder):this.redrawAllsky(blend,hue,t,e,n,i.fov,i.curNorder)},A.prototype.drawHighres=function(t,e,i,r,o,s){for(var n=[],a={},l={},h=0;h<i.length;h++){var c=i[h].ipix,u=this.getTileURL(r,c),u=this.tileBuffer.getTile(u);if(!(u&&Tile.isImageOk(u.img)))for(var d=r-1;3<=d&&r-4<=d;d--){var p=~~(c/BigInt(Math.pow(4,r-d))),f=d+"-"+p;if(!0===a[f]||!0===l)break;var g=this.getTileURL(d,p),g=this.tileBuffer.getTile(g);if(g&&Tile.isImageOk(g.img)){n.push({ipix:p,order:d}),a[f]=!0;break}l[f]=!0}}for(var n=n.sort(function(t,e){return t.order-e.order}),v=this.tileSize||512,h=0;h<n.length;h++){var m=n[h];new HpxKey(m.order,m.ipix,this,v,v).draw(t,e,o,s)}for(h=0;h<i.length;h++)new HpxKey(r,i[h].ipix,this,v,v).draw(t,e,o,s)},A.prototype.drawAllsky=function(t,e,i,r,o,s){if(!(6<this.view.curNorder)&&this.allskyTexture&&Tile.isImageOk(this.allskyTexture)){for(var n,a,l=[],h=0;h<i.length;h++)n=i[h].ipix,a=this.allskyTextureSize*Math.floor(n/27),n=this.allskyTextureSize*(n-27*Math.floor(n/27)),l.push(new HpxKey(3,i[h].ipix,this,this.allskyTextureSize,this.allskyTextureSize,n,a,this.allskyTexture,this.allskyTextureSize));for(h=0;h<l.length;h++)l[h].draw(t,e,o,s)}},A.prototype.redrawAllsky=function(t,e,i,r,o,s,n,a){if(!(6<this.view.curNorder)&&this.allskyTexture)for(var l,h=0,c=s.length;h<c;h++)if(d=(l=s[h]).ipix,this.allskyTexture&&Tile.isImageOk(this.allskyTexture)){var u=this.allskyTextureSize*Math.floor(d/27),d=this.allskyTextureSize*(d-27*Math.floor(d/27));if(40<n){0;for(var p={x:(l[0].vx+l[2].vx)/2,y:(l[0].vy+l[2].vy)/2},f=0;f<4;f++){var g=l[f].vx-p.x,v=l[f].vy-p.y;l[f].vx+=0*g,l[f].vy+=0*v}}this.drawOneTile(t,e,r,o,this.allskyTexture,l,this.allskyTextureSize,null,d,u,!0)}},A.prototype.getColorMap=function(){return this.cm};var T=!0;function p(t,e,i,r,o,s,n,a,l,h,c,u,d,p,f,g,v,m,y,S,w){w=w||!1,u+=y=y||0,p+=y,g+=y,d+=S=S||0,f+=S,v+=S;y=(s+a+h)/3,S=(n+l+c)/3;i.save(),r.save(),m&&(i.globalAlpha=m,r.globalAlpha=m),coeff=.02,i.beginPath(),i.moveTo((1+coeff)*s-y*coeff,(1+coeff)*n-S*coeff),i.lineTo((1+coeff)*a-y*coeff,(1+coeff)*l-S*coeff),i.lineTo((1+coeff)*h-y*coeff,(1+coeff)*c-S*coeff),i.closePath(),i.clip(),w&&(coeff=.01,s=(1+coeff)*s-y*coeff,n=(1+coeff)*n-S*coeff,a=(1+coeff)*a-y*coeff,l=(1+coeff)*l-S*coeff,h=(1+coeff)*h-y*coeff,c=(1+coeff)*c-S*coeff);S=1/(u*(v-f)-p*v+g*f+(p-g)*d);i.transform(-(d*(h-a)-f*h+v*a+(f-v)*s)*S,(f*c+d*(l-c)-v*l+(v-f)*n)*S,(u*(h-a)-p*h+g*a+(p-g)*s)*S,-(p*c+u*(l-c)-g*l+(g-p)*n)*S,(u*(v*a-f*h)+d*(p*h-g*a)+(g*f-p*v)*s)*S,(u*(v*l-f*c)+d*(p*c-g*l)+(g*f-p*v)*n)*S),"#000"!=e?(n=o,S=e,(e=r).drawImage(n,0,0),e.globalCompositeOperation=BlendingModeEnum.multiply,e.fillStyle=S,e.fillRect(0,0,n.width,n.height),n=$(this.document.getElementById("aladin-lite-div")).children()[5],i.globalCompositeOperation="lighten",i.globalAlpha=m,i.drawImage(n,0,0),r.clearRect(0,0,r.canvas.width,r.canvas.height)):(i.globalCompositeOperation=t,i.drawImage(o,0,0)),i.restore(),r.restore()}function u(t,e,i,r,o,s,n,a,l,h,c,u,d,p,f,g,v,m,y){y=y||!1,h+=v=v||0,u+=v,p+=v,c+=m=m||0,d+=m,f+=m;v=(r+s+a)/3,m=(o+n+l)/3;t.save(),g&&(t.globalAlpha=g);g=.01;t.beginPath(),t.moveTo((1+g)*r-v*g,(1+g)*o-m*g),t.lineTo((1+g)*s-v*g,(1+g)*n-m*g),t.lineTo((1+g)*a-v*g,(1+g)*l-m*g),t.closePath(),t.clip(),y&&(r=(1+(g=.03))*r-v*g,o=(1+g)*o-m*g,s=(1+g)*s-v*g,n=(1+g)*n-m*g,a=(1+g)*a-v*g,l=(1+g)*l-m*g);g=1/(h*(f-d)-u*f+p*d+(u-p)*c);t.transform(-(c*(a-s)-d*a+f*s+(d-f)*r)*g,(d*l+c*(n-l)-f*n+(f-d)*o)*g,(h*(a-s)-u*a+p*s+(u-p)*r)*g,-(u*l+h*(n-l)-p*n+(p-u)*o)*g,(h*(f*s-d*a)+c*(u*a-p*s)+(p*d-u*f)*r)*g,(h*(f*n-d*l)+c*(u*l-p*n)+(p*d-u*f)*o)*g),t.drawImage(i,0,0),t.restore()}return A.prototype.redrawHighres=function(t,e,i,r,o,s){if(0!=o.length){T=!T;var n,a,l,h,c,u,d=(new Date).getTime(),p=d-this.lastUpdateDateNeededTiles>A.UPDATE_NEEDED_TILES_DELAY,f=s-1,g=[],v=[],m={},y=!1,S=[],w=[];p&&(u=[(o[0][0].vx+o[0][1].vx)/2,(o[0][0].vy+o[0][1].vy)/2],o=o.sort(function(t,e){t=[(t[0].vx+t[2].vx)/2,(t[0].vy+t[2].vy)/2],e=[(e[0].vx+e[2].vx)/2,(e[0].vy+e[2].vy)/2];return(t[0]-u[0])*(t[0]-u[0])+(t[1]-u[1])*(t[1]-u[1])-((e[0]-u[0])*(e[0]-u[0])+(e[1]-u[1])*(e[1]-u[1]))}));for(var C=0,x=o.length;C<x;C++){var I=(l=o[C]).ipix,_=this.getTileURL(f,c=~~(I/4));p&&3<=f&&(a=this.tileBuffer.addTile(_))&&w.push({img:a.img,url:_}),n=this.getTileURL(s,I),(I=this.tileBuffer.getTile(n))?Tile.isImageOk(I.img)?g.push({img:I.img,corners:l}):(y=!0,p&&!I.img.dlError&&S.push({img:I.img,url:n}),3<=f&&!m[c]&&((a=this.tileBuffer.getTile(_))&&Tile.isImageOk(a.img)&&(h=this.view.getPositionsInView(c,f))&&v.push({img:a.img,corners:h,ipix:c}),m[c]=1)):(y=!0,p&&(I=this.tileBuffer.addTile(n))&&S.push({img:I.img,url:n}),3<=f&&!m[c]&&((a=this.tileBuffer.getPositionsInViewTile(_))&&Tile.isImageOk(a.img)&&(h=this.view.getPositionsInView(c,f))&&v.push({img:a.img,corners:h,ipix:c}),m[c]=1))}for(C=0,x=v.length;C<x;C++)this.drawOneTile(t,e,i,r,v[C].img,v[C].corners,v[C].img.width,b);for(C=0,x=g.length;C<x;C++){var b=null,M=g[C].img;M.fadingStart&&M.fadingEnd&&d<M.fadingEnd&&(b=.2+(d-M.fadingStart)/(M.fadingEnd-M.fadingStart)*.8,this.requestRedraw()),this.drawOneTile(t,e,i,r,M,g[C].corners,M.width,b)}if(p){for(C=0,x=S.length;C<x;C++)this.view.downloader.requestDownload(S[C].img,S[C].url,this.useCors);for(C=0,x=w.length;C<x;C++)this.view.downloader.requestDownload(w[C].img,w[C].url,this.useCors);this.lastUpdateDateNeededTiles=d}y&&this.view.requestRedrawAtDate(d+A.UPDATE_NEEDED_TILES_DELAY+10)}},A.prototype.drawOneTile=function(t,e,i,r,o,s,n,a,l,h,c){o=this.useCors?this.cm.apply(o):o;u(t,0,i,r,o,s[0].vx,s[0].vy,s[1].vx,s[1].vy,s[3].vx,s[3].vy,n-1,n-1,n-1,0,0,n-1,a,l),u(t,0,i,r,o,s[1].vx,s[1].vy,s[3].vx,s[3].vy,s[2].vx,s[2].vy,n-1,0,0,n-1,0,0,a,l)},A.prototype.drawOneTile2=function(t,e,i,r,o,s,n,a,l,h,c,u){var d=this.useCors?this.cm.apply(o):o,o=u<=3?n<100?.5:.2:0;p(t,e,i,r,d,s[0].vx,s[0].vy,s[1].vx,s[1].vy,s[3].vx,s[3].vy,n-o,n-o,n-o,0+o,0+o,n-o,a,l,h,c),p(t,e,i,r,d,s[1].vx,s[1].vy,s[3].vx,s[3].vy,s[2].vx,s[2].vy,n-o,0+o,0+o,n-o,0+o,0+o,a,l,h,c)},A.prototype.setAlpha=function(t){t=+t,this.alpha=Math.max(0,Math.min(t,1)),this.view.requestRedraw()},A.prototype.getAlpha=function(){return this.alpha},A}(),HealpixGrid=function(){function t(){}return t.prototype.redraw=function(t,e,i,r){var o;t.lineWidth=1,t.strokeStyle="rgb(150,150,220)",t.beginPath();for(var s=0,n=e.length;s<n;s++)o=e[s],ipix=o.ipix,t.moveTo(o[0].vx,o[0].vy),t.lineTo(o[1].vx,o[1].vy),t.lineTo(o[2].vx,o[2].vy);t.stroke(),t.strokeStyle="#FFDDDD",t.beginPath();for(s=0,n=e.length;s<n;s++)o=e[s],ipix=o.ipix,t.strokeText(r+"/"+ipix,(o[0].vx+o[2].vx)/2,(o[0].vy+o[2].vy)/2);t.stroke()},t}(),Location=(Location=function(t){this.$div=$(t)},Location.prototype.update=function(t,e,i,r){r=r&&!0===r||!1;e=new Coo(t,e,7);i==CooFrameEnum.J2000?this.$div.html(e.format("s/")):(CooFrameEnum.J2000d,this.$div.html(e.format("d/"))),this.$div.toggleClass("aladin-reticleColor",r)},Location),View=function(){function f(t,e,i,r,o){this.aladin=t,this.options=t.options,this.aladinDiv=this.aladin.aladinDiv,this.popup=new Popup(this.aladinDiv,this),this.imageSurveys=[],this.createCanvases(),this.location=e,this.fovDiv=i,this.mustClearCatalog=!0,this.mustRedrawReticle=!0,this.mode=f.PAN,this.minFOV=this.maxFOV=null,this.healpixGrid=new HealpixGrid(this.imageCanvas),this.cooFrame=r||CooFrameEnum.GAL,this.projectionMethod=ProjectionEnum.SIN,this.projection=new Projection(0,0),this.projection.setProjection(this.projectionMethod),this.zoomLevel=0,this.zoomFactor=this.computeZoomFactor(this.zoomLevel),this.viewCenter={lon:0,lat:0},o&&this.setZoom(o),this.catalogs=[];r=document.createElement("canvas");r.width=r.height=24;o=r.getContext("2d");o.lineWidth=6,o.beginPath(),o.strokeStyle="#eee",o.arc(12,12,8,0,2*Math.PI,!0),o.stroke(),o.lineWidth=3,o.beginPath(),o.strokeStyle="#c38",o.arc(12,12,8,0,2*Math.PI,!0),o.stroke(),this.catalogForPopup=A.catalog({shape:r,sourceSize:24}),this.catalogForPopup.hide(),this.catalogForPopup.setView(this),this.overlays=[],this.mocs=[],this.allOverlayLayers=[],this.tileBuffers=[],this.fixLayoutDimensions(),this.curNorder=1,this.realNorder=1,this.curOverlayNorder=1,this.dragging=!1,this.dragx=null,this.dragy=null,this.needRedraw=!0,this.pinchZoomParameters={isPinching:!1,initialFov:void 0,initialDistance:void 0},this.downloader=new Downloader(this),this.flagForceRedraw=!1,this.fadingLatestUpdate=null,this.dateRequestRedraw=null,this.showGrid=!1,n(this),this.resizeTimer=null;var s=this;$(window).resize(function(){clearTimeout(s.resizeTimer),s.resizeTimer=setTimeout(function(){s.fixLayoutDimensions(s)},100)}),setTimeout(function(){var t=$(s.aladinDiv).width(),e=$(s.aladinDiv).height();s.width===t&&s.height!==e||(s.fixLayoutDimensions(),s.setZoomLevel(s.zoomLevel))},1e3)}f.PAN=0,f.SELECT=1,f.TOOL_SIMBAD_POINTER=2,f.DRAW_SOURCES_WHILE_DRAGGING=!0,f.DRAW_MOCS_WHILE_DRAGGING=!0,f.CALLBACKS_THROTTLE_TIME_MS=100,f.prototype.addTileBuffer=function(){this.tileBuffers.push(new TileBuffer)},f.prototype.createCanvases=function(){var t=$(this.aladinDiv);t.find(".aladin-blendCanvas").remove(),t.find(".aladin-imageCanvas").remove(),t.find(".aladin-catalogCanvas").remove(),t.find(".aladin-reticleCanvas").remove(),this.blendCanvas=$("<canvas class='aladin-blendCanvas'></canvas>").appendTo(this.aladinDiv)[0],this.imageCanvas=$("<canvas class='aladin-imageCanvas'></canvas>").appendTo(this.aladinDiv)[0],this.catalogCanvas=$("<canvas class='aladin-catalogCanvas'></canvas>").appendTo(this.aladinDiv)[0],this.reticleCanvas=$("<canvas class='aladin-reticleCanvas'></canvas>").appendTo(this.aladinDiv)[0]},f.prototype.fixLayoutDimensions=function(){Utils.cssScale=void 0;var t=$(this.aladinDiv).width(),e=$(this.aladinDiv).height();this.width=Math.max(t,1),this.height=Math.max(e,1),this.cx=this.width/2,this.cy=this.height/2,this.largestDim=Math.max(this.width,this.height),this.smallestDim=Math.min(this.width,this.height),this.ratio=this.largestDim/this.smallestDim,this.mouseMoveIncrement=160/this.largestDim,this.blendCtx=this.blendCanvas.getContext("2d"),this.imageCtx=this.imageCanvas.getContext("2d"),this.catalogCtx=this.catalogCanvas.getContext("2d"),this.reticleCtx=this.reticleCanvas.getContext("2d"),this.blendCtx.canvas.width=this.width,this.imageCtx.canvas.width=this.width,this.catalogCtx.canvas.width=this.width,this.reticleCtx.canvas.width=this.width,this.blendCtx.canvas.height=this.height,this.imageCtx.canvas.height=this.height,this.catalogCtx.canvas.height=this.height,this.reticleCtx.canvas.height=this.height,r(this.blendCtx,this.aladin.options.pixelateCanvas),r(this.imageCtx,this.aladin.options.pixelateCanvas),this.logoDiv||(this.logoDiv=$(this.aladinDiv).find(".aladin-logo")[0]),800<this.width?($(this.logoDiv).removeClass("aladin-logo-small"),$(this.logoDiv).addClass("aladin-logo-large"),$(this.logoDiv).css("width","90px")):($(this.logoDiv).addClass("aladin-logo-small"),$(this.logoDiv).removeClass("aladin-logo-large"),$(this.logoDiv).css("width","32px")),this.computeNorder(),this.requestRedraw()};var r=function(t,e){e=!e;t.imageSmoothingEnabled=e,t.webkitImageSmoothingEnabled=e,t.mozImageSmoothingEnabled=e,t.msImageSmoothingEnabled=e,t.oImageSmoothingEnabled=e};f.prototype.setMode=function(t){this.mode=t,this.mode==f.SELECT?this.setCursor("crosshair"):this.mode==f.TOOL_SIMBAD_POINTER?(this.popup.hide(),this.reticleCanvas.style.cursor="",$(this.reticleCanvas).addClass("aladin-sp-cursor")):this.setCursor("default")},f.prototype.setCursor=function(t){this.reticleCanvas.style.cursor!=t&&this.mode!=f.TOOL_SIMBAD_POINTER&&(this.reticleCanvas.style.cursor=t)},f.prototype.getCanvasDataURL=function(t,e,i){t=t||"image/png";var r=document.createElement("canvas");e=e||this.width,i=i||this.height,r.width=e,r.height=i;i=r.getContext("2d");return i.drawImage(this.imageCanvas,0,0,r.width,r.height),i.drawImage(this.catalogCanvas,0,0,r.width,r.height),i.drawImage(this.reticleCanvas,0,0,r.width,r.height),r.toDataURL(t)},f.prototype.getCanvasSkymapDataURL=function(t,e,i){t=t||"image/png";var r=document.createElement("canvas");return e=e||this.width,i=i||this.height,r.width=e,r.height=i,r.getContext("2d").drawImage(this.imageCanvas,0,0,r.width,r.height),r.toDataURL(t)},computeFov=function(t){var e=doComputeFov(t,t.zoomFactor);return t.mouseMoveIncrement=e/t.imageCanvas.width,e},doComputeFov=function(t,e){var i;return t.zoomFactor<1?180:(i=AladinUtils.viewToXy(0,t.cy,t.width,t.height,t.largestDim,e),i=t.projection.unproject(i.x,i.y),e=AladinUtils.viewToXy(t.imageCanvas.width-1,t.cy,t.width,t.height,t.largestDim,e),e=t.projection.unproject(e.x,e.y),new Coo(i.ra,i.dec).distance(new Coo(e.ra,e.dec)))},updateFovDiv=function(t){var e;isNaN(t.fov)?t.fovDiv.html("FoV:"):(e=1<t.fov?Math.round(100*t.fov)/100+"":1<60*t.fov?Math.round(60*t.fov*100)/100+"'":Math.round(3600*t.fov*100)/100+'"',t.fovDiv.html("FoV: "+e))},createListeners=function(a){var n,l=!1;"ontouchstart"in window&&(l=!0),onDblClick=function(t){t=a.imageCanvas.relMouseCoords(t),t=AladinUtils.viewToXy(t.x,t.y,a.width,a.height,a.largestDim,a.zoomFactor);try{var e=a.projection.unproject(t.x,t.y)}catch(t){return}radec=[],radec=a.cooFrame.system==CooFrameEnum.SYSTEMS.GAL?CooConversion.GalacticToJ2000([e.ra,e.dec]):[e.ra,e.dec],a.pointTo(radec[0],radec[1])},l||$(a.reticleCanvas).dblclick(onDblClick),$(a.reticleCanvas).bind("mousedown touchstart",function(t){if("touchstart"===t.type&&t.originalEvent&&t.originalEvent.targetTouches&&2==t.originalEvent.targetTouches.length){a.dragging=!1,a.pinchZoomParameters.isPinching=!0;var e=a.aladin.getFov();return a.pinchZoomParameters.initialFov=Math.max(e[0],e[1]),void(a.pinchZoomParameters.initialDistance=Math.sqrt(Math.pow(t.originalEvent.targetTouches[0].clientX-t.originalEvent.targetTouches[1].clientX,2)+Math.pow(t.originalEvent.targetTouches[0].clientY-t.originalEvent.targetTouches[1].clientY,2)))}e=a.imageCanvas.relMouseCoords(t);return t.originalEvent&&t.originalEvent.targetTouches?(a.dragx=t.originalEvent.targetTouches[0].clientX,a.dragy=t.originalEvent.targetTouches[0].clientY):(a.dragx=e.x,a.dragy=e.y),a.dragging=!0,a.mode==f.PAN?a.setCursor("move"):a.mode==f.SELECT&&(a.selectStartCoo={x:a.dragx,y:a.dragy}),!1}),$(a.reticleCanvas).bind("click mouseout touchend",function(t){if("touchend"===t.type&&a.pinchZoomParameters.isPinching)return a.pinchZoomParameters.isPinching=!1,void(a.pinchZoomParameters.initialFov=a.pinchZoomParameters.initialDistance=void 0);var e,i=!0===a.realDragging,r=a.mode===f.SELECT&&a.dragging;if(a.dragging&&(a.setCursor("default"),a.dragging=!1,i&&(a.realDragging=!1,"function"==typeof(e=a.aladin.callbacksByEventName.positionChanged)&&void 0!==(s=a.aladin.pix2world(a.width/2,a.height/2))&&e({ra:s[0],dec:s[1],dragging:!1}))),r)return a.aladin.fire("selectend",a.getObjectsInBBox(a.selectStartCoo.x,a.selectStartCoo.y,a.dragx-a.selectStartCoo.x,a.dragy-a.selectStartCoo.y)),a.mustRedrawReticle=!0,void a.requestRedraw();if(a.mustClearCatalog=!0,a.mustRedrawReticle=!0,a.dragx=a.dragy=null,"mouseout"!==t.type&&"touchend"!==t.type||(a.requestRedraw(!0),c(a,a.width/2,a.height/2,!0),"mouseout"!==t.type)){t=a.imageCanvas.relMouseCoords(t);if(a.mode==f.TOOL_SIMBAD_POINTER){var o=a.aladin.pix2world(t.x,t.y);return a.setMode(f.PAN),a.setCursor("wait"),void SimbadPointer.query(o[0],o[1],Math.min(1,15*a.fov/a.largestDim),a.aladin)}o=a.closestObjects(t.x,t.y,5);!i&&o?((o=o[0])instanceof Footprint||o instanceof Circle?o.dispatchClickEvent():o.marker?(a.popup.setTitle(o.popupTitle),a.popup.setText(o.popupDesc),a.popup.setSource(o),a.popup.show()):(a.lastClickedObject&&a.lastClickedObject.actionOtherObjectClicked&&a.lastClickedObject.actionOtherObjectClicked(),o.actionClicked()),a.lastClickedObject=o,"function"==typeof(n=a.aladin.callbacksByEventName.objectClicked)&&n(o)):a.lastClickedObject&&!i&&(a.aladin.measurementTable.hide(),a.popup.hide(),a.lastClickedObject instanceof Footprint||a.lastClickedObject.actionOtherObjectClicked(),a.lastClickedObject=null,"function"==typeof(n=a.aladin.callbacksByEventName.objectClicked)&&n(null));var s,n=a.aladin.callbacksByEventName.click;"function"==typeof n&&void 0!==(s=a.aladin.pix2world(t.x,t.y))&&n({ra:s[0],dec:s[1],x:t.x,y:t.y,isDragging:i}),a.refreshProgressiveCats(),a.requestRedraw(!0)}else a.mode===f.TOOL_SIMBAD_POINTER&&a.setMode(f.PAN)});var h=null;$(a.reticleCanvas).bind("mousemove touchmove",function(t){if(t.preventDefault(),"touchmove"===t.type&&a.pinchZoomParameters.isPinching&&t.originalEvent&&t.originalEvent.touches&&2==t.originalEvent.touches.length){var e=Math.sqrt(Math.pow(t.originalEvent.touches[0].clientX-t.originalEvent.touches[1].clientX,2)+Math.pow(t.originalEvent.touches[0].clientY-t.originalEvent.touches[1].clientY,2));a.setZoom(a.pinchZoomParameters.initialFov*a.pinchZoomParameters.initialDistance/e)}else{var i=a.imageCanvas.relMouseCoords(t);if(!a.dragging||l){c(a,i.x,i.y);var r,o,s=a.aladin.callbacksByEventName.mouseMove;if("function"==typeof s&&(void 0!==(e=a.aladin.pix2world(i.x,i.y))?s({ra:e[0],dec:e[1],x:i.x,y:i.y}):null!=h&&s({ra:null,dec:null,x:i.x,y:i.y}),h=e),a.dragging||!a.mode!=f.SELECT||((r=a.closestObjects(i.x,i.y,5))?(a.setCursor("pointer"),"function"==typeof(o=a.aladin.callbacksByEventName.objectHovered)&&r[0]!=n&&o(r[0]),n=r[0]):(a.setCursor("default"),"function"==typeof(o=a.aladin.callbacksByEventName.objectHovered)&&n&&o(n=null))),!l)return}a.dragging&&(o=(r=(o=(r=t.originalEvent&&t.originalEvent.targetTouches?(t.originalEvent.targetTouches[0].clientX,a.dragx,t.originalEvent.targetTouches[0].clientY,a.dragy,AladinUtils.viewToXy(t.originalEvent.targetTouches[0].clientX,t.originalEvent.targetTouches[0].clientY,a.width,a.height,a.largestDim,a.zoomFactor)):(i.x,a.dragx,i.y,a.dragy,AladinUtils.viewToXy(i.x,i.y,a.width,a.height,a.largestDim,a.zoomFactor)),AladinUtils.viewToXy(a.dragx,a.dragy,a.width,a.height,a.largestDim,a.zoomFactor)),a.projection.unproject(r.x,r.y)),a.projection.unproject(o.x,o.y)),t.originalEvent&&t.originalEvent.targetTouches?(a.dragx=t.originalEvent.targetTouches[0].clientX,a.dragy=t.originalEvent.targetTouches[0].clientY):(a.dragx=i.x,a.dragy=i.y),a.mode!=f.SELECT&&(a.viewCenter.lon+=o.ra-r.ra,a.viewCenter.lat+=o.dec-r.dec,90<a.viewCenter.lat?a.viewCenter.lat=90:a.viewCenter.lat<-90&&(a.viewCenter.lat=-90),a.viewCenter.lon<0?a.viewCenter.lon=360+a.viewCenter.lon:360<a.viewCenter.lon&&(a.viewCenter.lon=a.viewCenter.lon%360),a.realDragging=!0),a.requestRedraw())}}),$(a.aladinDiv).onselectstart=function(){return!1},$(a.reticleCanvas).on("mousewheel",function(t){t.preventDefault(),t.stopPropagation();var e=a.zoomLevel,i=t.deltaY;return 0<(i=t.hasOwnProperty("originalEvent")?-t.originalEvent.deltaY:i)?e+=1:--e,a.setZoomLevel(e),!1})};var n=function(o){var t=new Stats;t.domElement.style.top="50px",0<$("#aladin-statsDiv").length&&$("#aladin-statsDiv")[0].appendChild(t.domElement),o.stats=t,createListeners(o),o.executeCallbacksThrottled=Utils.throttle(function(){var t,e,i=o.aladin.pix2world(o.width/2,o.height/2),r=o.fov;void 0!==i&&void 0!==r&&(t=i[0],e=i[1],t===this.ra&&e===this.dec||("function"==typeof(i=o.aladin.callbacksByEventName.positionChanged)&&i({ra:t,dec:e,dragging:!0}),this.ra=t,this.dec=e),r!==this.old_fov&&("function"==typeof(e=o.aladin.callbacksByEventName.zoomChanged)&&e(r),this.old_fov=r))},f.CALLBACKS_THROTTLE_TIME_MS),o.displayHpxGrid=!1,o.displaySurvey=[],o.displayCatalog=!1,o.displayReticle=!0,o.fov=computeFov(o),updateFovDiv(o),o.redraw()};function c(t,e,i,r){if(t.projection){var o,i=AladinUtils.viewToXy(e,i,t.width,t.height,t.largestDim,t.zoomFactor);try{o=t.projection.unproject(i.x,i.y)}catch(t){}o&&t.location.update(o.ra,o.dec,t.cooFrame,r)}}f.prototype.requestRedrawAtDate=function(t){this.dateRequestDraw=t},f.prototype.getBackgroundColor=function(){var t="rgb(0, 0, 0)";if(!this.imageSurvey)return t;var e=this.imageSurvey.getColorMap();if(!e)return t;if("native"==e.mapName||"grayscale"==e.mapName)return e.reversed?"rgb(255, 255, 255)":t;t=e.reversed?255:0;return"rgb("+ColorMap.MAPS[e.mapName].r[t]+","+ColorMap.MAPS[e.mapName].g[t]+","+ColorMap.MAPS[e.mapName].b[t]+")"},f.prototype.getBackgroundColorAtIndex=function(t){var e="rgb(0, 0, 0)";if(!this.imageSurveys[t])return e;t=this.imageSurveys[t].getColorMap();if(!t)return e;if("native"==t.mapName||"grayscale"==t.mapName)return t.reversed?"rgb(255, 255, 255)":e;e=t.reversed?255:0;return"rgb("+ColorMap.MAPS[t.mapName].r[e]+","+ColorMap.MAPS[t.mapName].g[e]+","+ColorMap.MAPS[t.mapName].b[e]+")"},f.prototype.getViewParams=function(){var t=this.width>this.height?this.fov/this.width:this.fov/this.height;return{fov:[this.width*t,this.height*t],width:this.width,height:this.height}},f.prototype.redraw=function(){var t=this.needRedraw;requestAnimFrame(this.redraw.bind(this));var e=(new Date).getTime();if(this.dateRequestDraw&&e>this.dateRequestDraw)this.dateRequestDraw=null;else if(!this.needRedraw){if(!this.flagForceRedraw)return;this.flagForceRedraw=!1}this.stats.update();var i=this.imageCtx;i.start2D&&i.start2D(),i.clearRect(0,0,this.imageCanvas.width,this.imageCanvas.height);var r=this.getBackgroundColorAtIndex(0);this.projectionMethod==ProjectionEnum.SIN?60<=this.fov?(i.fillStyle=r,i.beginPath(),u=this.cx>this.cy?this.cx:this.cy,i.arc(this.cx,this.cy,u*this.zoomFactor,0,2*Math.PI,!0),i.fill()):(i.fillStyle=r,i.fillRect(0,0,this.imageCanvas.width,this.imageCanvas.height)):this.projectionMethod==ProjectionEnum.AITOFF&&i.ellipse&&(i.fillStyle=r,i.beginPath(),i.ellipse(this.cx,this.cy,2.828*this.cx*this.zoomFactor,this.cx*this.zoomFactor*1.414,0,0,2*Math.PI),i.fill()),i.finish2D&&i.finish2D(),this.projection.setCenter(this.viewCenter.lon,this.viewCenter.lat),this.projection.setProjection(this.projectionMethod);var o=null,s=this.clearBlendCanvas();for(const[a,p]of this.imageSurveys.entries())p&&p.isReady&&this.displaySurvey[a]&&(null==this.aladin.reduceDeformations?p.draw(i,s,this,a,!this.dragging,this.curNorder):p.draw(i,s,this,a,this.aladin.reduceDeformations,this.curNorder));this.overlayImageSurvey&&this.overlayImageSurvey.isReady&&(i.globalAlpha=this.overlayImageSurvey.getAlpha(),null==this.aladin.reduceDeformations?this.overlayImageSurvey.draw(i,s,this,-1,!this.dragging,this.curOverlayNorder):this.overlayImageSurvey.draw(i,s,this,-1,this.aladin.reduceDeformations,this.curOverlayNorder),i.globalAlpha=1),this.displayHpxGrid&&(c=this.getVisibleCells(3),o=null,(o=3<=this.curNorder?3==this.curNorder?c:this.getVisibleCells(this.curNorder):o)&&3<this.curNorder?this.healpixGrid.redraw(i,o,this.fov,this.curNorder):this.healpixGrid.redraw(i,c,this.fov,3)),this.showGrid&&(null==this.cooGrid&&(this.cooGrid=new CooGrid),this.cooGrid.redraw(i,this.projection,this.cooFrame,this.width,this.height,this.largestDim,this.zoomFactor,this.fov));var n=this.catalogCtx,e=!1;if(this.mustClearCatalog&&(n.clearRect(0,0,this.width,this.height),this.mustClearCatalog=!(e=!0)),this.catalogs&&0<this.catalogs.length&&this.displayCatalog&&(!this.dragging||f.DRAW_SOURCES_WHILE_DRAGGING)){e||(n.clearRect(0,0,this.width,this.height),e=!0);for(var a=0;a<this.catalogs.length;a++)this.catalogs[a].draw(n,this.projection,this.cooFrame,this.width,this.height,this.largestDim,this.zoomFactor)}this.catalogForPopup.isShowing&&0<this.catalogForPopup.sources.length&&(e||(n.clearRect(0,0,this.width,this.height),e=!0),this.catalogForPopup.draw(n,this.projection,this.cooFrame,this.width,this.height,this.largestDim,this.zoomFactor));var l=this.catalogCtx;if(this.overlays&&0<this.overlays.length&&(!this.dragging||f.DRAW_SOURCES_WHILE_DRAGGING)){e||(n.clearRect(0,0,this.width,this.height),e=!0);for(a=0;a<this.overlays.length;a++)this.overlays[a].draw(l,this.projection,this.cooFrame,this.width,this.height,this.largestDim,this.zoomFactor)}var h=this.catalogCtx;if(this.mocs&&0<this.mocs.length&&(!this.dragging||f.DRAW_MOCS_WHILE_DRAGGING)){e||(n.clearRect(0,0,this.width,this.height),e=!0);for(a=0;a<this.mocs.length;a++)this.mocs[a].draw(h,this.projection,this.cooFrame,this.width,this.height,this.largestDim,this.zoomFactor,this.fov)}this.mode==f.SELECT&&(mustRedrawReticle=!0);var c,u,d,r=this.reticleCtx;!this.mustRedrawReticle&&this.mode!=f.SELECT||r.clearRect(0,0,this.width,this.height),this.displayReticle&&(this.reticleCache||(o=document.createElement("canvas"),c=this.options.reticleSize,o.width=c,o.height=c,(e=o.getContext("2d")).lineWidth=2,e.strokeStyle=this.options.reticleColor,e.beginPath(),e.moveTo(c/2,c/2+(c/2-1)),e.lineTo(c/2,c/2+2),e.moveTo(c/2,c/2-(c/2-1)),e.lineTo(c/2,c/2-2),e.moveTo(c/2+(c/2-1),c/2),e.lineTo(c/2+2,c/2),e.moveTo(c/2-(c/2-1),c/2),e.lineTo(c/2-2,c/2),e.stroke(),this.reticleCache=o),r.drawImage(this.reticleCache,this.width/2-this.reticleCache.width/2,this.height/2-this.reticleCache.height/2),this.mustRedrawReticle=!1),this.projectionMethod==ProjectionEnum.SIN&&60<=this.fov&&!0===this.aladin.options.showAllskyRing&&(i.strokeStyle=this.aladin.options.allskyRingColor,d=this.aladin.options.allskyRingWidth,i.lineWidth=d,i.beginPath(),u=this.cx>this.cy?this.cx:this.cy,i.arc(this.cx,this.cy,(u-d/2+1)*this.zoomFactor,0,2*Math.PI,!0),i.stroke()),this.mode==f.SELECT&&this.dragging&&(r.fillStyle="rgba(100, 240, 110, 0.25)",u=this.dragx-this.selectStartCoo.x,d=this.dragy-this.selectStartCoo.y,r.fillRect(this.selectStartCoo.x,this.selectStartCoo.y,u,d)),t==this.needRedraw&&(this.needRedraw=!1),this.dragging||this.updateObjectsLookup(),this.executeCallbacksThrottled()},f.prototype.clearBlendCanvas=function(){var t=this.blendCtx;return t.clearRect(0,0,this.imageCanvas.width,this.imageCanvas.height),t.fillStyle="#000",t.fillRect(0,0,this.imageCanvas.width,this.imageCanvas.height),t},f.prototype.forceRedraw=function(){this.flagForceRedraw=!0},f.prototype.refreshProgressiveCats=function(){if(this.catalogs)for(var t=0;t<this.catalogs.length;t++)"progressivecat"==this.catalogs[t].type&&this.catalogs[t].loadNeededTiles()},f.prototype.getVisiblePixList=function(t,e){var i=Math.pow(2,t),r=HealpixIndex.nside2Npix(i);if(80<this.fov)for(var o=[],s=0;s<r;s++)o.push(s);else{var n=new HealpixIndex(i),a=new SpatialVector,t=AladinUtils.viewToXy(this.cx,this.cy,this.width,this.height,this.largestDim,this.zoomFactor),i=this.projection.unproject(t.x,t.y),t=[];e&&e.system!=this.cooFrame.system?e.system==CooFrameEnum.SYSTEMS.J2000?t=CooConversion.GalacticToJ2000([i.ra,i.dec]):e.system==CooFrameEnum.SYSTEMS.GAL&&(t=CooConversion.J2000ToGalactic([i.ra,i.dec])):t=[i.ra,i.dec],this.imageSurveys[0]&&this.imageSurveys[0].longitudeReversed,a.set(t[0],t[1]);i=.5*this.fov*this.ratio;60<this.fov?i*=1.6:12<this.fov?i*=1.45:i*=1.1,o=n.queryDisc(a,i*Math.PI/180,function(t){return t});t=Utils.radecToPolar(t[0],t[1]);ipixCenter=n.ang2pix_nest(t.theta,t.phi),o.unshift(ipixCenter)}return o},f.prototype.getVisibleCells=function(t,e){!e&&0<this.imageSurveys.length&&(e=this.imageSurveys[0].cooFrame);var i=[],r=[],o=new SpatialVector,s=Math.pow(2,t),n=HealpixIndex.nside2Npix(s),a=null;if(80<this.fov)for(var l=[],h=0;h<n;h++)l.push(h);else{var c=new HealpixIndex(s),u=new SpatialVector,d=AladinUtils.viewToXy(this.cx,this.cy,this.width,this.height,this.largestDim,this.zoomFactor),p=this.projection.unproject(d.x,d.y),t=[];e&&e.system!=this.cooFrame.system?e.system==CooFrameEnum.SYSTEMS.J2000?t=CooConversion.GalacticToJ2000([p.ra,p.dec]):e.system==CooFrameEnum.SYSTEMS.GAL&&(t=CooConversion.J2000ToGalactic([p.ra,p.dec])):t=[p.ra,p.dec],0<this.imageSurveys.length&&this.imageSurveys[0].longitudeReversed,u.set(t[0],t[1]);d=.5*this.fov*this.ratio;60<this.fov?d*=1.6:12<this.fov?d*=1.45:d*=1.1,l=c.queryDisc(u,d*Math.PI/180,function(t){return t});t=Utils.radecToPolar(t[0],t[1]),a=c.ang2pix_nest(t.theta,t.phi);l.unshift(a)}for(var f=0,g=l.length;f<g;f++)if(!((h=l[f])==a&&0<f)){var v=[];corners=HealpixCache.corners_nest(h,s);for(var m,y,S=0;S<4;S++)o.setXYZ(corners[S].x,corners[S].y,corners[S].z),e&&e.system!=this.cooFrame.system?e.system==CooFrameEnum.SYSTEMS.J2000?(m=(p=CooConversion.J2000ToGalactic([o.ra(),o.dec()]))[0],y=p[1]):e.system==CooFrameEnum.SYSTEMS.GAL&&(m=(p=CooConversion.GalacticToJ2000([o.ra(),o.dec()]))[0],y=p[1]):(m=o.ra(),y=o.dec()),r[S]=this.projection.project(m,y);if(null!=r[0]&&null!=r[1]&&null!=r[2]&&null!=r[3]){for(S=0;S<4;S++)v[S]=AladinUtils.xyToView(r[S].X,r[S].Y,this.width,this.height,this.largestDim,this.zoomFactor);if(!(v[0].vx<0&&v[1].vx<0&&v[2].vx<0&&v[3].vx<0||v[0].vy<0&&v[1].vy<0&&v[2].vy<0&&v[3].vy<0||v[0].vx>=this.width&&v[1].vx>=this.width&&v[2].vx>=this.width&&v[3].vx>=this.width||v[0].vy>=this.height&&v[1].vy>=this.height&&v[2].vy>=this.height&&v[3].vy>=this.height)){if(this.projection.PROJECTION==ProjectionEnum.AITOFF){var w=v[0].vx-v[2].vx,C=v[0].vy-v[2].vy;if(Math.sqrt(w*w+C*C)>this.largestDim/5)continue;if(w=v[1].vx-v[3].vx,C=v[1].vy-v[3].vy,Math.sqrt(w*w+C*C)>this.largestDim/5)continue}v.ipix=h,i.push(v)}}}return i},f.prototype.getPositionsInView=function(t,e){for(var i,r,o,s=[],n=new SpatialVector,e=Math.pow(2,e),a=[],l=HealpixCache.corners_nest(t,e),h=0;h<4;h++)n.setXYZ(l[h].x,l[h].y,l[h].z),0<this.imageSurveys.length&&this.imageSurveys[0].cooFrame.system!=this.cooFrame.system?this.imageSurveys[0].cooFrame.system==CooFrameEnum.SYSTEMS.J2000?(i=(o=CooConversion.J2000ToGalactic([n.ra(),n.dec()]))[0],r=o[1]):this.imageSurveys[0].cooFrame.system==CooFrameEnum.SYSTEMS.GAL&&(i=(o=CooConversion.GalacticToJ2000([n.ra(),n.dec()]))[0],r=o[1]):(i=n.ra(),r=n.dec()),s[h]=this.projection.project(i,r);if(null==s[0]||null==s[1]||null==s[2]||null==s[3])return null;for(h=0;h<4;h++)a[h]=AladinUtils.xyToView(s[h].X,s[h].Y,this.width,this.height,this.largestDim,this.zoomFactor);return a},f.prototype.computeZoomFactor=function(t){return 0<t?AladinUtils.getZoomFactorForAngle(180/Math.pow(1.15,t),this.projectionMethod):1+.1*t},f.prototype.setZoom=function(t){t<0||180<t&&!this.aladin.options.allowFullZoomout||(t=Math.log(180/t)/Math.log(1.15),this.setZoomLevel(t))},f.prototype.setShowGrid=function(t){this.showGrid=t,this.requestRedraw()},f.prototype.setZoomLevel=function(t){if(this.minFOV||this.maxFOV){var e=doComputeFov(this,this.computeZoomFactor(Math.max(-2,t)));if(this.maxFOV&&e>this.maxFOV||this.minFOV&&e<this.minFOV)return}this.projectionMethod==ProjectionEnum.SIN?!0===this.aladin.options.allowFullZoomout?2<this.width/this.height?this.zoomLevel=Math.max(-7,t):this.width/this.height<.5?this.zoomLevel=Math.max(-2,t):this.zoomLevel=Math.max(-6,t):this.zoomLevel=Math.max(-2,t):this.zoomLevel=Math.max(-7,t),this.zoomFactor=this.computeZoomFactor(this.zoomLevel);var i;this.fov;this.fov=computeFov(this),updateFovDiv(this),this.computeNorder(),this.forceRedraw(),this.requestRedraw(),this.debounceProgCatOnZoom||((i=this).debounceProgCatOnZoom=Utils.debounce(function(){i.refreshProgressiveCats()},300)),this.debounceProgCatOnZoom()},f.prototype.computeNorder=function(){var t=this.fov/this.largestDim,e=HealpixIndex.calculateNSide(1843200*t),t=Math.log(e)/Math.log(2),t=Math.max(t,1);this.realNorder=t,this.fov<=50&&t<=2&&(t=3);e=t=0<this.imageSurveys&&t<=2&&2<this.imageSurveys[0].minOrder?this.imageSurveys[0].minOrder:t;0<this.imageSurveys.length&&t>this.imageSurveys[0].maxOrder&&(t=this.imageSurveys[0].maxOrder),this.overlayImageSurvey&&e>this.overlayImageSurvey.maxOrder&&(e=this.overlayImageSurvey.maxOrder),t>HealpixIndex.ORDER_MAX&&(t=HealpixIndex.ORDER_MAX),e>HealpixIndex.ORDER_MAX&&(e=HealpixIndex.ORDER_MAX),this.curNorder=t,this.curOverlayNorder=e},f.prototype.untaintCanvases=function(){this.createCanvases(),createListeners(this),this.fixLayoutDimensions()},f.prototype.setOverlayImageSurvey=function(t,e,i){if(!t)return this.overlayImageSurvey=null,void this.requestRedraw();$.support.cors&&this.overlayImageSurvey&&!this.overlayImageSurvey.useCors&&this.untaintCanvases();var e=e||BlendingModeEnum.sourceover,r="string"==typeof t?(r=HpxImageSurvey.getSurveyFromId(t,e))||HpxImageSurvey.getSurveyFromId(HpxImageSurvey.DEFAULT_SURVEY_ID,e):t;r.isReady=!1,this.overlayImageSurvey=r;var o=this;r.init(this,function(){o.computeNorder(),r.isReady=!0,o.requestRedraw(),o.updateObjectsLookup(),i&&i()})},f.prototype.setUnknownSurveyIfNeeded=function(){h&&(this.setImageSurvey(h),h=void 0)};var h=void 0;return f.prototype.setImageSurvey=function(t,e,i,r){if(t){$.support.cors&&this.imageSurveys[this.lastSurveyIdx]&&!this.imageSurveys[this.lastSurveyIdx].useCors&&this.untaintCanvases(),this.displaySurvey.push(!0);var o,e=e||BlendingModeEnum.sourceover,i=i||"#000";"string"==typeof t?(o=HpxImageSurvey.getSurveyFromId(t,e,i))||(o=HpxImageSurvey.getSurveyFromId(HpxImageSurvey.DEFAULT_SURVEY_ID,e,i),h=t):o=t;var s=this.downloader.emptyQueue();for(buffer of this.tileBuffers)buffer.removeTiles(s);o.isReady=!1;this.imageSurveys.length;this.projection.reverseLongitude(o.longitudeReversed);var n=this;o.init(this,function(){n.imageSurveys.push(o),n.computeNorder(),o.isReady=!0,n.requestRedraw(),n.updateObjectsLookup(),r&&r()})}},f.prototype.setImageSurveyAtIndex=function(t,e,i,r,o,s){if(t){var n;$.support.cors&&this.imageSurveys[this.lastSurveyIdx]&&!this.imageSurveys[this.lastSurveyIdx].useCors&&this.untaintCanvases(),this.displaySurvey[e]=!0,"string"==typeof t?(n=HpxImageSurvey.getSurveyFromId(t,i,r,o))||(n=HpxImageSurvey.getSurveyFromId(HpxImageSurvey.DEFAULT_SURVEY_ID,i,r,o),h=t):n=t;var a=this.downloader.emptyQueue();for(buffer of this.tileBuffers)buffer.removeTiles(a);n.isReady=!1,this.imageSurveys[e]=n,this.projection.reverseLongitude(this.imageSurveys[e].longitudeReversed),this.lastSurveyIdx=e;var l=this;n.init(this,function(){l.computeNorder(),n.isReady=!0,l.requestRedraw(),l.updateObjectsLookup(),s&&s()})}},f.prototype.requestRedraw=function(){this.needRedraw=!0},f.prototype.changeProjection=function(t){this.projectionMethod=t,this.requestRedraw()},f.prototype.changeFrame=function(t){var e=this.cooFrame;this.cooFrame=t,this.cooFrame.system==CooFrameEnum.SYSTEMS.GAL&&this.cooFrame.system!=e.system?(t=CooConversion.J2000ToGalactic([this.viewCenter.lon,this.viewCenter.lat]),this.viewCenter.lon=t[0],this.viewCenter.lat=t[1]):this.cooFrame.system==CooFrameEnum.SYSTEMS.J2000&&this.cooFrame.system!=e.system&&(e=CooConversion.GalacticToJ2000([this.viewCenter.lon,this.viewCenter.lat]),this.viewCenter.lon=e[0],this.viewCenter.lat=e[1]),this.location.update(this.viewCenter.lon,this.viewCenter.lat,this.cooFrame,!0),this.requestRedraw()},f.prototype.showHealpixGrid=function(t){this.displayHpxGrid=t,this.requestRedraw()},f.prototype.showSurveyAtIndex=function(t,e){this.displaySurvey[e]=t,this.requestRedraw()},f.prototype.toggleShowSurveyAtIndex=function(t){t=!this.displaySurvey[t];this.displaySurvey[i]=t,this.requestRedraw()},f.prototype.showCatalog=function(t){this.displayCatalog=t,this.displayCatalog||(this.mustClearCatalog=!0),this.requestRedraw()},f.prototype.showReticle=function(t){this.displayReticle=t,this.mustRedrawReticle=!0,this.requestRedraw()},f.prototype.pointTo=function(t,e){var i;t=parseFloat(t),e=parseFloat(e),isNaN(t)||isNaN(e)||(this.cooFrame.system==CooFrameEnum.SYSTEMS.J2000?(this.viewCenter.lon=t,this.viewCenter.lat=e):this.cooFrame.system==CooFrameEnum.SYSTEMS.GAL&&(e=CooConversion.J2000ToGalactic([t,e]),this.viewCenter.lon=e[0],this.viewCenter.lat=e[1]),this.location.update(this.viewCenter.lon,this.viewCenter.lat,this.cooFrame,!0),this.forceRedraw(),this.requestRedraw(),i=this,setTimeout(function(){i.refreshProgressiveCats()},1e3))},f.prototype.makeUniqLayerName=function(t){if(!this.layerNameExists(t))return t;for(var e=1;;++e){var i=t+"_"+e;if(!this.layerNameExists(i))return i}},f.prototype.layerNameExists=function(t){for(var e=this.allOverlayLayers,i=0;i<e.length;i++)if(t==e[i].name)return!0;return!1},f.prototype.removeLayers=function(){this.catalogs=[],this.overlays=[],this.mocs=[],this.allOverlayLayers=[],this.requestRedraw()},f.prototype.removeImageSurveyAtIndex=function(t){this.imageSurveys.splice(i,1),this.requestRedraw()},f.prototype.setSurveyParametersAtIndex=function(t,e,i,r){this.imageSurveys[t].blendMode=e,this.imageSurveys[t].alpha=i,this.imageSurveys[t].colorCorrection=r,this.requestRedraw()},f.prototype.setRefreshed=function(){this.aladin.stateMachine.refreshed+=1},f.prototype.addCatalog=function(t){t.name=this.makeUniqLayerName(t.name),this.allOverlayLayers.push(t),this.catalogs.push(t),"catalog"==t.type?t.setView(this):"progressivecat"==t.type&&t.init(this)},f.prototype.addOverlay=function(t){t.name=this.makeUniqLayerName(t.name),this.overlays.push(t),this.allOverlayLayers.push(t),t.setView(this)},f.prototype.addMOC=function(t){t.name=this.makeUniqLayerName(t.name),this.mocs.push(t),this.allOverlayLayers.push(t),t.setView(this)},f.prototype.getObjectsInBBox=function(t,e,i,r){i<0&&(t+=i,i=-i),r<0&&(e+=r,r=-r);var o,s,n=[];if(this.catalogs)for(var a=0;a<this.catalogs.length;a++)if((o=this.catalogs[a]).isShowing)for(var l=o.getSources(),h=0;h<l.length;h++)(s=l[h]).isShowing&&s.x&&s.y&&s.x>=t&&s.x<=t+i&&s.y>=e&&s.y<=e+r&&n.push(s);return n},f.prototype.updateObjectsLookup=function(){var t,e,i,r;if(this.objLookup=[],this.catalogs)for(var o=0;o<this.catalogs.length;o++)if((t=this.catalogs[o]).isShowing)for(var s=t.getSources(),n=0;n<s.length;n++)(e=s[n]).isShowing&&e.x&&e.y&&(i=e.x,r=e.y,void 0===this.objLookup[i]&&(this.objLookup[i]=[]),void 0===this.objLookup[i][r]&&(this.objLookup[i][r]=[]),this.objLookup[i][r].push(e))},f.prototype.closestObjects=function(t,e,i){var r,o=this.catalogCanvas.getContext("2d");if(o.lineWidth=6,this.overlays)for(var s=0;s<this.overlays.length;s++){for(var n=this.overlays[s],a=0;a<n.overlays.length;a++){for(var l=n.overlays[a],h=[],c=0;c<l.polygons.length;c++){var u=AladinUtils.radecToViewXy(l.polygons[c][0],l.polygons[c][1],this.projection,this.cooFrame,this.width,this.height,this.largestDim,this.zoomFactor);u&&h.push({x:u.vx,y:u.vy})}for(var d=0;d<h.length-1;d++)if(o.beginPath(),o.moveTo(h[d].x,h[d].y),o.lineTo(h[d+1].x,h[d+1].y),o.isPointInStroke(t,e))return[f=l]}for(a=0;a<n.overlay_items.length;a++)if(n.overlay_items[a]instanceof Circle&&(n.overlay_items[a].draw(o,this.projection,this.cooFrame,this.width,this.height,this.largestDim,this.zoomFactor,!0),o.isPointInStroke(t,e)))return[f=n.overlay_items[a]]}if(!this.objLookup)return null;for(var p=0;p<=i;p++){for(var f=r=null,g=-i;g<=i;g++)if(this.objLookup[t+g])for(var v,m=-i;m<=i;m++)this.objLookup[t+g][e+m]&&(v=g*g+m*m,f?v<r&&(r=v,f=this.objLookup[t+g][e+m]):(f=this.objLookup[t+g][e+m],r=v));if(f)return f}return null},f}(),Aladin=function(){function v(t,e){if(0!=$(t).length){var r=this;"zoom"in(e=(e=void 0===e?this.getOptionsFromQueryString():e)||{})&&(a=e.zoom,delete e.zoom,e.fov=a);var i,o={};for(i in v.DEFAULT_OPTIONS)void 0!==e[i]?o[i]=e[i]:o[i]=v.DEFAULT_OPTIONS[i];for(i in e)void 0===v.DEFAULT_OPTIONS[i]&&(o[i]=e[i]);this.options=o,$("<style type='text/css'> .aladin-reticleColor { color: "+this.options.reticleColor+"; font-weight:bold;} </style>").appendTo(t),this.aladinDiv=t,this.reduceDeformations=!0,$(t).addClass("aladin-container");var s=CooFrameEnum.fromString(o.cooFrame,CooFrameEnum.J2000),n=$('<div class="aladin-location">'+(o.showFrame?'<select class="aladin-frameChoice"><option value="'+CooFrameEnum.J2000.label+'" '+(s==CooFrameEnum.J2000?'selected="selected"':"")+'>J2000</option><option value="'+CooFrameEnum.J2000d.label+'" '+(s==CooFrameEnum.J2000d?'selected="selected"':"")+'>J2000d</option><option value="'+CooFrameEnum.GAL.label+'" '+(s==CooFrameEnum.GAL?'selected="selected"':"")+">GAL</option></select>":"")+'<span class="aladin-location-text"></span></div>').appendTo(t),a=$('<div class="aladin-fov"></div>').appendTo(t);o.showZoomControl&&$('<div class="aladin-zoomControl"><a href="#" class="zoomPlus" title="Zoom in">+</a><a href="#" class="zoomMinus" title="Zoom out">&ndash;</a></div>').appendTo(t),o.showFullscreenControl&&$('<div class="aladin-fullscreenControl aladin-maximize" title="Full screen"></div>').appendTo(t),this.fullScreenBtn=$(t).find(".aladin-fullscreenControl"),this.fullScreenBtn.click(function(){r.toggleFullscreen(r.options.realFullscreen)}),$(document).on("fullscreenchange webkitfullscreenchange mozfullscreenchange MSFullscreenChange",function(t){var e,i=document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement;null==i&&(r.fullScreenBtn.removeClass("aladin-restore"),r.fullScreenBtn.addClass("aladin-maximize"),r.fullScreenBtn.attr("title","Full screen"),$(r.aladinDiv).removeClass("aladin-fullscreen"),e=r.callbacksByEventName.fullScreenToggled,i=r.fullScreenBtn.hasClass("aladin-restore"),"function"==typeof e&&e(i))}),this.boxes=[],this.measurementTable=new MeasurementTable(t);var l,h,c,u,n=new Location(n.find(".aladin-location-text"));if(this.view=new View(this,n,a,s,o.fov),this.view.setShowGrid(o.showCooGrid),this.states={refreshed:0},this.stateMachine=new Proxy(this.states,{set(t,e,i){i==this.view.imageSurveys.length&&console.log("all tiles refreshed")}}),$.ajax({url:"//aladin.unistra.fr/java/nph-aladin.pl",data:{frame:"aladinLiteDic"},method:"GET",dataType:"jsonp",success:function(t){for(var e={},i=0;i<t.length;i++)e[t[i].id]=!0;for(i=0;i<HpxImageSurvey.SURVEYS.length;i++)e[HpxImageSurvey.SURVEYS[i].id]||t.push(HpxImageSurvey.SURVEYS[i]);HpxImageSurvey.SURVEYS=t,r.view.setUnknownSurveyIfNeeded()},error:function(){}}),o.showLayersControl&&((c=$('<div class="aladin-layersControl-container" title="Manage layers"><div class="aladin-layersControl"></div></div>')).appendTo(t),(s=$('<div class="aladin-box aladin-layerBox aladin-cb-list"></div>')).appendTo(t),this.boxes.push(s),c.click(function(){return r.hideBoxes(),r.showLayerBox(),!1})),o.showGotoControl&&((c=$('<div class="aladin-gotoControl-container" title="Go to position"><div class="aladin-gotoControl"></div></div>')).appendTo(t),(l=$('<div class="aladin-box aladin-gotoBox"><a class="aladin-closeBtn">&times;</a><div style="clear: both;"></div><form class="aladin-target-form">Go to: <input type="text" placeholder="Object name/position" /></form></div>')).appendTo(t),this.boxes.push(l),(h=l.find(".aladin-target-form input")).on("paste keydown",function(){$(this).removeClass("aladin-unknownObject")}),c.click(function(){return r.hideBoxes(),h.val(""),h.removeClass("aladin-unknownObject"),l.show(),h.focus(),!1}),l.find(".aladin-closeBtn").click(function(){return r.hideBoxes(),!1})),o.showSimbadPointerControl&&((c=$('<div class="aladin-simbadPointerControl-container" title="SIMBAD pointer"><div class="aladin-simbadPointerControl"></div></div>')).appendTo(t),c.click(function(){r.view.setMode(View.TOOL_SIMBAD_POINTER)})),o.showShareControl&&((c=$('<div class="aladin-shareControl-container" title="Get link for current view"><div class="aladin-shareControl"></div></div>')).appendTo(t),(u=$('<div class="aladin-box aladin-shareBox"><a class="aladin-closeBtn">&times;</a><div style="clear: both;"></div>Link to previewer: <span class="info"></span><input type="text" class="aladin-shareInput" /></div>')).appendTo(t),this.boxes.push(u),c.click(function(){r.hideBoxes(),u.show();var t=r.getShareURL();return u.find(".aladin-shareInput").val(t).select(),document.execCommand("copy"),!1}),u.find(".aladin-closeBtn").click(function(){return r.hideBoxes(),!1})),this.gotoObject(o.target),o.log&&((g=e).version=v.VERSION,Logger.log("startup",g)),this.showReticle(o.showReticle),o.catalogUrls)for(var d=0,p=o.catalogUrls.length;d<p;d++)this.createCatalogFromVOTable(o.catalogUrls[d]);this.setImageSurvey(o.survey,0,BlendingModeEnum.sourceover,"#000",1),this.view.showCatalog(o.showCatalog);var f=this;$(t).find(".aladin-frameChoice").change(function(){f.setFrame($(this).val())}),$("#projectionChoice").change(function(){f.setProjection($(this).val())}),$(t).find(".aladin-target-form").submit(function(){return f.gotoObject($(this).find("input").val(),function(){$(t).find(".aladin-target-form input").addClass("aladin-unknownObject")}),!1});var g=$(t).find(".zoomPlus");g.click(function(){return f.increaseZoom(),!1}),g.bind("mousedown",function(t){t.preventDefault()});g=$(t).find(".zoomMinus");g.click(function(){return f.decreaseZoom(),!1}),g.bind("mousedown",function(t){t.preventDefault()}),o.fullScreen&&window.setTimeout(function(){r.toggleFullscreen(r.options.realFullscreen)},1e3),this.callbacksByEventName={}}else console.log("Could not find div "+t+". Aborting creation of Aladin Lite instance")}v.VERSION="2022-01-03-10:47:21",v.JSONP_PROXY="https://alasky.unistra.fr/cgi/JSONProxy",v.DEFAULT_OPTIONS={target:"0 +0",cooFrame:"J2000",survey:"P/DSS2/color",fov:60,showReticle:!0,showZoomControl:!0,showFullscreenControl:!0,showLayersControl:!0,showGotoControl:!0,showSimbadPointerControl:!1,showShareControl:!1,showCatalog:!0,showFrame:!0,showCooGrid:!1,fullScreen:!1,reticleColor:"rgb(178, 50, 178)",reticleSize:22,log:!0,allowFullZoomout:!1,realFullscreen:!1,showAllskyRing:!1,allskyRingColor:"#c8c8ff",allskyRingWidth:8,pixelateCanvas:!0},v.prototype.toggleFullscreen=function(t){t=Boolean(t),this.fullScreenBtn.toggleClass("aladin-maximize aladin-restore");var e=this.fullScreenBtn.hasClass("aladin-restore");this.fullScreenBtn.attr("title",e?"Restore original size":"Full screen"),$(this.aladinDiv).toggleClass("aladin-fullscreen"),t&&(e?(i=this.aladinDiv).requestFullscreen?i.requestFullscreen():i.webkitRequestFullscreen?i.webkitRequestFullscreen():i.mozRequestFullScreen?i.mozRequestFullScreen():i.msRequestFullscreen&&i.msRequestFullscreen():document.exitFullscreen?document.exitFullscreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen&&document.webkitExitFullscreen()),this.view.fixLayoutDimensions();var i=this.callbacksByEventName.zoomChanged;"function"==typeof i&&i(this.view.fov);i=this.callbacksByEventName.fullScreenToggled;"function"==typeof i&&i(e)},v.prototype.updateSurveysDropdownList=function(t){t=t.sort(function(t,e){return t.order?t.order&&t.order>e.order?1:-1:t.id>e.id});var e=$(this.aladinDiv).find(".aladin-surveySelection");if(e.empty(),0<this.view.imageSurveys.length)for(var i=0;i<t.length;i++){var r=this.view.imageSurveys[this.view.imageSurveys.length-1].id==t[i].id;e.append($("<option />").attr("selected",r).val(t[i].id).text(t[i].name))}},v.prototype.getOptionsFromQueryString=function(){var t={},e=$.urlParam("target");e&&(t.target=e);e=$.urlParam("frame");e&&CooFrameEnum[e]&&(t.frame=e);e=$.urlParam("survey");e&&HpxImageSurvey.getSurveyInfoFromId(e)&&(t.survey=e);e=$.urlParam("zoom");e&&0<e&&e<180&&(t.zoom=e);e=$.urlParam("showReticle");e&&(t.showReticle="true"==e.toLowerCase());e=$.urlParam("cooFrame");e&&(t.cooFrame=e);e=$.urlParam("fullScreen");return void 0!==e&&(t.fullScreen=e),t},v.prototype.setZoom=function(t){this.view.setZoom(t)},v.prototype.setFoV=v.prototype.setFov=function(t){this.view.setZoom(t)},v.prototype.adjustFovForObject=function(t){var e=this;this.getFovForObject(t,function(t){e.setFoV(t)})},v.prototype.getFovForObject=function(t,r){t="//simbad.u-strasbg.fr/simbad/sim-tap/sync?query="+encodeURIComponent("SELECT galdim_majaxis, V FROM basic JOIN ident ON oid=ident.oidref JOIN allfluxes ON oid=allfluxes.oidref WHERE id='"+t+"'")+"&request=doQuery&lang=adql&format=json&phase=run";Utils.getAjaxObject(t,"GET","json",!1).done(function(t){var e,i=4/60;"data"in t&&0<t.data.length&&(e=Utils.isNumber(t.data[0][0])?t.data[0][0]/60:null,t=Utils.isNumber(t.data[0][1])?t.data[0][1]:null,null!==e?i=2*e:null!==t&&t<10&&(i=2*Math.pow(2,6-t/2)/60)),"function"==typeof r&&r(i)})},v.prototype.setFrame=function(t){!t||(t=CooFrameEnum.fromString(t,CooFrameEnum.J2000))!=this.view.cooFrame&&(this.view.changeFrame(t),$(this.aladinDiv).find(".aladin-frameChoice").val(t.label))},v.prototype.setProjection=function(t){t&&("aitoff"===(t=t.toLowerCase())?this.view.changeProjection(ProjectionEnum.AITOFF):this.view.changeProjection(ProjectionEnum.SIN))},v.prototype.gotoObject=function(e,t){var i,r=errorCallback=void 0;"object"==typeof t?(t.hasOwnProperty("success")&&(r=t.success),t.hasOwnProperty("error")&&(errorCallback=t.error)):"function"==typeof t&&(errorCallback=t),/[a-zA-Z]/.test(e)?(i=this,Sesame.resolve(e,function(t){var e=t.Target.Resolver.jradeg,t=t.Target.Resolver.jdedeg;i.view.pointTo(e,t),"function"==typeof r&&r(i.getRaDec())},function(t){console&&(console.log("Could not resolve object name "+e),console.log(t)),"function"==typeof errorCallback&&errorCallback()})):((t=new Coo).parse(e),t=[t.lon,t.lat],this.view.cooFrame==CooFrameEnum.GAL&&(t=CooConversion.GalacticToJ2000(t)),this.view.pointTo(t[0],t[1]),"function"==typeof r&&r(this.getRaDec()))},v.prototype.gotoPosition=function(t,e){e=this.view.cooFrame==CooFrameEnum.GAL?CooConversion.GalacticToJ2000([t,e]):[t,e];this.view.pointTo(e[0],e[1])};function c(t){var e;if(null!=(e=t.animationParams)&&e.running){var i=(new Date).getTime();if(i>e.end)return t.gotoRaDec(e.raEnd,e.decEnd),e.complete&&e.complete(),0;var r,o,s,n=(i-e.start)/(e.end-e.start),a=(r=e.raStart,o=e.decStart,a=e.raEnd,s=e.decEnd,i=n,o=l(o),r=l(r),s=l(s),a=l(a),e=2*Math.asin(Math.sqrt(Math.pow(Math.sin((o-s)/2),2)+Math.cos(o)*Math.cos(s)*Math.pow(Math.sin((r-a)/2),2))),n=Math.sin((1-i)*e)/Math.sin(e),i=Math.sin(i*e)/Math.sin(e),e=n*Math.cos(o)*Math.cos(r)+i*Math.cos(s)*Math.cos(a),a=n*Math.cos(o)*Math.sin(r)+i*Math.cos(s)*Math.sin(a),i=n*Math.sin(o)+i*Math.sin(s),s=Math.atan2(a,e),a=Math.atan2(i,Math.sqrt(Math.pow(e,2)+Math.pow(a,2))),[h(s),h(a)]);curRa=a[0],curDec=a[1],t.gotoRaDec(curRa,curDec),setTimeout(function(){c(t)},50)}function l(t){return t*Math.PI/180}function h(t){return 180*t/Math.PI}}v.prototype.stopAnimation=function(){this.zoomAnimationParams&&(this.zoomAnimationParams.running=!1),this.animationParams&&(this.animationParams.running=!1)},v.prototype.animateToRaDec=function(t,e,i,r){i=i||5,this.animationParams=null;var o={};o.start=(new Date).getTime(),o.end=(new Date).getTime()+1e3*i;i=this.getRaDec();o.raStart=i[0],o.decStart=i[1],o.raEnd=t,o.decEnd=e,o.complete=r,o.running=!0,this.animationParams=o,c(this)};function o(t){var e=t.zoomAnimationParams;if(null!=e&&e.running){var i=(new Date).getTime();if(i>e.end)return t.setFoV(e.fovEnd),e.complete&&e.complete(),0;i=(i-e.start)/(e.end-e.start),i=e.fovStart+(e.fovEnd-e.fovStart)*Math.sqrt(i);t.setFoV(i),setTimeout(function(){o(t)},50)}}return v.prototype.zoomToFoV=function(t,e,i){e=e||5,this.zoomAnimationParams=null;var r={};r.start=(new Date).getTime(),r.end=(new Date).getTime()+1e3*e;e=this.getFov();r.fovStart=Math.max(e[0],e[1]),r.fovEnd=t,r.complete=i,r.running=!0,this.zoomAnimationParams=r,o(this)},v.prototype.getRaDec=function(){return this.view.cooFrame.system==CooFrameEnum.SYSTEMS.J2000?[this.view.viewCenter.lon,this.view.viewCenter.lat]:CooConversion.GalacticToJ2000([this.view.viewCenter.lon,this.view.viewCenter.lat])},v.prototype.gotoRaDec=function(t,e){this.view.pointTo(t,e)},v.prototype.showHealpixGrid=function(t){this.view.showHealpixGrid(t)},v.prototype.showSurvey=function(t,e){this.view.showSurveyAtIndex(t,e)},v.prototype.toggleShowSurveyAtIndex=function(t){this.view.toggleShowSurveyAtIndex(t)},v.prototype.showCatalog=function(t){this.view.showCatalog(t)},v.prototype.showReticle=function(t){this.view.showReticle(t),$("#displayReticle").attr("checked",t)},v.prototype.removeLayers=function(){this.view.removeLayers()},v.prototype.removeImageSurveyAtIndex=function(t){this.view.removeImageSurveyAtIndex(t)},v.prototype.setSurveyParametersAtIndex=function(t,e,i,r){this.view.setSurveyParametersAtIndex(t,e,i,r)},v.prototype.addCatalog=function(t){this.view.addCatalog(t)},v.prototype.addOverlay=function(t){this.view.addOverlay(t)},v.prototype.addMOC=function(t){this.view.addMOC(t)},v.prototype.createImageSurvey=function(t,e,i,r,o,s){return new HpxImageSurvey(t,e,i,r,o,s)},v.prototype.getBaseImageLayer=function(){return this.view.imageSurveys[0]},v.prototype.getImageLayerAtIndex=function(t){if(t<=this.view.imageSurveys.length-1)return this.view.imageSurveys[t]},v.prototype.setImageSurvey=function(t,e,i,r,o,s){console.log("setting survey at "+e+" blend mode "+i+" hue "+r+" alpha "+o),this.view.setImageSurveyAtIndex(t,e,i,r,o,s),this.updateSurveysDropdownList(HpxImageSurvey.getAvailableSurveys()),this.options.log&&("string"!=typeof(s=t)&&(s=t.rootUrl),Logger.log("changeImageSurvey",s))},v.prototype.setBaseImageLayer=v.prototype.setImageSurvey,v.prototype.addImageLayer=v.prototype.setImageSurvey,v.prototype.getOverlayImageLayer=function(){return this.view.overlayImageSurvey},v.prototype.setOverlayImageLayer=function(t,e){this.view.setOverlayImageSurvey(t,e)},v.prototype.increaseZoom=function(t){this.view.setZoomLevel(this.view.zoomLevel+(t=t||5))},v.prototype.decreaseZoom=function(t){this.view.setZoomLevel(this.view.zoomLevel-(t=t||5))},v.prototype.createCatalog=function(t){return A.catalog(t)},v.prototype.createProgressiveCatalog=function(t,e,i,r){return new ProgressiveCat(t,e,i,r)},v.prototype.createSource=function(t,e,i){return new cds.Source(t,e,i)},v.prototype.createMarker=function(t,e,i,r){return(i=i||{}).marker=!0,new cds.Source(t,e,r,i)},v.prototype.createOverlay=function(t){return new Overlay(t)},v.prototype.createFootprintsFromSTCS=function(t){return A.footprintsFromSTCS(t)},A.footprintsFromSTCS=function(t){return Overlay.parseSTCS(t)},A.MOCFromURL=function(t,e,i){e=new MOC(e);return e.dataFromFITSURL(t,i),e},A.MOCFromJSON=function(t,e){e=new MOC(e);return e.dataFromJSON(t),e},v.prototype.createCatalogFromVOTable=function(t,e){return A.catalogFromURL(t,e)},A.catalogFromURL=function(t,e,i,r){var o=A.catalog(e);return cds.Catalog.parseVOTable(t,function(t){o.addSources(t),i&&i(t)},o.maxNbSources,r,o.raField,o.decField),o},A.catalogFromSimbad=function(t,e,i,r){"name"in(i=i||{})||(i.name="Simbad");e=URLBuilder.buildSimbadCSURL(t,e);return A.catalogFromURL(e,i,r,!1)},A.catalogFromNED=function(t,e,i,r){var o,s;return"name"in(i=i||{})||(i.name="NED"),t&&"object"==typeof t?"ra"in t&&"dec"in t&&(s=URLBuilder.buildNEDPositionCSURL(t.ra,t.dec,e)):s=/[a-zA-Z]/.test(t)?URLBuilder.buildNEDObjectCSURL(t,e):((o=new Coo).parse(t),URLBuilder.buildNEDPositionCSURL(o.lon,o.lat,e)),A.catalogFromURL(s,i,r)},A.catalogFromVizieR=function(t,e,i,r,o){"name"in(r=r||{})||(r.name="VizieR:"+t);i=URLBuilder.buildVizieRCSURL(t,e,i,r);return A.catalogFromURL(i,r,o,!1)},A.catalogFromSkyBot=function(t,e,i,r,o,s,n){o=o||{},"name"in(s=s||{})||(s.name="SkyBot");o=URLBuilder.buildSkyBotCSURL(t,e,i,r,o);return A.catalogFromURL(o,s,n,!1)},v.AVAILABLE_CALLBACKS=["select","objectClicked","objectHovered","footprintClicked","footprintHovered","positionChanged","zoomChanged","click","mouseMove","fullScreenToggled"],v.prototype.on=function(t,e){v.AVAILABLE_CALLBACKS.indexOf(t)<0||(this.callbacksByEventName[t]=e)},v.prototype.select=function(){this.fire("selectstart")},v.prototype.fire=function(t,e){"selectstart"===t?this.view.setMode(View.SELECT):"selectend"===t&&(this.view.setMode(View.PAN),"function"==typeof(t=this.callbacksByEventName.select)&&t(e))},v.prototype.hideBoxes=function(){if(this.boxes)for(var t=0;t<this.boxes.length;t++)this.boxes[t].hide()},v.prototype.updateCM=function(){},v.prototype.showLayerBox=function(){var e=this,t=$(this.aladinDiv).find(".aladin-layerBox");t.empty(),t.append('<a class="aladin-closeBtn">&times;</a><div style="clear: both;"></div><div class="aladin-label">Base image layer</div><select class="aladin-surveySelection"></select><div class="aladin-cmap">Color map:<div><select class="aladin-cmSelection"></select><button class="aladin-btn aladin-btn-small aladin-reverseCm" type="button">Reverse</button></div></div><div class="aladin-box-separator"></div><div class="aladin-label">Overlay layers</div>');for(var i=t.find(".aladin-cmap"),r=t.find(".aladin-cmSelection"),o=0;o<ColorMap.MAPS_NAMES.length;o++)r.append($("<option />").text(ColorMap.MAPS_NAMES[o]));r.val(e.getBaseImageLayer().getColorMap().mapName);for(var s=this.view.allOverlayLayers,n="<ul>",o=s.length-1;0<=o;o--){var a=s[o],l=a.name,h="";a.isShowing&&(h='checked="checked"');var c="",u="";"catalog"==a.type||"progressivecat"==a.type?(c=(d=a.getSources().length)+" source"+(1<d?"s":""),u=AladinUtils.SVG_ICONS.CATALOG):"moc"==a.type?(c="Coverage: "+(100*a.skyFraction()).toFixed(3)+" % of sky",u=AladinUtils.SVG_ICONS.MOC):"overlay"==a.type&&(u=AladinUtils.SVG_ICONS.OVERLAY);var d=$("<div></div>").css("color",a.color).css("color"),d=Color.getLabelColorForBackground(d);n+='<li><div class="aladin-stack-icon" style=\'background-image: url("data:image/svg+xml;base64,'+window.btoa(u.replace(/FILLCOLOR/g,a.color))+"\");'></div>",n+='<input type="checkbox" '+h+' id="aladin_lite_'+l+'"></input><label for="aladin_lite_'+l+'" class="aladin-layer-label" style="background: '+a.color+"; color:"+d+';" title="'+c+'">'+l+"</label></li>"}t.append(n+="</ul>"),t.append('<div class="aladin-blank-separator"></div>');h="";this.view.displayReticle&&(h='checked="checked"');var p=$('<input type="checkbox" '+h+' id="displayReticle" />');t.append(p).append('<label for="displayReticle">Reticle</label><br/>'),p.change(function(){e.showReticle($(this).is(":checked"))}),h="",this.view.displayHpxGrid&&(h='checked="checked"');p=$('<input type="checkbox" '+h+' id="displayHpxGrid"/>');t.append(p).append('<label for="displayHpxGrid">HEALPix grid</label><br/>'),p.change(function(){e.showHealpixGrid($(this).is(":checked"))}),t.append('<div class="aladin-box-separator"></div><div class="aladin-label">Tools</div>');var f=$('<button class="aladin-btn" type="button">Export view as PNG</button>');t.append(f),f.click(function(){e.exportAsPNG()}),t.find(".aladin-closeBtn").click(function(){return e.hideBoxes(),!1}),this.updateSurveysDropdownList(HpxImageSurvey.getAvailableSurveys()),$(this.aladinDiv).find(".aladin-surveySelection").change(function(){var t=HpxImageSurvey.getAvailableSurveys()[$(this)[0].selectedIndex];e.setImageSurvey(t.id,function(){var t=e.getBaseImageLayer();t.useCors?(r.val(t.getColorMap().mapName),i.show(),f.show()):(i.hide(),f.hide())})}),i.find(".aladin-cmSelection").change(function(){var t=$(this).find(":selected").val();e.getBaseImageLayer().getColorMap().update(t)}),i.find(".aladin-reverseCm").click(function(){e.getBaseImageLayer().getColorMap().reverse()}),this.getBaseImageLayer().useCors?(i.show(),f.show()):(i.hide(),f.hide()),t.find(".aladin-reverseCm").parent().attr("disabled",!0),$(this.aladinDiv).find(".aladin-layerBox ul input").change(function(){var t=$(this).attr("id").substr(12),t=e.layerByName(t);$(this).is(":checked")?t.show():t.hide()}),t.show()},v.prototype.layerByName=function(t){for(var e=this.view.allOverlayLayers,i=0;i<e.length;i++)if(t==e[i].name)return e[i];return null},v.prototype.exportAsPNG=function(t){var e=window.open();e.document.write('<img src="'+this.getViewDataURL()+'">'),e.document.title="Aladin Lite snapshot"},v.prototype.getViewDataURL=function(t){t=t||{};return this.view.getCanvasDataURL((t="object"!=typeof t?{format:t}:t).format,t.width,t.height)},v.prototype.getSkymapDataURL=function(t){t=t||{};return this.view.getCanvasSkymapDataURL((t="object"!=typeof t?{format:t}:t).format,t.width,t.height)},v.prototype.getViewWCS=function(t){var e=this.getRaDec(),i=this.getFov();return{NAXIS:2,NAXIS1:this.view.width,NAXIS2:this.view.height,RADECSYS:"ICRS",CRPIX1:this.view.width/2,CRPIX2:this.view.height/2,CRVAL1:e[0],CRVAL2:e[1],CTYPE1:"RA---SIN",CTYPE2:"DEC--SIN",CD1_1:i[0]/this.view.width,CD1_2:0,CD2_1:0,CD2_2:i[1]/this.view.height}},v.prototype.setFovRange=v.prototype.setFOVRange=function(t,e){var i;e<t&&(i=t,t=e,e=i),this.view.minFOV=t,this.view.maxFOV=e},v.prototype.pix2world=function(t,e){if(this.view){var i,e=AladinUtils.viewToXy(t,e,this.view.width,this.view.height,this.view.largestDim,this.view.zoomFactor);try{i=this.view.projection.unproject(e.x,e.y)}catch(t){return}return this.view.cooFrame==CooFrameEnum.GAL?CooConversion.GalacticToJ2000([i.ra,i.dec]):[i.ra,i.dec]}},v.prototype.world2pix=function(t,e){if(this.view){var i;if(e=this.view.cooFrame==CooFrameEnum.GAL?(i=CooConversion.J2000ToGalactic([t,e]),this.view.projection.project(i[0],i[1])):this.view.projection.project(t,e)){e=AladinUtils.xyToView(e.X,e.Y,this.view.width,this.view.height,this.view.largestDim,this.view.zoomFactor);return[e.vx,e.vy]}return null}},v.prototype.getFovCorners=function(t){(!t||t<1)&&(t=1);for(var e=[],i=0;i<4;i++)for(var r=0==i||3==i?0:this.view.width-1,o=i<2?0:this.view.height-1,s=i<2?this.view.width-1:0,n=1==i||2==i?this.view.height-1:0,a=0;a<t;a++)e.push(this.pix2world(r+a/t*(s-r),o+a/t*(n-o)));return e},v.prototype.getFov=function(){var t=this.view.fov,e=this.getSize(),e=e[1]/e[0]*t;return[t=Math.min(t,180),e=Math.min(e,180)]},v.prototype.getSize=function(){return[this.view.width,this.view.height]},v.prototype.getParentDiv=function(){return $(this.aladinDiv)},v}(),A.aladin=function(t,e){return new Aladin($(t)[0],e)},A.imageLayer=function(t,e,i,r){return new HpxImageSurvey(t,e,i,null,null,r)},A.source=function(t,e,i,r){return new cds.Source(t,e,i,r)},A.marker=function(t,e,i,r){return(i=i||{}).marker=!0,A.source(t,e,r,i)},A.polygon=function(t){var e=t.length;return 0<e&&(t[0][0]==t[e-1][0]&&t[0][1]==t[e-1][1]||t.push([t[0][0],t[0][1]])),new Footprint(t)},A.polyline=function(t,e){return new Polyline(t,e)},A.circle=function(t,e,i,r){return new Circle([t,e],i,r)},A.graphicOverlay=function(t){return new Overlay(t)},A.catalog=function(t){return new cds.Catalog(t)},A.catalogHiPS=function(t,e){return new ProgressiveCat(t,null,null,e)},Aladin.prototype.box=function(t){t=new Box(t);return t.$parentDiv.appendTo(this.aladinDiv),t},Aladin.prototype.showPopup=function(t,e,i,r){this.view.catalogForPopup.removeAll();e=A.marker(t,e,{popupTitle:i,popupDesc:r,useMarkerDefaultIcon:!1});this.view.catalogForPopup.addSources(e),this.view.catalogForPopup.show(),this.view.popup.setTitle(i),this.view.popup.setText(r),this.view.popup.setSource(e),this.view.popup.show()},Aladin.prototype.hidePopup=function(){this.view.popup.hide()},Aladin.prototype.getShareURL=function(){var t=this.getRaDec(),e=new Coo;return e.prec=7,e.lon=t[0],e.lat=t[1],"http://aladin.unistra.fr/AladinLite/?target="+encodeURIComponent(e.format("s"))+"&fov="+this.getFov()[0].toFixed(2)+"&survey="+encodeURIComponent(this.getBaseImageLayer().id||this.getBaseImageLayer().rootUrl)},Aladin.prototype.getEmbedCode=function(){var t=this.getRaDec(),e=new Coo;e.prec=7,e.lon=t[0],e.lat=t[1];t="";return t+='<link rel="stylesheet" href="http://aladin.unistra.fr/AladinLite/api/v2/latest/aladin.min.css" />\n',t+='<script type="text/javascript" src="//code.jquery.com/jquery-1.9.1.min.js" charset="utf-8"><\/script>\n',t+='<div id="aladin-lite-div" style="width:400px;height:400px;"></div>\n',t+='<script type="text/javascript" src="http://aladin.unistra.fr/AladinLite/api/v2/latest/aladin.min.js" charset="utf-8"><\/script>\n',t+='<script type="text/javascript">\n',t+='var aladin = A.aladin("#aladin-lite-div", {survey: "'+this.getBaseImageLayer().id+'P/DSS2/color", fov: '+this.getFov()[0].toFixed(2)+', target: "'+e.format("s")+'"});\n',t+="<\/script>"},Aladin.prototype.displayFITS=function(t,r,o,s){t={url:t};(r=r||{}).color&&(t.color=!0),r.outputFormat&&(t.format=r.outputFormat),r.order&&(t.order=r.order),r.nocache&&(t.nocache=r.nocache);var n=this;$.ajax({url:"https://alasky.unistra.fr/cgi/fits2HiPS",data:t,method:"GET",dataType:"json",success:function(t){if("success"!=t.status)return console.error("An error occured: "+t.message),void(s&&s(t.message));var e=r.label||"FITS image",i=t.data.meta;n.setOverlayImageLayer(n.createImageSurvey(e,e,t.data.url,"equatorial",i.max_norder,{imgFormat:"png"}));t=r&&r.transparency||1;n.getOverlayImageLayer().setAlpha(t);t=!0;!0===(t=o?o(i.ra,i.dec,i.fov):t)&&(n.gotoRaDec(i.ra,i.dec),n.setFoV(i.fov))}})},Aladin.prototype.displayJPG=Aladin.prototype.displayPNG=function(t,e,i,r){(e=e||{}).color=!0,e.label="JPG/PNG image",e.outputFormat="png",this.displayFITS(t,e,i,r)},Aladin.prototype.setReduceDeformations=function(t){this.reduceDeformations=t,this.view.requestRedraw()},$&&($.aladin=A.aladin),BlendingModeEnum={sourceover:"source-over",sourcein:"source-in",sourceout:"source-out",sourceatop:"source-atop",destinationover:"destination-over",destinationin:"destination-in",destinationout:"destination-out",destinationatop:"destination-atop",lighter:"lighter",copy:"copy",xor:"xor",multiply:"multiply",screen:"screen",overlay:"overlay",darken:"darken",lighten:"lighten",colordodge:"color-dodge",colorburn:"color-burn",hardlight:"hard-light",softlight:"soft-light",difference:"difference",exclusion:"exclusion",hue:"hue",saturation:"saturation",color:"color",luminosity:"luminosity"};
